import{r as u,f as le,t as g,j as e,B as m,c as X,u as Re,l as Be}from"./index-CLHUakAX.js";import{l as te,u as pe,F as qe,g as E,h as T,i as F,j as O,k as P,S as Me,T as Qe,a as Ue,b as Ce,c as V,d as Ve,e as K,E as Ke,f as ze,m as Se,M as Le}from"./table-ldpN8xw4.js";import{u as _e,a as Ae,I as H,C as q,b as re,c as ae,d as ne,e as M}from"./card-CukyQwW8.js";import{O as ge,Q as $e,R as fe,T as Ne,U as ve,M as z,V as ye,W as be,a2 as Y,D as He,j as We,k as Ge,l as Xe,n as oe,m as Ye,N as Ze,_ as Z,A as de,s as me,t as xe,a3 as es,a4 as ss,a5 as ts,a6 as rs,a7 as as,a8 as ns}from"./sign-out-dialog-BmFH9JZt.js";import{h as ls,i as is,C as cs,a as he,b as ue,P as os,e as ds,f as ms,g as xs}from"./progress-TBhnpUcZ.js";import{B as W}from"./badge-CdB_N4w5.js";import{H as ke,S as De,T as Ie,C as Ee,P as Te,a as hs}from"./config-drawer-CDF0ceuM.js";import{c as _,C as us,F as Fe}from"./content-api-DOJ1H-iu.js";import{l as js}from"./learning-centers-api-BTKOMyAO.js";import{g as je}from"./media-utils-Cpm_6zhn.js";import{T as we,a as ps,b as gs,c as ee,d as se}from"./textarea-BXuluAVS.js";import{S as fs,a as Ns,b as vs,c as ys,d as bs}from"./select-CDtJ4CEX.js";import{D as Je}from"./download-CBt9xkh4.js";import{c as ws}from"./createLucideIcon-Yuvaac23.js";import{E as Cs}from"./eye-CzH1KRC9.js";import{C as Ss}from"./chevrons-up-down-Fp9r8F2A.js";import{P as Ls}from"./plus-I1W4vLC2.js";/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ks=[["line",{x1:"4",x2:"20",y1:"9",y2:"9",key:"4lhtct"}],["line",{x1:"4",x2:"20",y1:"15",y2:"15",key:"vyu0kd"}],["line",{x1:"10",x2:"8",y1:"3",y2:"21",key:"1ggp8o"}],["line",{x1:"16",x2:"14",y1:"3",y2:"21",key:"weycgp"}]],Ds=ws("hash",ks);function Is({courseId:d,children:f,onSuccess:v}){const[C,N]=u.useState(!1),i=le(),o=_e({resolver:Ae(ls),defaultValues:{title:"",content:"",order:1}}),{data:p,isLoading:a}=te({queryKey:["courses"],queryFn:()=>_.courses.list(),enabled:!d}),j=pe({mutationFn:l=>_.lessons.create({title:l.title,content:l.content,order:l.order,chapter_id:l.courseId,lesson_type:"word"}),onSuccess:()=>{g.success("Lesson created successfully"),i.invalidateQueries({queryKey:["lessons"]}),i.invalidateQueries({queryKey:["courses"]}),o.reset(),N(!1),v?.()},onError:l=>{g.error("Failed to create lesson"),console.error("Create lesson error:",l)}}),x=l=>{const c=d||parseInt(o.watch("courseId"));if(!c){g.error("Please select a course");return}j.mutate({...l,courseId:c})};return e.jsxs(ge,{open:C,onOpenChange:N,children:[e.jsx($e,{asChild:!0,children:f||e.jsxs(m,{children:[e.jsx(us,{className:"h-4 w-4"}),"Add Lesson"]})}),e.jsxs(fe,{className:"sm:max-w-[700px]",children:[e.jsxs(Ne,{children:[e.jsxs(ve,{className:"flex items-center gap-2",children:[e.jsx(z,{className:"h-5 w-5"}),"Create New Lesson"]}),e.jsx(ye,{children:"Add a new lesson to organize educational content and words."})]}),e.jsx(qe,{...o,children:e.jsxs("form",{onSubmit:o.handleSubmit(x),className:"space-y-6",children:[e.jsxs("div",{className:"grid gap-4",children:[!d&&e.jsx(E,{control:o.control,name:"courseId",render:({field:l})=>e.jsxs(T,{children:[e.jsx(F,{children:"Course *"}),e.jsxs(fs,{onValueChange:c=>l.onChange(parseInt(c)),value:l.value?.toString(),disabled:a,children:[e.jsx(O,{children:e.jsx(Ns,{children:e.jsx(vs,{placeholder:"Select a course"})})}),e.jsx(ys,{children:p?.map(c=>e.jsx(bs,{value:c.id.toString(),children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${c.is_active?"bg-green-500":"bg-red-500"}`}),c.title]})},c.id))})]}),e.jsx(P,{})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx("div",{className:"md:col-span-2",children:e.jsx(E,{control:o.control,name:"title",render:({field:l})=>e.jsxs(T,{children:[e.jsx(F,{children:"Lesson Title *"}),e.jsx(O,{children:e.jsx(H,{placeholder:"e.g., Greetings and Introductions",...l})}),e.jsx(P,{})]})})}),e.jsx("div",{children:e.jsx(E,{control:o.control,name:"order",render:({field:l})=>e.jsxs(T,{children:[e.jsx(F,{children:"Order *"}),e.jsx(O,{children:e.jsx(H,{type:"number",min:"1",placeholder:"1",...l,onChange:c=>l.onChange(parseInt(c.target.value)||1)})}),e.jsx(P,{})]})})})]}),e.jsx(E,{control:o.control,name:"content",render:({field:l})=>e.jsxs(T,{children:[e.jsx(F,{children:"Lesson Content *"}),e.jsx(O,{children:e.jsx(we,{placeholder:"Describe the lesson objectives, key concepts, and learning outcomes...",className:"min-h-[150px]",...l})}),e.jsx(P,{})]})})]}),e.jsxs(be,{children:[e.jsx(m,{type:"button",variant:"outline",onClick:()=>N(!1),children:"Cancel"}),e.jsx(m,{type:"submit",disabled:j.isPending,className:"min-w-[100px]",children:j.isPending?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),"Creating..."]}):"Create Lesson"})]})]})})]})]})}function Es({lesson:d,open:f,onOpenChange:v,onSuccess:C}){const N=le(),i=_e({resolver:Ae(is),defaultValues:{title:"",content:"",order:1}}),o=pe({mutationFn:a=>{if(!d)throw new Error("No lesson selected");return _.lessons.update(d.id,a)},onSuccess:()=>{g.success("Lesson updated successfully"),N.invalidateQueries({queryKey:["lessons"]}),N.invalidateQueries({queryKey:["courses"]}),v(!1),C?.()},onError:a=>{g.error("Failed to update lesson"),console.error("Update lesson error:",a)}});u.useEffect(()=>{d&&i.reset({title:d.title,content:d.content,order:d.order})},[d,i]);const p=a=>{o.mutate(a)};return d?e.jsx(ge,{open:f,onOpenChange:v,children:e.jsxs(fe,{className:"sm:max-w-[700px]",children:[e.jsxs(Ne,{children:[e.jsxs(ve,{className:"flex items-center gap-2",children:[e.jsx(Me,{className:"h-5 w-5"}),"Edit Lesson"]}),e.jsx(ye,{children:"Update the lesson information and content."})]}),e.jsx(qe,{...i,children:e.jsxs("form",{onSubmit:i.handleSubmit(p),className:"space-y-6",children:[e.jsxs("div",{className:"grid gap-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx("div",{className:"md:col-span-2",children:e.jsx(E,{control:i.control,name:"title",render:({field:a})=>e.jsxs(T,{children:[e.jsx(F,{children:"Lesson Title *"}),e.jsx(O,{children:e.jsx(H,{placeholder:"e.g., Greetings and Introductions",...a})}),e.jsx(P,{})]})})}),e.jsx("div",{children:e.jsx(E,{control:i.control,name:"order",render:({field:a})=>e.jsxs(T,{children:[e.jsx(F,{children:"Order *"}),e.jsx(O,{children:e.jsx(H,{type:"number",min:"1",placeholder:"1",...a,onChange:j=>a.onChange(parseInt(j.target.value)||1)})}),e.jsx(P,{})]})})})]}),e.jsx(E,{control:i.control,name:"content",render:({field:a})=>e.jsxs(T,{children:[e.jsx(F,{children:"Lesson Content *"}),e.jsx(O,{children:e.jsx(we,{placeholder:"Describe the lesson objectives, key concepts, and learning outcomes...",className:"min-h-[150px]",...a})}),e.jsx(P,{})]})}),e.jsxs("div",{className:"bg-muted/50 border rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(z,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"font-medium text-sm",children:"Current Course"})]}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Chapter ",d.chapter_id]}),e.jsx("div",{className:"text-xs text-muted-foreground mt-1",children:"Note: To move this lesson to a different course, please create a new lesson in the target course."})]})]}),e.jsxs(be,{children:[e.jsx(m,{type:"button",variant:"outline",onClick:()=>v(!1),children:"Cancel"}),e.jsx(m,{type:"submit",disabled:o.isPending,className:"min-w-[100px]",children:o.isPending?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),"Updating..."]}):"Update Lesson"})]})]})})]})}):null}const Oe=`[
  {
    "title": "Introduction to English",
    "content": "Welcome to our English course! In this first lesson, we'll cover the basics of English grammar and pronunciation.",
    "order": 1
  },
  {
    "title": "Basic Greetings",
    "content": "Learn common greetings and how to introduce yourself in English. Practice saying hello, goodbye, and asking how someone is doing.",
    "order": 2
  },
  {
    "title": "Numbers and Counting",
    "content": "Master numbers 1-100 in English. Learn how to count, tell time, and express quantities in everyday situations.",
    "order": 3
  },
  {
    "title": "Family and Relationships",
    "content": "Vocabulary for describing family members and relationships. Learn to talk about your family tree and close friends.",
    "order": 4
  },
  {
    "title": "Daily Activities",
    "content": "Common verbs and phrases for daily routines. Practice describing what you do from morning to night.",
    "order": 5
  }
]`;function Ts({courseId:d,courseName:f,children:v,onSuccess:C}){const[N,i]=u.useState(!1),[o,p]=u.useState(""),[a,j]=u.useState([]),[x,l]=u.useState([]),[,c]=u.useState(!1),[y,S]=u.useState([]),[r,D]=u.useState("input"),[R,A]=u.useState(0),G=le(),ie=s=>{const t=[];if(!s.trim())return t.push("JSON input is required"),{valid:!1,errors:t};try{const h=JSON.parse(s);if(!Array.isArray(h))return t.push("JSON must be an array of lesson objects"),{valid:!1,errors:t};if(h.length===0)return t.push("Array cannot be empty"),{valid:!1,errors:t};if(h.length>50)return t.push("Maximum 50 lessons allowed per bulk creation"),{valid:!1,errors:t};const b=[],w=new Set;return h.forEach((L,I)=>{if(typeof L!="object"||L===null){t.push(`Item ${I+1}: Must be an object`);return}const{title:Q,content:U,order:k}=L;!Q||typeof Q!="string"?t.push(`Item ${I+1}: "title" is required and must be a string`):Q.length>200&&t.push(`Item ${I+1}: "title" must be less than 200 characters`),!U||typeof U!="string"?t.push(`Item ${I+1}: "content" is required and must be a string`):U.length>5e3&&t.push(`Item ${I+1}: "content" must be less than 5000 characters`),typeof k!="number"||k<1?t.push(`Item ${I+1}: "order" must be a positive number`):w.has(k)?t.push(`Item ${I+1}: "order" ${k} is duplicated`):w.add(k),Q&&U&&typeof k=="number"&&k>=1&&b.push({title:Q.trim(),content:U.trim(),order:k})}),{valid:t.length===0,lessons:b,errors:t}}catch(h){return t.push("Invalid JSON format: "+h.message),{valid:!1,errors:t}}},$=()=>{const{valid:s,lessons:t,errors:h}=ie(o);j(h),s&&t&&(l(t),D("preview"))},ce=async()=>{D("creating"),c(!0),A(0);const s=[];for(let b=0;b<x.length;b++){const w=x[b];try{const L=await _.lessons.create({title:w.title,content:w.content,order:w.order,chapter_id:d,lesson_type:"word"});s.push({lesson:w,success:!0,id:L.id}),g.success(`Created lesson: ${w.title}`)}catch(L){s.push({lesson:w,success:!1,error:L instanceof Error?L.message:"Unknown error"}),g.error(`Failed to create lesson: ${w.title}`)}A((b+1)/x.length*100),S([...s])}c(!1),D("results"),G.invalidateQueries({queryKey:["lessons"]}),G.invalidateQueries({queryKey:["courses"]});const t=s.filter(b=>b.success).length,h=s.filter(b=>!b.success).length;t>0&&g.success(`Successfully created ${t} lesson${t>1?"s":""}`),h>0&&g.error(`Failed to create ${h} lesson${h>1?"s":""}`),C?.()},J=()=>{D("input"),p(""),j([]),l([]),S([]),A(0)},B=()=>{navigator.clipboard.writeText(Oe),g.success("Example JSON copied to clipboard")},n=()=>{const s=new Blob([Oe],{type:"application/json"}),t=URL.createObjectURL(s),h=document.createElement("a");h.href=t,h.download="lessons-example.json",document.body.appendChild(h),h.click(),document.body.removeChild(h),URL.revokeObjectURL(t),g.success("Example JSON downloaded")};return e.jsxs(ge,{open:N,onOpenChange:i,children:[e.jsx($e,{asChild:!0,children:v||e.jsxs(m,{variant:"outline",children:[e.jsx(Fe,{className:"h-4 w-4"}),"Bulk Create (JSON)"]})}),e.jsxs(fe,{className:"sm:max-w-[900px] max-h-[90vh] flex flex-col",children:[e.jsxs(Ne,{children:[e.jsxs(ve,{className:"flex items-center gap-2",children:[e.jsx(Fe,{className:"h-5 w-5"}),'Bulk Create Lessons for "',f,'"']}),e.jsx(ye,{children:"Create multiple lessons at once using JSON format. Each lesson will be created individually."})]}),e.jsxs(ps,{value:r,className:"w-full flex-1 flex flex-col overflow-hidden",children:[e.jsxs(gs,{className:"grid w-full grid-cols-4",children:[e.jsx(ee,{value:"input",disabled:r==="creating",className:X(r==="input"&&"bg-primary text-primary-foreground",["preview","creating","results"].includes(r)&&"bg-muted"),children:"1. JSON Input"}),e.jsx(ee,{value:"preview",disabled:r==="creating"||x.length===0,className:X(r==="preview"&&"bg-primary text-primary-foreground",["creating","results"].includes(r)&&"bg-muted"),children:"2. Preview"}),e.jsx(ee,{value:"creating",disabled:!0,className:X(r==="creating"&&"bg-primary text-primary-foreground",r==="results"&&"bg-muted"),children:"3. Creating..."}),e.jsx(ee,{value:"results",disabled:y.length===0,className:X(r==="results"&&"bg-primary text-primary-foreground"),children:"4. Results"})]}),e.jsx(se,{value:"input",className:"space-y-4 flex-1 overflow-y-auto",children:e.jsxs("div",{className:"grid gap-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Lessons JSON Array"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(m,{variant:"ghost",size:"sm",onClick:B,children:[e.jsx(cs,{className:"h-3 w-3 mr-1"}),"Copy Example"]}),e.jsxs(m,{variant:"ghost",size:"sm",onClick:n,children:[e.jsx(Je,{className:"h-3 w-3 mr-1"}),"Download Example"]})]})]}),e.jsx(we,{value:o,onChange:s=>p(s.target.value),placeholder:"Paste your JSON array here...",className:"min-h-[300px] max-h-[400px] font-mono text-sm resize-none"})]}),a.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-red-600",children:[e.jsx(he,{className:"h-4 w-4"}),e.jsx("span",{className:"font-medium",children:"Validation Errors:"})]}),e.jsx(Y,{className:"max-h-[100px]",children:e.jsx("ul",{className:"space-y-1 text-sm text-red-600",children:a.map((s,t)=>e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-red-400 mt-0.5",children:"•"}),s]},t))})})]}),e.jsxs("div",{className:"bg-muted/50 rounded-lg p-4",children:[e.jsx("h4",{className:"font-medium mb-2",children:"JSON Format Requirements:"}),e.jsxs("ul",{className:"text-sm text-muted-foreground space-y-1",children:[e.jsx("li",{children:"• Must be a valid JSON array"}),e.jsx("li",{children:'• Each object requires: "title", "content", "order"'}),e.jsx("li",{children:"• Title: max 200 characters"}),e.jsx("li",{children:"• Content: max 5000 characters"}),e.jsx("li",{children:"• Order: positive number, unique per lesson"}),e.jsx("li",{children:"• Maximum 50 lessons per bulk operation"})]})]})]})}),e.jsx(se,{value:"preview",className:"space-y-4 flex-1 overflow-y-auto",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ue,{className:"h-5 w-5 text-green-600"}),e.jsxs("span",{className:"font-medium",children:["Ready to create ",x.length," lesson",x.length>1?"s":""]})]}),e.jsx(Y,{className:"flex-1 max-h-[400px]",children:e.jsx("div",{className:"space-y-3",children:x.map((s,t)=>e.jsxs("div",{className:"border rounded-lg p-3",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsxs(W,{variant:"outline",children:["#",s.order]}),e.jsx("span",{className:"font-medium",children:s.title})]}),e.jsx("p",{className:"text-sm text-muted-foreground line-clamp-2",children:s.content})]},t))})})]})}),e.jsx(se,{value:"creating",className:"space-y-4 flex-1 overflow-y-auto",children:e.jsxs("div",{className:"text-center space-y-4",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Creating lessons..."}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[Math.round(R),"% complete (",y.length," of ",x.length,")"]})]}),e.jsx(os,{value:R,className:"w-full"}),y.length>0&&e.jsx(Y,{className:"max-h-[300px]",children:e.jsx("div",{className:"space-y-2 text-left",children:y.map((s,t)=>e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[s.success?e.jsx(ue,{className:"h-4 w-4 text-green-600"}):e.jsx(he,{className:"h-4 w-4 text-red-600"}),e.jsx("span",{className:s.success?"text-green-600":"text-red-600",children:s.lesson.title})]},t))})})]})}),e.jsx(se,{value:"results",className:"space-y-4 flex-1 overflow-y-auto",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"text-center p-4 bg-green-50 dark:bg-green-950 rounded-lg",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:y.filter(s=>s.success).length}),e.jsx("div",{className:"text-sm text-green-600",children:"Successful"})]}),e.jsxs("div",{className:"text-center p-4 bg-red-50 dark:bg-red-950 rounded-lg",children:[e.jsx("div",{className:"text-2xl font-bold text-red-600",children:y.filter(s=>!s.success).length}),e.jsx("div",{className:"text-sm text-red-600",children:"Failed"})]})]}),e.jsx(Y,{className:"flex-1 max-h-[400px]",children:e.jsx("div",{className:"space-y-2",children:y.map((s,t)=>e.jsxs("div",{className:"flex items-start gap-3 p-2 rounded border",children:[s.success?e.jsx(ue,{className:"h-4 w-4 text-green-600 mt-0.5"}):e.jsx(he,{className:"h-4 w-4 text-red-600 mt-0.5"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-medium text-sm",children:s.lesson.title}),s.error&&e.jsx("div",{className:"text-xs text-red-600 mt-1",children:s.error}),s.success&&s.id&&e.jsxs("div",{className:"text-xs text-green-600 mt-1",children:["Created with ID: ",s.id]})]})]},t))})})]})})]}),e.jsxs(be,{children:[r==="input"&&e.jsxs(e.Fragment,{children:[e.jsx(m,{variant:"outline",onClick:()=>i(!1),children:"Cancel"}),e.jsx(m,{onClick:$,disabled:!o.trim(),children:"Validate & Preview"})]}),r==="preview"&&e.jsxs(e.Fragment,{children:[e.jsx(m,{variant:"outline",onClick:()=>D("input"),children:"Back"}),e.jsxs(m,{onClick:ce,disabled:x.length===0,children:["Create ",x.length," Lesson",x.length>1?"s":""]})]}),r==="creating"&&e.jsxs(m,{disabled:!0,children:["Creating... ",Math.round(R),"%"]}),r==="results"&&e.jsxs(e.Fragment,{children:[e.jsx(m,{variant:"outline",onClick:J,children:"Create More"}),e.jsx(m,{onClick:()=>i(!1),children:"Done"})]})]})]})]})}function Fs({data:d,isLoading:f,onEdit:v,onViewWords:C,onRefresh:N,courseName:i}){const[o,p]=u.useState(!1),[a,j]=u.useState(null),x=le(),l=pe({mutationFn:r=>_.lessons.delete(r),onSuccess:r=>{g.success(r.message),x.invalidateQueries({queryKey:["lessons"]}),x.invalidateQueries({queryKey:["courses"]}),N(),p(!1),j(null)},onError:r=>{g.error("Failed to delete lesson"),console.error("Delete error:",r)}}),c=r=>{j(r),p(!0)},y=()=>{a&&l.mutate(a.id)},S=r=>{switch(r){case"word":return"bg-blue-100 text-blue-800 hover:bg-blue-100";case"story":return"bg-purple-100 text-purple-800 hover:bg-purple-100";default:return"bg-gray-100 text-gray-800 hover:bg-gray-100"}};return f?e.jsxs(q,{children:[e.jsxs(re,{children:[e.jsx(ae,{children:"Lessons"}),e.jsx(ne,{children:"Loading..."})]}),e.jsx(M,{children:e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})})})]}):d.length===0?e.jsxs(q,{children:[e.jsxs(re,{children:[e.jsx(ae,{children:"Lessons"}),e.jsx(ne,{children:i?`No lessons found in "${i}"`:"No lessons found"})]}),e.jsx(M,{children:e.jsxs("div",{className:"flex flex-col items-center justify-center py-8",children:[e.jsx(z,{className:"h-12 w-12 text-muted-foreground mb-4"}),e.jsxs("p",{className:"text-muted-foreground text-center",children:[i?`No lessons have been created for "${i}" yet.`:"No lessons have been created yet.",e.jsx("br",{}),'Click "Add Lesson" to get started.']})]})})]}):e.jsxs(e.Fragment,{children:[e.jsxs(q,{className:"border-0 shadow-lg bg-gradient-to-br from-card via-card to-card/95",children:[e.jsx(re,{className:"pb-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs(ae,{className:"text-xl font-semibold flex items-center gap-2",children:[e.jsx(z,{className:"h-5 w-5 text-primary"}),"Lessons (",d.length,")",i&&e.jsx(W,{variant:"outline",className:"ml-2",children:i})]}),e.jsx(ne,{className:"mt-1",children:i?`Manage lessons for "${i}" course`:"Manage educational lessons and their content"})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"Total Lessons"}),e.jsx("div",{className:"text-2xl font-bold text-primary",children:d.length})]})]})}),e.jsx(M,{children:e.jsxs(Qe,{children:[e.jsx(Ue,{children:e.jsxs(Ce,{children:[e.jsx(V,{children:"Lesson"}),e.jsx(V,{children:"Chapter"}),e.jsx(V,{children:"Type"}),e.jsx(V,{children:"Order"}),e.jsx(V,{children:"Actions"})]})}),e.jsx(Ve,{children:d.map(r=>e.jsxs(Ce,{children:[e.jsx(K,{className:"max-w-[300px]",children:e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"font-medium truncate",title:r.title,children:r.title}),e.jsx("div",{className:"text-sm text-muted-foreground line-clamp-1",title:r.content,children:r.content})]})}),e.jsx(K,{className:"max-w-[200px]",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(z,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("div",{className:"min-w-0 flex-1",children:e.jsxs("div",{className:"font-medium text-sm truncate",title:`Chapter ${r.chapter_id}`,children:["Chapter ",r.chapter_id]})})]})}),e.jsx(K,{children:e.jsx(W,{variant:"secondary",className:S(r.lesson_type),children:r.lesson_type.charAt(0).toUpperCase()+r.lesson_type.slice(1)})}),e.jsx(K,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ds,{className:"h-3 w-3 text-muted-foreground"}),e.jsx("span",{className:"text-sm font-mono",children:r.order})]})}),e.jsx(K,{children:e.jsxs(He,{children:[e.jsx(We,{asChild:!0,children:e.jsxs(m,{variant:"ghost",className:"h-8 w-8 p-0",children:[e.jsx("span",{className:"sr-only",children:"Open menu"}),e.jsx(Ke,{className:"h-4 w-4"})]})}),e.jsxs(Ge,{align:"end",children:[e.jsx(Xe,{children:"Actions"}),e.jsxs(oe,{onClick:()=>C(r),children:[e.jsx(Cs,{className:"mr-2 h-4 w-4"}),"View Words"]}),e.jsx(Ye,{}),e.jsxs(oe,{onClick:()=>v(r),children:[e.jsx(Me,{className:"mr-2 h-4 w-4"}),"Edit"]}),e.jsxs(oe,{onClick:()=>c(r),className:"text-red-600",children:[e.jsx(ze,{className:"mr-2 h-4 w-4"}),"Delete"]})]})]})})]},r.id))})]})})]}),e.jsx(Ze,{open:o,onOpenChange:p,title:"Delete Lesson",desc:`Are you sure you want to delete "${a?.title}"? This action cannot be undone and will also delete all associated words.`,confirmText:"Delete",handleConfirm:y,isLoading:l.isPending})]})}function Os(){const d=Re(),f=Be({from:"/_authenticated/content/lessons"}),[v,C]=u.useState(null),[N,i]=u.useState(!1),[o,p]=u.useState(""),[a,j]=u.useState(f.courseId?.toString()||""),[x,l]=u.useState(!1),{data:c=[],isLoading:y}=te({queryKey:["courses"],queryFn:()=>_.courses.list()}),{data:S=[]}=te({queryKey:["learning-centers"],queryFn:()=>js.list()}),{data:r=[],isLoading:D,refetch:R}=te({queryKey:["lessons",a],queryFn:()=>_.lessons.list({chapter_id:a?parseInt(a):void 0}),enabled:!!a});u.useEffect(()=>{f.courseId&&c.length>0&&j(f.courseId.toString())},[f.courseId,c]);const A=r.filter(n=>n.title.toLowerCase().includes(o.toLowerCase())||n.content.toLowerCase().includes(o.toLowerCase())),G=n=>{C(n),i(!0)},ie=n=>{d({to:"/content/words",search:{lessonId:n.id}})},$=()=>{R()},ce=n=>{j(n),p(""),d({to:"/content/lessons",search:n?{courseId:parseInt(n)}:{}})},J=c.find(n=>n.id.toString()===a),B=S.find(n=>n.id===J?.learning_center_id);return a?e.jsxs(e.Fragment,{children:[e.jsxs(ke,{children:[e.jsx(Se,{links:Pe}),e.jsxs("div",{className:"ms-auto flex items-center space-x-4",children:[e.jsx(De,{}),e.jsx(Ie,{}),e.jsx(Ee,{}),e.jsx(Te,{})]})]}),e.jsxs(Le,{children:[e.jsxs("div",{className:"mb-6 flex flex-col gap-4 md:flex-row md:items-center md:justify-between",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight bg-gradient-to-r from-primary to-primary/70 bg-clip-text text-transparent",children:"Lesson Management"}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx("p",{className:"text-muted-foreground text-lg",children:"Managing lessons for"}),B&&e.jsxs(de,{className:"h-5 w-5",children:[e.jsx(me,{src:je(B.logo||""),alt:B.name}),e.jsx(xe,{children:e.jsx(Z,{className:"h-3 w-3"})})]}),e.jsx(W,{variant:"outline",children:J?.title})]})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(m,{variant:"outline",onClick:()=>j(""),children:"Change Course"}),e.jsx(Ts,{courseId:parseInt(a),courseName:J?.title||"Selected Course",onSuccess:$}),e.jsx(Is,{courseId:parseInt(a),onSuccess:$,children:e.jsxs(m,{size:"lg",className:"bg-gradient-to-r from-primary to-primary/90 hover:from-primary/90 hover:to-primary/80 shadow-lg hover:shadow-xl transition-all duration-200",children:[e.jsx(Ls,{className:"mr-2 h-5 w-5"}),"Add Lesson"]})})]})]}),e.jsxs("div",{className:"flex flex-col gap-3 md:flex-row md:items-center mb-6",children:[e.jsx("div",{className:"flex-1",children:e.jsx(H,{placeholder:"Search lessons...",value:o,onChange:n=>p(n.target.value),className:"w-full"})}),e.jsx("div",{className:"flex gap-2",children:e.jsxs(m,{variant:"outline",size:"sm",children:[e.jsx(Je,{className:"h-4 w-4"}),"Export"]})})]}),o&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground mb-6",children:[e.jsxs("span",{children:["Showing ",A.length," of ",r.length," lessons"]}),e.jsxs(W,{variant:"secondary",children:['Search: "',o,'"']}),e.jsx(m,{variant:"ghost",size:"sm",onClick:()=>p(""),children:"Clear search"})]}),e.jsx(Fs,{data:A,isLoading:D,onEdit:G,onViewWords:ie,onRefresh:$,courseName:J?.title})]}),e.jsx(Es,{lesson:v,open:N,onOpenChange:i,onSuccess:$})]}):e.jsxs(e.Fragment,{children:[e.jsxs(ke,{children:[e.jsx(Se,{links:Pe}),e.jsxs("div",{className:"ms-auto flex items-center space-x-4",children:[e.jsx(De,{}),e.jsx(Ie,{}),e.jsx(Ee,{}),e.jsx(Te,{})]})]}),e.jsxs(Le,{children:[e.jsx("div",{className:"mb-6 flex flex-col gap-4 md:flex-row md:items-center md:justify-between",children:e.jsxs("div",{className:"space-y-1",children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight bg-gradient-to-r from-primary to-primary/70 bg-clip-text text-transparent",children:"Lesson Management"}),e.jsx("p",{className:"text-muted-foreground text-lg",children:"Select a course to view and manage its lessons"})]})}),e.jsxs(q,{className:"max-w-2xl mb-6",children:[e.jsxs(re,{children:[e.jsxs(ae,{className:"flex items-center gap-2",children:[e.jsx(Z,{className:"h-5 w-5"}),"Select Course"]}),e.jsx(ne,{children:"Choose a course to manage its lessons and content"})]}),e.jsxs(M,{className:"space-y-4",children:[e.jsxs(ds,{open:x,onOpenChange:l,children:[e.jsx(ms,{asChild:!0,children:e.jsxs(m,{variant:"outline",role:"combobox","aria-expanded":x,className:"w-full justify-between",children:[a?(()=>{const n=c.find(t=>t.id.toString()===a),s=S.find(t=>t.id===n?.learning_center_id);return e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(de,{className:"h-6 w-6",children:[e.jsx(me,{src:je(s?.logo||""),alt:s?.name}),e.jsx(xe,{children:e.jsx(Z,{className:"h-3 w-3"})})]}),e.jsx("span",{className:"truncate",children:n?.title})]})})():e.jsxs("div",{className:"flex items-center gap-2 text-muted-foreground",children:[e.jsx(es,{className:"h-4 w-4"}),e.jsx("span",{children:"Search courses..."})]}),e.jsx(Ss,{className:"ml-2 h-4 w-4 shrink-0 opacity-50"})]})}),e.jsx(xs,{className:"w-full p-0",children:e.jsxs(ss,{children:[e.jsx(ts,{placeholder:"Search courses..."}),e.jsx(rs,{children:"No courses found."}),e.jsx(as,{children:c.map(n=>{const s=S.find(t=>t.id===n.learning_center_id);return e.jsx(ns,{value:`${n.title} ${s?.name||""}`,onSelect:()=>{ce(n.id.toString()),l(!1)},children:e.jsxs("div",{className:"flex items-center gap-3 w-full",children:[e.jsxs(de,{className:"h-8 w-8",children:[e.jsx(me,{src:je(s?.logo||""),alt:s?.name}),e.jsx(xe,{children:e.jsx(Z,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium",children:n.title}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:[s?.name||`Center ${n.learning_center_id}`," • Lessons"]})]}),e.jsx(hs,{className:`ml-auto h-4 w-4 ${a===n.id.toString()?"opacity-100":"opacity-0"}`})]})},n.id)})})]})})]}),y&&e.jsxs("div",{className:"flex items-center justify-center py-4",children:[e.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-primary"}),e.jsx("span",{className:"ml-2 text-sm text-muted-foreground",children:"Loading courses..."})]})]})]}),c.length>0&&e.jsxs("div",{className:"grid gap-4 md:grid-cols-3 max-w-2xl",children:[e.jsx(q,{children:e.jsxs(M,{className:"pt-6",children:[e.jsx("div",{className:"text-2xl font-bold",children:c.length}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Total Courses"})]})}),e.jsx(q,{children:e.jsxs(M,{className:"pt-6",children:[e.jsx("div",{className:"text-2xl font-bold",children:c.reduce((n,s)=>n+(s.lessons_count||0),0)}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Total Lessons"})]})}),e.jsx(q,{children:e.jsxs(M,{className:"pt-6",children:[e.jsx("div",{className:"text-2xl font-bold",children:S.length}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Learning Centers"})]})})]})]})]})}const Pe=[{title:"Courses",href:"/content/courses",isActive:!1,disabled:!1},{title:"Lessons",href:"/content/lessons",isActive:!0,disabled:!1},{title:"Words",href:"/content/words",isActive:!1,disabled:!1}],Xs=Os;export{Xs as component};

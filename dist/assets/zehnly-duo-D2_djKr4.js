import{r as m,d as G,j as e,B as N,t as C,o as _e,s as $,n as Oe,_ as us}from"./index-DgINMOhN.js";import{B as ne,u as te,T as Ts,M as qs}from"./badge-DlUMfce2.js";import{u as Ae,a as De,I as H}from"./label-Dzr7GLYZ.js";import{C as Ws,a as Os,T as Us,b as Ps,c as Te,d as qe}from"./tabs-DRv_3MOa.js";import{A as Is,a as Ms,b as Bs,D as Be,c as Ke,d as Ge,e as Ve,f as ae,C as ze,H as Ks,T as Gs,P as Vs}from"./theme-switch-D75Dtc34.js";import{c as b,C as ns,b as Ne,F as Ue}from"./content-api-BMcIxlpI.js";import{U as zs,C as Rs,E as Qs}from"./upload-course-logo-dialog-5Rk7y-p4.js";import{u as V,T as Re}from"./trash-2-CQU8DePM.js";import{C as Z,a as X,b as Y,c as J,d as ee}from"./card-DpD-R9IK.js";import{T as Qe,a as $e,b as oe,c as O,d as He,e as U}from"./table-B9Qwy-TQ.js";import{g as $s}from"./media-utils-Cpm_6zhn.js";import{B as re}from"./book-open-CMVZCNAv.js";import{E as Ze,S as we,D as he,a as Xe,b as me,c as je,d as pe,e as ge,F as Ee,f as D,g as E,h as F,i as k,j as T,k as ve}from"./form-BLRV5ccc.js";import{U as Q}from"./upload-Cdcu93iZ.js";import{C as Hs,a as Zs,E as Xs}from"./chapters-table-BiJTZSvU.js";import{S as ie,a as de,b as ce,c as xe,d as M}from"./select-BmOJo9TC.js";import{T as Fe,S as Ys}from"./scroll-area-C_0bA9AV.js";import{S as as,X as hs}from"./index-BBs3mCsI.js";import{P as Js}from"./progress-wu9nr1GS.js";import{V as ue,T as Ie}from"./volume-2-C_1mBjpt.js";import{L as xs}from"./loader-circle-BC5ZDUhw.js";import{I as Me}from"./image-CvSmiu9d.js";import{Z as ye}from"./zap-ChW7nrbv.js";import{c as ms}from"./createLucideIcon-KT-QINVg.js";import{G as et}from"./graduation-cap-C6qrRU_a.js";import{P as We}from"./plus-Da2kCsUa.js";import"./index-DWlDxMVm.js";/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const st=[["path",{d:"M17.5 22h.5a2 2 0 0 0 2-2V7l-5-5H6a2 2 0 0 0-2 2v3",key:"rslqgf"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M2 19a2 2 0 1 1 4 0v1a2 2 0 1 1-4 0v-4a6 6 0 0 1 12 0v4a2 2 0 1 1-4 0v-1a2 2 0 1 1 4 0",key:"9f7x3i"}]],tt=ms("file-audio",st);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rt=[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["circle",{cx:"10",cy:"12",r:"2",key:"737tya"}],["path",{d:"m20 17-1.296-1.296a2.41 2.41 0 0 0-3.408 0L9 22",key:"wt3hpn"}]],nt=ms("file-image",rt);function at({data:s,isLoading:y,onEdit:p,onCourseClick:v,onRefresh:g,selectedCourse:x}){const[r,l]=m.useState(!1),[o,i]=m.useState(!1),[u,f]=m.useState(null),[w,_]=m.useState(null),t=G(),h=V({mutationFn:j=>b.courses.delete(j),onSuccess:j=>{C.success(j.message),t.invalidateQueries({queryKey:["courses"]}),g(),l(!1),f(null)},onError:j=>{C.error("Failed to delete course"),console.error("Delete error:",j)}}),n=(j,L)=>{L.stopPropagation(),f(j),l(!0)},d=(j,L)=>{L.stopPropagation(),p(j)},P=(j,L)=>{L.stopPropagation(),_(j),i(!0)},z=()=>{u&&h.mutate(u.id)},S=()=>{t.invalidateQueries({queryKey:["courses"]}),g(),i(!1),_(null)};return y?e.jsxs(Z,{children:[e.jsxs(X,{children:[e.jsx(Y,{children:"Courses"}),e.jsx(J,{children:"Loading..."})]}),e.jsx(ee,{children:e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})})})]}):s.length===0?e.jsxs(Z,{children:[e.jsxs(X,{children:[e.jsx(Y,{children:"Courses"}),e.jsx(J,{children:"No courses found"})]}),e.jsx(ee,{children:e.jsxs("div",{className:"flex flex-col items-center justify-center py-8",children:[e.jsx(re,{className:"h-12 w-12 text-muted-foreground mb-4"}),e.jsxs("p",{className:"text-muted-foreground text-center",children:["No courses have been created yet.",e.jsx("br",{}),'Click "Add Course" to get started.']})]})})]}):e.jsxs(e.Fragment,{children:[e.jsxs(Z,{className:"border-0 shadow-lg bg-gradient-to-br from-card via-card to-card/95",children:[e.jsx(X,{className:"pb-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs(Y,{className:"text-xl font-semibold flex items-center gap-2",children:[e.jsx(re,{className:"h-5 w-5 text-primary"}),"Courses (",s.length,")"]}),e.jsx(J,{className:"mt-1",children:"Click on a course to view its chapters"})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"Total Courses"}),e.jsx("div",{className:"text-2xl font-bold text-primary",children:s.length})]})]})}),e.jsx(ee,{children:e.jsxs(Qe,{children:[e.jsx($e,{children:e.jsxs(oe,{children:[e.jsx(O,{children:"Course"}),e.jsx(O,{children:"Languages"}),e.jsx(O,{children:"Logo"}),e.jsx(O,{className:"w-[70px]",children:"Actions"})]})}),e.jsx(He,{children:s.map(j=>e.jsxs(oe,{className:`cursor-pointer transition-colors hover:bg-muted/50 ${x?.id===j.id?"bg-muted":""}`,onClick:()=>v(j),children:[e.jsx(U,{className:"max-w-[350px]",children:e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"font-medium truncate",title:j.title,children:j.title}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:["ID: #",j.id]})]})}),e.jsx(U,{className:"max-w-[200px]",children:e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx("span",{className:"font-medium text-blue-600",children:j.native_language}),e.jsx("span",{className:"text-muted-foreground",children:"â†’"}),e.jsx("span",{className:"font-medium text-green-600",children:j.learning_language})]}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Native â†’ Target"})]})}),e.jsx(U,{children:e.jsxs("div",{className:"flex items-center gap-3",children:[j.logo_url?e.jsxs("div",{className:"relative",children:[e.jsxs(Is,{className:"h-10 w-10 border-2 border-green-200",children:[e.jsx(Ms,{src:$s(j.logo_url),alt:j.title}),e.jsx(Bs,{className:"bg-green-50",children:e.jsx(re,{className:"h-5 w-5 text-green-600"})})]}),e.jsx("div",{className:"absolute -bottom-1 -right-1 w-3 h-3 bg-green-500 rounded-full border-2 border-white"})]}):e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"h-10 w-10 rounded-full bg-gray-100 border-2 border-gray-200 flex items-center justify-center",children:e.jsx(re,{className:"h-5 w-5 text-gray-400"})}),e.jsx("div",{className:"absolute -bottom-1 -right-1 w-3 h-3 bg-gray-300 rounded-full border-2 border-white"})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:`text-xs font-medium ${j.logo_url?"text-green-600":"text-gray-500"}`,children:j.logo_url?"âœ“ Logo uploaded":"â—‹ No logo"}),e.jsx("span",{className:"text-[10px] text-muted-foreground",children:j.logo_url?"Ready to display":"Upload recommended"})]})]})}),e.jsx(U,{children:e.jsxs(Be,{children:[e.jsx(Ke,{asChild:!0,children:e.jsxs(N,{variant:"ghost",className:"h-8 w-8 p-0",onClick:L=>L.stopPropagation(),children:[e.jsx("span",{className:"sr-only",children:"Open menu"}),e.jsx(Ze,{className:"h-4 w-4"})]})}),e.jsxs(Ge,{align:"end",children:[e.jsx(Ve,{children:"Actions"}),e.jsxs(ae,{onClick:L=>P(j,L),children:[e.jsx(Q,{className:"mr-2 h-4 w-4"}),"Upload Logo"]}),e.jsxs(ae,{onClick:L=>d(j,L),children:[e.jsx(we,{className:"mr-2 h-4 w-4"}),"Edit"]}),e.jsxs(ae,{onClick:L=>n(j,L),className:"text-red-600",children:[e.jsx(Re,{className:"mr-2 h-4 w-4"}),"Delete"]})]})]})})]},j.id))})]})})]}),e.jsx(ze,{open:r,onOpenChange:l,title:"Delete Course",desc:`Are you sure you want to delete "${u?.title}"? This action cannot be undone and will also delete all associated lessons and words.`,confirmText:"Delete",handleConfirm:z,isLoading:h.isPending}),w&&e.jsx(zs,{open:o,onOpenChange:i,course:w,onSuccess:S})]})}function lt({data:s,isLoading:y,onEdit:p,onLessonClick:v,onRefresh:g,selectedLesson:x}){const[r,l]=m.useState(!1),[o,i]=m.useState(null),u=G(),f=V({mutationFn:n=>b.lessons.delete(n),onSuccess:n=>{C.success(n.message),u.invalidateQueries({queryKey:["lessons"]}),g(),l(!1),i(null)},onError:n=>{C.error("Failed to delete lesson"),console.error("Delete error:",n)}}),w=n=>{i(n),l(!0)},_=()=>{o&&f.mutate(o.id)},t=n=>{switch(n){case"word":return"bg-blue-100 text-blue-800 hover:bg-blue-100";case"story":return"bg-purple-100 text-purple-800 hover:bg-purple-100";case"test":return"bg-orange-100 text-orange-800 hover:bg-orange-100";default:return"bg-gray-100 text-gray-800 hover:bg-gray-100"}};if(y)return e.jsxs(Z,{children:[e.jsxs(X,{children:[e.jsx(Y,{children:"Lessons"}),e.jsx(J,{children:"Loading..."})]}),e.jsx(ee,{children:e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})})})]});if(s.length===0)return e.jsxs(Z,{children:[e.jsxs(X,{children:[e.jsx(Y,{children:"Lessons"}),e.jsx(J,{children:"No lessons found"})]}),e.jsx(ee,{children:e.jsxs("div",{className:"flex flex-col items-center justify-center py-8",children:[e.jsx(re,{className:"h-12 w-12 text-muted-foreground mb-4"}),e.jsxs("p",{className:"text-muted-foreground text-center",children:["No lessons have been created yet.",e.jsx("br",{}),'Click "Add Lesson" to get started.']})]})})]});const h=[...s].sort((n,d)=>n.order-d.order);return e.jsxs(e.Fragment,{children:[e.jsxs(Z,{className:"border-0 shadow-lg bg-gradient-to-br from-card via-card to-card/95",children:[e.jsx(X,{className:"pb-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs(Y,{className:"text-xl font-semibold flex items-center gap-2",children:[e.jsx(re,{className:"h-5 w-5 text-primary"}),"Lessons (",h.length,")"]}),e.jsx(J,{className:"mt-1",children:"Manage chapter lessons and their content"})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"Total Lessons"}),e.jsx("div",{className:"text-2xl font-bold text-primary",children:h.length})]})]})}),e.jsx(ee,{children:e.jsxs(Qe,{children:[e.jsx($e,{children:e.jsxs(oe,{children:[e.jsx(O,{children:"Order"}),e.jsx(O,{children:"Lesson Title"}),e.jsx(O,{children:"Type"}),e.jsx(O,{children:"Content"}),e.jsx(O,{className:"w-[70px]",children:"Actions"})]})}),e.jsx(He,{children:h.map(n=>{const d=x?.id===n.id,P=n.lesson_type==="test";return e.jsxs(oe,{className:`transition-colors ${P?"cursor-not-allowed opacity-70":"cursor-pointer hover:bg-muted/50"} ${d?"bg-muted border-l-4 border-l-primary":""}`,onClick:()=>!P&&v?.(n),children:[e.jsx(U,{children:e.jsx(ne,{variant:"outline",className:"w-8 h-8 rounded-full flex items-center justify-center p-0",children:n.order})}),e.jsx(U,{className:"max-w-[300px]",children:e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"font-medium truncate",title:n.title,children:n.title}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:["ID: #",n.id]})]})}),e.jsx(U,{children:e.jsx(ne,{variant:"secondary",className:t(n.lesson_type),children:n.lesson_type.charAt(0).toUpperCase()+n.lesson_type.slice(1)})}),e.jsx(U,{className:"max-w-[400px]",children:e.jsx("p",{className:"text-sm text-muted-foreground truncate",title:n.content,children:n.content})}),e.jsx(U,{children:e.jsxs(Be,{children:[e.jsx(Ke,{asChild:!0,children:e.jsxs(N,{variant:"ghost",className:"h-8 w-8 p-0",children:[e.jsx("span",{className:"sr-only",children:"Open menu"}),e.jsx(Ze,{className:"h-4 w-4"})]})}),e.jsxs(Ge,{align:"end",children:[e.jsx(Ve,{children:"Actions"}),e.jsxs(ae,{onClick:()=>p(n),children:[e.jsx(we,{className:"mr-2 h-4 w-4"}),"Edit"]}),e.jsxs(ae,{onClick:()=>w(n),className:"text-red-600",children:[e.jsx(Re,{className:"mr-2 h-4 w-4"}),"Delete"]})]})]})})]},n.id)})})]})})]}),e.jsx(ze,{open:r,onOpenChange:l,title:"Delete Lesson",desc:`Are you sure you want to delete "${o?.title}"? This action cannot be undone.`,confirmText:"Delete",handleConfirm:_,isLoading:f.isPending})]})}const ot=_e({title:$().min(1,"Lesson title is required"),lesson_type:us(["word","story"]),order:Oe().min(1,"Order must be at least 1"),content:$().min(1,"Content is required")});function it({chapterId:s,children:y,onSuccess:p}){const[v,g]=m.useState(!1),x=G(),r=Ae({resolver:De(ot),defaultValues:{title:"",lesson_type:"word",order:1,content:""}}),l=V({mutationFn:i=>b.lessons.create({...i,chapter_id:s}),onSuccess:()=>{C.success("Lesson created successfully"),x.invalidateQueries({queryKey:["lessons",s]}),r.reset(),g(!1),p?.()},onError:i=>{C.error("Failed to create lesson"),console.error("Create lesson error:",i)}}),o=i=>{l.mutate(i)};return e.jsxs(he,{open:v,onOpenChange:g,children:[e.jsx(Xe,{asChild:!0,children:y||e.jsxs(N,{children:[e.jsx(ns,{className:"h-4 w-4"}),"Add Lesson"]})}),e.jsxs(me,{className:"sm:max-w-[600px]",children:[e.jsxs(je,{children:[e.jsxs(pe,{className:"flex items-center gap-2",children:[e.jsx(re,{className:"h-5 w-5"}),"Create New Lesson"]}),e.jsx(ge,{children:"Add a new lesson to this chapter with content and exercises."})]}),e.jsx(Ee,{...r,children:e.jsxs("form",{onSubmit:r.handleSubmit(o),className:"space-y-6",children:[e.jsxs("div",{className:"grid gap-4",children:[e.jsx(D,{control:r.control,name:"title",render:({field:i})=>e.jsxs(E,{children:[e.jsx(F,{children:"Lesson Title *"}),e.jsx(k,{children:e.jsx(H,{placeholder:"e.g., Hello and Goodbye",...i})}),e.jsx(T,{})]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(D,{control:r.control,name:"lesson_type",render:({field:i})=>e.jsxs(E,{children:[e.jsx(F,{children:"Lesson Type *"}),e.jsxs(ie,{onValueChange:i.onChange,defaultValue:i.value,children:[e.jsx(k,{children:e.jsx(de,{children:e.jsx(ce,{placeholder:"Select lesson type"})})}),e.jsxs(xe,{children:[e.jsx(M,{value:"word",children:"Word"}),e.jsx(M,{value:"story",children:"Story"}),e.jsx(M,{value:"test",children:"Test"})]})]}),e.jsx(T,{})]})}),e.jsx(D,{control:r.control,name:"order",render:({field:i})=>e.jsxs(E,{children:[e.jsx(F,{children:"Order *"}),e.jsx(k,{children:e.jsx(H,{type:"number",min:"1",placeholder:"1",...i,onChange:u=>i.onChange(parseInt(u.target.value)||1)})}),e.jsx(T,{})]})})]}),e.jsx(D,{control:r.control,name:"content",render:({field:i})=>e.jsxs(E,{children:[e.jsx(F,{children:"Content *"}),e.jsx(k,{children:e.jsx(Fe,{placeholder:"In this lesson we learn basic greetings...",className:"min-h-[120px]",...i})}),e.jsx(T,{})]})})]}),e.jsxs(ve,{children:[e.jsx(N,{type:"button",variant:"outline",onClick:()=>g(!1),children:"Cancel"}),e.jsx(N,{type:"submit",disabled:l.isPending,className:"min-w-[120px]",children:l.isPending?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),"Creating..."]}):"Create Lesson"})]})]})})]})]})}const dt=_e({title:$().min(1,"Lesson title is required"),lesson_type:us(["word","story","test"]),order:Oe().min(1,"Order must be at least 1"),content:$().min(1,"Content is required"),word_lesson_id:Oe().optional()});function ct({lesson:s,open:y,onOpenChange:p,onSuccess:v}){const g=G(),[x,r]=m.useState(""),l=Ae({resolver:De(dt),defaultValues:{title:"",lesson_type:"word",order:1,content:"",word_lesson_id:void 0}}),o=l.watch("lesson_type"),{data:i,isLoading:u}=te({queryKey:["word-lessons",s?.chapter_id],queryFn:async()=>s?.chapter_id?(await b.lessons.listByChapter(s.chapter_id)).filter(h=>h.lesson_type==="word"&&h.id!==s?.id):[],enabled:o==="test"&&!!s&&y}),f=i?.filter(t=>t.title.toLowerCase().includes(x.toLowerCase()))||[],w=V({mutationFn:t=>{if(!s)throw new Error("No lesson selected");return b.lessons.update(s.id,t)},onSuccess:()=>{C.success("Lesson updated successfully"),g.invalidateQueries({queryKey:["lessons",s?.chapter_id]}),p(!1),v?.()},onError:t=>{C.error("Failed to update lesson"),console.error("Update lesson error:",t)}});m.useEffect(()=>{s&&l.reset({title:s.title,lesson_type:s.lesson_type,order:s.order,content:s.content,word_lesson_id:s.word_lesson_id})},[s,l]);const _=t=>{w.mutate(t)};return s?e.jsx(he,{open:y,onOpenChange:p,children:e.jsxs(me,{className:"sm:max-w-[600px]",children:[e.jsxs(je,{children:[e.jsxs(pe,{className:"flex items-center gap-2",children:[e.jsx(we,{className:"h-5 w-5"}),"Edit Lesson"]}),e.jsx(ge,{children:"Update the lesson information, type, and content."})]}),e.jsx(Ee,{...l,children:e.jsxs("form",{onSubmit:l.handleSubmit(_),className:"space-y-6",children:[e.jsxs("div",{className:"grid gap-4",children:[e.jsx(D,{control:l.control,name:"title",render:({field:t})=>e.jsxs(E,{children:[e.jsx(F,{children:"Lesson Title *"}),e.jsx(k,{children:e.jsx(H,{placeholder:"e.g., Hello and Goodbye",...t})}),e.jsx(T,{})]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(D,{control:l.control,name:"lesson_type",render:({field:t})=>e.jsxs(E,{children:[e.jsx(F,{children:"Lesson Type *"}),e.jsxs(ie,{onValueChange:t.onChange,value:t.value,children:[e.jsx(k,{children:e.jsx(de,{children:e.jsx(ce,{placeholder:"Select lesson type"})})}),e.jsxs(xe,{children:[e.jsx(M,{value:"word",children:"Word"}),e.jsx(M,{value:"story",children:"Story"}),e.jsx(M,{value:"test",children:"Test"})]})]}),e.jsx(T,{})]})}),e.jsx(D,{control:l.control,name:"order",render:({field:t})=>e.jsxs(E,{children:[e.jsx(F,{children:"Order *"}),e.jsx(k,{children:e.jsx(H,{type:"number",min:"1",placeholder:"1",...t,onChange:h=>t.onChange(parseInt(h.target.value)||1)})}),e.jsx(T,{})]})})]}),o==="test"&&e.jsx(D,{control:l.control,name:"word_lesson_id",render:({field:t})=>e.jsxs(E,{children:[e.jsx(F,{children:"Connect to Word Lesson *"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"relative",children:[e.jsx(as,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),e.jsx(H,{placeholder:"Search word lessons...",value:x,onChange:h=>r(h.target.value),className:"pl-10"})]}),e.jsxs(ie,{onValueChange:h=>t.onChange(parseInt(h)),value:t.value?.toString(),disabled:u,children:[e.jsx(k,{children:e.jsx(de,{children:e.jsx(ce,{placeholder:"Select a word lesson to connect"})})}),e.jsxs(xe,{className:"max-h-60",children:[f.map(h=>e.jsx(M,{value:h.id.toString(),children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(re,{className:"h-4 w-4 text-muted-foreground"}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{children:h.title}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:["Order: ",h.order]})]})]})},h.id)),f.length===0&&!u&&e.jsx("div",{className:"p-2 text-sm text-muted-foreground text-center",children:x?"No word lessons found matching your search":"No word lessons available"})]})]})]}),e.jsx(T,{})]})}),e.jsx(D,{control:l.control,name:"content",render:({field:t})=>e.jsxs(E,{children:[e.jsx(F,{children:"Content *"}),e.jsx(k,{children:e.jsx(Fe,{placeholder:"In this lesson we learn basic greetings...",className:"min-h-[120px]",...t})}),e.jsx(T,{})]})})]}),e.jsxs(ve,{children:[e.jsx(N,{type:"button",variant:"outline",onClick:()=>p(!1),children:"Cancel"}),e.jsx(N,{type:"submit",disabled:w.isPending,className:"min-w-[120px]",children:w.isPending?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),"Updating..."]}):"Update Lesson"})]})]})})]})}):null}function xt({words:s,lessonId:y,children:p,onSuccess:v}){const[g,x]=m.useState(!1),[r,l]=m.useState([]),[o,i]=m.useState("idle"),[u,f]=m.useState(0),[w,_]=m.useState(!1),t=G(),h=()=>s.map(c=>({id:c.id,word:c.word,translation:c.translation,wordAudioStatus:"pending",translationAudioStatus:"pending"})),n=async(c,B=!1)=>{try{return B?{success:!0,message:(await b.words.generateExampleAudio(c)).message}:{success:!0,message:(await b.words.generateAudio(c)).message}}catch(q){return{success:!1,error:q instanceof Error?q.message:"Unknown error"}}},d=(c,B)=>{l(q=>q.map(W=>W.id===c?{...W,...B}:W))},P=c=>{let B=0;const q=c.length*2;return c.forEach(W=>{(W.wordAudioStatus==="success"||W.wordAudioStatus==="error")&&B++,(W.translationAudioStatus==="success"||W.translationAudioStatus==="error")&&B++}),Math.round(B/q*100)},z=V({mutationFn:async()=>{_(!1),i("generating");const c=h();l(c),f(0);let B=0,q=0;for(let W=0;W<s.length&&!w;W++){const se=s[W];if(!w){d(se.id,{wordAudioStatus:"generating"});const R=await n(se.id,!1);R.success?(d(se.id,{wordAudioStatus:"success"}),B++):(d(se.id,{wordAudioStatus:"error",wordError:R.error}),q++)}if(!w){d(se.id,{translationAudioStatus:"generating"});const R=await n(se.id,!0);R.success?(d(se.id,{translationAudioStatus:"success"}),B++):(d(se.id,{translationAudioStatus:"error",translationError:R.error}),q++)}l(R=>{const ke=P(R);return f(ke),R}),W<s.length-1&&!w&&await new Promise(R=>setTimeout(R,500))}return w?(i("cancelled"),C.info("Audio generation cancelled")):(i("completed"),B>0&&C.success(`Successfully generated ${B} audio files`),q>0&&C.error(`Failed to generate ${q} audio files`)),{successCount:B,errorCount:q}},onSuccess:()=>{t.invalidateQueries({queryKey:["words",y]}),v?.()},onError:c=>{C.error("Bulk audio generation failed"),console.error("Bulk generation error:",c),i("completed")}}),S=()=>{x(!0),z.mutate()},j=()=>{_(!0),i("cancelled")},L=()=>{x(!1),i("idle"),l([]),f(0),_(!1)},be=c=>{switch(c){case"pending":return e.jsx("div",{className:"w-4 h-4 rounded-full bg-gray-200"});case"generating":return e.jsx(xs,{className:"h-4 w-4 animate-spin text-blue-500"});case"success":return e.jsx(Os,{className:"h-4 w-4 text-green-500"});case"error":return e.jsx(Ws,{className:"h-4 w-4 text-red-500"})}},A=s.length>0&&!z.isPending,I=s.filter(c=>!c.audio_url||!c.example_audio),le=r.filter(c=>(c.wordAudioStatus==="success"||c.wordAudioStatus==="error")&&(c.translationAudioStatus==="success"||c.translationAudioStatus==="error")).length;return e.jsxs(e.Fragment,{children:[e.jsx(N,{onClick:S,disabled:!A,variant:"outline",className:"flex items-center gap-2",children:p||e.jsxs(e.Fragment,{children:[e.jsx(ue,{className:"h-4 w-4"}),"Generate All Audio",I.length>0&&e.jsx(ne,{variant:"secondary",className:"ml-1",children:I.length})]})}),e.jsx(he,{open:g,onOpenChange:L,children:e.jsxs(me,{className:"sm:max-w-[600px] max-h-[80vh] flex flex-col",children:[e.jsxs(je,{children:[e.jsxs(pe,{className:"flex items-center gap-2",children:[e.jsx(ue,{className:"h-5 w-5"}),"Generate All Audio"]}),e.jsxs(ge,{children:["Generating audio for ",s.length," words and their translations"]})]}),e.jsxs("div",{className:"flex-1 space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Overall Progress"}),e.jsxs("span",{children:[u,"% (",le,"/",s.length," words)"]})]}),e.jsx(Js,{value:u,className:"w-full"})]}),o==="generating"&&e.jsxs("div",{className:"flex justify-between items-center p-3 bg-blue-50 dark:bg-blue-950/20 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(xs,{className:"h-4 w-4 animate-spin text-blue-500"}),e.jsx("span",{className:"text-sm font-medium",children:"Generating audio files..."})]}),e.jsxs(N,{variant:"outline",size:"sm",onClick:j,disabled:w,children:[e.jsx(hs,{className:"h-4 w-4 mr-1"}),"Cancel"]})]}),o==="completed"&&e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"text-center p-3 bg-green-50 dark:bg-green-950/20 rounded-lg",children:[e.jsx("div",{className:"text-lg font-bold text-green-600",children:r.filter(c=>c.wordAudioStatus==="success"&&c.translationAudioStatus==="success").length}),e.jsx("div",{className:"text-sm text-green-600",children:"Words Completed"})]}),e.jsxs("div",{className:"text-center p-3 bg-red-50 dark:bg-red-950/20 rounded-lg",children:[e.jsx("div",{className:"text-lg font-bold text-red-600",children:r.filter(c=>c.wordAudioStatus==="error"||c.translationAudioStatus==="error").length}),e.jsx("div",{className:"text-sm text-red-600",children:"Errors"})]})]}),r.length>0&&e.jsx(Ys,{className:"flex-1 max-h-[300px]",children:e.jsx("div",{className:"space-y-2",children:r.map(c=>e.jsxs("div",{className:"border rounded-lg p-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"font-medium text-sm",children:[c.word," â†’ ",c.translation]}),e.jsxs("div",{className:"flex items-center gap-1",children:[be(c.wordAudioStatus),be(c.translationAudioStatus)]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"text-muted-foreground",children:"Word:"}),e.jsx(ne,{variant:c.wordAudioStatus==="success"?"default":c.wordAudioStatus==="error"?"destructive":"outline",className:"text-xs",children:c.wordAudioStatus})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"text-muted-foreground",children:"Translation:"}),e.jsx(ne,{variant:c.translationAudioStatus==="success"?"default":c.translationAudioStatus==="error"?"destructive":"outline",className:"text-xs",children:c.translationAudioStatus})]})]}),(c.wordError||c.translationError)&&e.jsxs("div",{className:"mt-2 space-y-1",children:[c.wordError&&e.jsxs("div",{className:"text-xs text-red-600",children:["Word error: ",c.wordError]}),c.translationError&&e.jsxs("div",{className:"text-xs text-red-600",children:["Translation error: ",c.translationError]})]})]},c.id))})})]}),e.jsx("div",{className:"flex justify-end gap-2 pt-4 border-t",children:e.jsx(N,{variant:"outline",onClick:L,children:"Close"})})]})})]})}function ut({data:s,isLoading:y,onEdit:p,onRefresh:v,lessonId:g}){const[x,r]=m.useState(!1),[l,o]=m.useState(null),i=G(),u=V({mutationFn:t=>b.words.delete(t),onSuccess:t=>{C.success(t.message),i.invalidateQueries({queryKey:["words"]}),v(),r(!1),o(null)},onError:t=>{C.error("Failed to delete word"),console.error("Delete error:",t)}}),f=t=>{o(t),r(!0)},w=()=>{l&&u.mutate(l.id)},_=t=>{if(t){const h=Ne(t);h&&new Audio(h).play().catch(d=>{console.error("Error playing audio:",d),C.error("Failed to play audio")})}};return y?e.jsxs(Z,{children:[e.jsxs(X,{children:[e.jsx(Y,{children:"Words"}),e.jsx(J,{children:"Loading..."})]}),e.jsx(ee,{children:e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})})})]}):s.length===0?e.jsxs(Z,{children:[e.jsxs(X,{children:[e.jsx(Y,{children:"Words"}),e.jsx(J,{children:"No words found"})]}),e.jsx(ee,{children:e.jsxs("div",{className:"flex flex-col items-center justify-center py-8",children:[e.jsx(Ie,{className:"h-12 w-12 text-muted-foreground mb-4"}),e.jsxs("p",{className:"text-muted-foreground text-center",children:["No words have been created yet.",e.jsx("br",{}),'Click "Add Word" to get started.']})]})})]}):e.jsxs(e.Fragment,{children:[e.jsxs(Z,{className:"border-0 shadow-lg bg-gradient-to-br from-card via-card to-card/95",children:[e.jsx(X,{className:"pb-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs(Y,{className:"text-xl font-semibold flex items-center gap-2",children:[e.jsx(Ie,{className:"h-5 w-5 text-primary"}),"Words (",s.length,")"]}),e.jsx(J,{className:"mt-1",children:"Manage vocabulary words and their translations"})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[g&&s.length>0&&e.jsx(xt,{words:s,lessonId:g,onSuccess:v}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"Total Words"}),e.jsx("div",{className:"text-2xl font-bold text-primary",children:s.length})]})]})]})}),e.jsx(ee,{children:e.jsxs(Qe,{children:[e.jsx($e,{children:e.jsxs(oe,{children:[e.jsx(O,{children:"Word"}),e.jsx(O,{children:"Translation"}),e.jsx(O,{children:"Example"}),e.jsx(O,{children:"Media"}),e.jsx(O,{className:"w-[70px]",children:"Actions"})]})}),e.jsx(He,{children:s.map(t=>e.jsxs(oe,{children:[e.jsx(U,{className:"max-w-[200px]",children:e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"font-medium truncate",title:t.word,children:t.word}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:["ID: #",t.id]})]})}),e.jsx(U,{className:"max-w-[200px]",children:e.jsx("div",{className:"font-medium text-green-600 truncate",title:t.translation,children:t.translation})}),e.jsx(U,{className:"max-w-[300px]",children:e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-sm text-muted-foreground truncate",title:t.example_sentence,children:t.example_sentence}),t.example_audio&&e.jsxs(N,{variant:"ghost",size:"sm",className:"h-6 px-2 text-xs",onClick:()=>_(t.example_audio),children:[e.jsx(ue,{className:"h-3 w-3 mr-1"}),"Play Example"]})]})}),e.jsx(U,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[t.audio_url&&e.jsx(N,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0",onClick:()=>_(t.audio_url),title:"Play audio",children:e.jsx(ue,{className:"h-4 w-4 text-blue-600"})}),t.image_url&&e.jsx(N,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0",onClick:()=>window.open(Ne(t.image_url),"_blank"),title:"View image",children:e.jsx(Me,{className:"h-4 w-4 text-green-600"})}),!t.audio_url&&!t.image_url&&e.jsx(ne,{variant:"outline",className:"text-xs",children:"No media"})]})}),e.jsx(U,{children:e.jsxs(Be,{children:[e.jsx(Ke,{asChild:!0,children:e.jsxs(N,{variant:"ghost",className:"h-8 w-8 p-0",children:[e.jsx("span",{className:"sr-only",children:"Open menu"}),e.jsx(Ze,{className:"h-4 w-4"})]})}),e.jsxs(Ge,{align:"end",children:[e.jsx(Ve,{children:"Actions"}),e.jsxs(ae,{onClick:()=>p(t),children:[e.jsx(we,{className:"mr-2 h-4 w-4"}),"Edit"]}),e.jsxs(ae,{onClick:()=>f(t),className:"text-red-600",children:[e.jsx(Re,{className:"mr-2 h-4 w-4"}),"Delete"]})]})]})})]},t.id))})]})})]}),e.jsx(ze,{open:x,onOpenChange:r,title:"Delete Word",desc:`Are you sure you want to delete "${l?.word}"? This action cannot be undone.`,confirmText:"Delete",handleConfirm:w,isLoading:u.isPending})]})}function Le({onGenerate:s,children:y,queryKey:p,disabled:v=!1}){const g=G(),x=V({mutationFn:s,onSuccess:l=>{C.success(l.message||"Audio generated successfully"),p&&g.invalidateQueries({queryKey:p})},onError:l=>{C.error("Failed to generate audio"),console.error("Audio generation error:",l)}}),r=()=>{x.mutate()};return e.jsx(N,{type:"button",variant:"outline",size:"sm",onClick:r,disabled:v||x.isPending,className:"flex items-center gap-2",children:x.isPending?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-current"}),"Generating..."]}):y||e.jsxs(e.Fragment,{children:[e.jsx(ye,{className:"h-4 w-4"}),"Generate"]})})}function Se({onUpload:s,accept:y,children:p,queryKey:v,disabled:g=!1}){const x=m.useRef(null),r=G(),l=V({mutationFn:async u=>{console.log("Starting upload for file:",u.name,"Size:",u.size,"Type:",u.type);try{const f=await s(u);return console.log("Upload successful:",f),f}catch(f){throw console.error("Upload failed:",f),f}},onSuccess:u=>{console.log("Upload success handler:",u),C.success(u.message||"File uploaded successfully"),v&&r.invalidateQueries({queryKey:v})},onError:u=>{console.error("Upload error handler:",u);const f=u?.response?.data?.detail||u?.message||"Failed to upload file";C.error(f)}}),o=u=>{const f=u.target.files?.[0];if(f){if(f.size>10*1024*1024){C.error("File size must be less than 10MB");return}l.mutate(f)}u.target.value=""},i=()=>{x.current?.click()};return e.jsxs(e.Fragment,{children:[e.jsx(N,{type:"button",variant:"outline",size:"sm",onClick:i,disabled:g||l.isPending,className:"flex items-center gap-2",children:l.isPending?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-current"}),"Uploading..."]}):p||e.jsxs(e.Fragment,{children:[e.jsx(Q,{className:"h-4 w-4"}),"Upload"]})}),e.jsx("input",{ref:x,type:"file",accept:y,onChange:o,className:"hidden"})]})}const ht=_e({word:$().min(1,"Word is required"),translation:$().min(1,"Translation is required"),example_sentence:$().min(1,"Example sentence is required")});function mt({lessonId:s,children:y,onSuccess:p}){const[v,g]=m.useState(!1),[x,r]=m.useState(null),[l,o]=m.useState("Betty"),[i,u]=m.useState("Betty"),f=G(),w=Ae({resolver:De(ht),defaultValues:{word:"",translation:"",example_sentence:""}}),_=V({mutationFn:n=>b.words.create({...n,lesson_id:s,audio_url:null,image_url:null,example_audio:null}),onSuccess:n=>{C.success("Word created successfully"),f.invalidateQueries({queryKey:["words",s]}),r(n.id),w.reset(),p?.()},onError:n=>{C.error("Failed to create word"),console.error("Create word error:",n)}}),t=n=>{_.mutate(n)},h=n=>{g(n),n||(r(null),o("Betty"),u("Betty"),w.reset())};return e.jsxs(he,{open:v,onOpenChange:h,children:[e.jsx(Xe,{asChild:!0,children:y||e.jsxs(N,{children:[e.jsx(ns,{className:"h-4 w-4"}),"Add Word"]})}),e.jsxs(me,{className:"sm:max-w-[600px]",children:[e.jsxs(je,{children:[e.jsxs(pe,{className:"flex items-center gap-2",children:[e.jsx(Ie,{className:"h-5 w-5"}),"Create New Word"]}),e.jsx(ge,{children:"Add a new vocabulary word with translation and example sentence."})]}),e.jsx(Ee,{...w,children:e.jsxs("form",{onSubmit:w.handleSubmit(t),className:"space-y-6",children:[e.jsxs("div",{className:"grid gap-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(D,{control:w.control,name:"word",render:({field:n})=>e.jsxs(E,{children:[e.jsx(F,{children:"Word *"}),e.jsx(k,{children:e.jsx(H,{placeholder:"e.g., hello",...n})}),e.jsx(T,{})]})}),e.jsx(D,{control:w.control,name:"translation",render:({field:n})=>e.jsxs(E,{children:[e.jsx(F,{children:"Translation *"}),e.jsx(k,{children:e.jsx(H,{placeholder:"e.g., salom",...n})}),e.jsx(T,{})]})})]}),e.jsx(D,{control:w.control,name:"example_sentence",render:({field:n})=>e.jsxs(E,{children:[e.jsx(F,{children:"Example Sentence *"}),e.jsx(k,{children:e.jsx(Fe,{placeholder:"Hello, how are you?",className:"min-h-[80px]",...n})}),e.jsx(T,{})]})}),x&&e.jsx("div",{className:"grid gap-4",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"text-sm font-medium text-green-600",children:"âœ“ Word Created! Add Media (Optional)"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("span",{className:"text-sm font-medium",children:"Word Audio"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(ie,{value:l,onValueChange:o,children:[e.jsx(de,{className:"w-48",children:e.jsx(ce,{})}),e.jsxs(xe,{children:[e.jsx(M,{value:"Betty",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{children:"ðŸ‡ºðŸ‡¸"}),"Betty"]})}),e.jsx(M,{value:"default",children:"Default"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(Le,{onGenerate:()=>b.words.generateAudio(x,l==="default"?null:l),queryKey:["words",s],children:[e.jsx(ye,{className:"h-4 w-4 mr-2"}),"Generate"]}),e.jsxs(Se,{accept:"audio/mp3,audio/mpeg,audio/*",onUpload:n=>b.words.uploadAudio(x,n),queryKey:["words",s],children:[e.jsx(Q,{className:"h-4 w-4 mr-2"}),"Upload Audio"]})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("span",{className:"text-sm font-medium",children:"Word Image"}),e.jsxs(Se,{accept:"image/jpeg,image/png,image/jpg,image/*",onUpload:n=>b.words.uploadImage(x,n),queryKey:["words",s],children:[e.jsx(Me,{className:"h-4 w-4 mr-2"}),"Upload Image"]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("span",{className:"text-sm font-medium",children:"Example Audio"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(ie,{value:i,onValueChange:u,children:[e.jsx(de,{className:"w-48",children:e.jsx(ce,{})}),e.jsxs(xe,{children:[e.jsx(M,{value:"Betty",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{children:"ðŸ‡ºðŸ‡¸"}),"Betty"]})}),e.jsx(M,{value:"default",children:"Default"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(Le,{onGenerate:()=>b.words.generateExampleAudio(x,i==="default"?null:i),queryKey:["words",s],children:[e.jsx(ye,{className:"h-4 w-4 mr-2"}),"Generate"]}),e.jsxs(Se,{accept:"audio/mp3,audio/mpeg,audio/*",onUpload:n=>b.words.uploadExampleAudio(x,n),queryKey:["words",s],children:[e.jsx(Q,{className:"h-4 w-4 mr-2"}),"Upload Audio"]})]})]})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Media upload is optional. You can add or update media files later by editing the word."})]})})]}),e.jsxs(ve,{children:[e.jsx(N,{type:"button",variant:"outline",onClick:()=>g(!1),children:x?"Done":"Cancel"}),!x&&e.jsx(N,{type:"submit",disabled:_.isPending,className:"min-w-[120px]",children:_.isPending?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),"Creating..."]}):"Create Word"})]})]})})]})]})}const jt=_e({word:$().min(1,"Word is required"),translation:$().min(1,"Translation is required"),example_sentence:$().min(1,"Example sentence is required")});function pt({word:s,open:y,onOpenChange:p,onSuccess:v}){const g=G(),x=Ae({resolver:De(jt),defaultValues:{word:"",translation:"",example_sentence:""}}),r=V({mutationFn:o=>{if(!s)throw new Error("No word selected");return b.words.update(s.id,o)},onSuccess:()=>{C.success("Word updated successfully"),g.invalidateQueries({queryKey:["words",s?.lesson_id]}),p(!1),v?.()},onError:o=>{C.error("Failed to update word"),console.error("Update word error:",o)}});m.useEffect(()=>{s&&x.reset({word:s.word,translation:s.translation,example_sentence:s.example_sentence})},[s,x]);const l=o=>{r.mutate(o)};return s?e.jsx(he,{open:y,onOpenChange:p,children:e.jsxs(me,{className:"sm:max-w-[600px]",children:[e.jsxs(je,{children:[e.jsxs(pe,{className:"flex items-center gap-2",children:[e.jsx(we,{className:"h-5 w-5"}),"Edit Word"]}),e.jsx(ge,{children:"Update the word information, translation, and example sentence."})]}),e.jsx(Ee,{...x,children:e.jsxs("form",{onSubmit:x.handleSubmit(l),className:"space-y-6",children:[e.jsxs("div",{className:"grid gap-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(D,{control:x.control,name:"word",render:({field:o})=>e.jsxs(E,{children:[e.jsx(F,{children:"Word *"}),e.jsx(k,{children:e.jsx(H,{placeholder:"e.g., hello",...o})}),e.jsx(T,{})]})}),e.jsx(D,{control:x.control,name:"translation",render:({field:o})=>e.jsxs(E,{children:[e.jsx(F,{children:"Translation *"}),e.jsx(k,{children:e.jsx(H,{placeholder:"e.g., salom",...o})}),e.jsx(T,{})]})})]}),e.jsx(D,{control:x.control,name:"example_sentence",render:({field:o})=>e.jsxs(E,{children:[e.jsx(F,{children:"Example Sentence *"}),e.jsx(k,{children:e.jsx(Fe,{placeholder:"Hello, how are you?",className:"min-h-[80px]",...o})}),e.jsx(T,{})]})}),e.jsx("div",{className:"grid gap-4",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"text-sm font-medium text-muted-foreground",children:"Media Management"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium",children:"Word Audio"}),s?.audio_url&&e.jsx(N,{type:"button",variant:"ghost",size:"sm",onClick:()=>{new Audio(Ne(s.audio_url)).play().catch(console.error)},children:e.jsx(ue,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(Le,{onGenerate:()=>b.words.generateAudio(s.id,null),queryKey:["words",s?.lesson_id],children:[e.jsx(ye,{className:"h-4 w-4 mr-2"}),"Generate"]}),e.jsxs(Se,{accept:"audio/mp3,audio/mpeg,audio/*",onUpload:o=>b.words.uploadAudio(s.id,o),queryKey:["words",s?.lesson_id],children:[e.jsx(Q,{className:"h-4 w-4 mr-2"}),"Upload Audio"]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium",children:"Word Image"}),s?.image_url&&e.jsx(N,{type:"button",variant:"ghost",size:"sm",onClick:()=>window.open(Ne(s.image_url),"_blank"),children:e.jsx(Me,{className:"h-4 w-4"})})]}),e.jsxs(Se,{accept:"image/jpeg,image/png,image/jpg,image/*",onUpload:o=>b.words.uploadImage(s.id,o),queryKey:["words",s?.lesson_id],children:[e.jsx(Me,{className:"h-4 w-4 mr-2"}),s?.image_url?"Replace Image":"Upload Image"]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium",children:"Example Audio"}),s?.example_audio&&e.jsx(N,{type:"button",variant:"ghost",size:"sm",onClick:()=>{new Audio(Ne(s.example_audio)).play().catch(console.error)},children:e.jsx(ue,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(Le,{onGenerate:()=>b.words.generateExampleAudio(s.id,null),queryKey:["words",s?.lesson_id],children:[e.jsx(ye,{className:"h-4 w-4 mr-2"}),"Generate"]}),e.jsxs(Se,{accept:"audio/mp3,audio/mpeg,audio/*",onUpload:o=>b.words.uploadExampleAudio(s.id,o),queryKey:["words",s?.lesson_id],children:[e.jsx(Q,{className:"h-4 w-4 mr-2"}),"Upload Audio"]})]})]})]})})]}),e.jsxs(ve,{children:[e.jsx(N,{type:"button",variant:"outline",onClick:()=>p(!1),children:"Cancel"}),e.jsx(N,{type:"submit",disabled:r.isPending,className:"min-w-[120px]",children:r.isPending?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),"Updating..."]}):"Update Word"})]})]})})]})}):null}function gt({data:s,isLoading:y,onEdit:p,onRefresh:v,lessonId:g}){const[x,r]=m.useState(!1),[l,o]=m.useState(null),i=G(),u=[...new Set(s.filter(d=>d.word_lesson_id).map(d=>d.word_lesson_id))],{data:f}=te({queryKey:["word-lessons-by-ids",u],queryFn:async()=>u.length===0?[]:await Promise.all(u.map(P=>b.lessons.get(P))),enabled:u.length>0}),w=new Map(f?.map(d=>[d.id,d])||[]),_=V({mutationFn:d=>b.stories.delete(d),onSuccess:d=>{C.success(d.message),i.invalidateQueries({queryKey:["stories"]}),v(),r(!1),o(null)},onError:d=>{C.error("Failed to delete story"),console.error("Delete error:",d)}}),t=d=>{o(d),r(!0)},h=()=>{l&&_.mutate(l.id)},n=d=>{if(d){const P=Ne(d);P&&new Audio(P).play().catch(S=>{console.error("Error playing audio:",S),C.error("Failed to play audio")})}};return y?e.jsxs(Z,{children:[e.jsxs(X,{children:[e.jsx(Y,{children:"Stories"}),e.jsx(J,{children:"Loading..."})]}),e.jsx(ee,{children:e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})})})]}):s.length===0?e.jsxs(Z,{children:[e.jsxs(X,{children:[e.jsx(Y,{children:"Stories"}),e.jsx(J,{children:"No stories found"})]}),e.jsx(ee,{children:e.jsxs("div",{className:"flex flex-col items-center justify-center py-8",children:[e.jsx(Ue,{className:"h-12 w-12 text-muted-foreground mb-4"}),e.jsxs("p",{className:"text-muted-foreground text-center",children:["No stories have been created yet.",e.jsx("br",{}),'Click "Add Story" to get started.']})]})})]}):e.jsxs(e.Fragment,{children:[e.jsxs(Z,{className:"border-0 shadow-lg bg-gradient-to-br from-card via-card to-card/95",children:[e.jsx(X,{className:"pb-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs(Y,{className:"text-xl font-semibold flex items-center gap-2",children:[e.jsx(Ue,{className:"h-5 w-5 text-primary"}),"Stories (",s.length,")"]}),e.jsx(J,{className:"mt-1",children:"Manage story content for this lesson"})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"Total Stories"}),e.jsx("div",{className:"text-2xl font-bold text-primary",children:s.length})]})]})}),e.jsx(ee,{children:e.jsxs(Qe,{children:[e.jsx($e,{children:e.jsxs(oe,{children:[e.jsx(O,{children:"Story Text"}),e.jsx(O,{children:"Word Lesson"}),e.jsx(O,{children:"Audio"}),e.jsx(O,{className:"w-[70px]",children:"Actions"})]})}),e.jsx(He,{children:s.map(d=>e.jsxs(oe,{children:[e.jsx(U,{className:"max-w-[500px]",children:e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"text-sm text-muted-foreground",style:{display:"-webkit-box",WebkitLineClamp:3,WebkitBoxOrient:"vertical",overflow:"hidden"},title:d.story_text,children:d.story_text}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:["ID: #",d.id," â€¢ ",d.story_text.length," characters"]})]})}),e.jsx(U,{children:d.word_lesson_id?e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(ne,{variant:"secondary",className:"text-xs",children:w.get(d.word_lesson_id)?.title||`Lesson #${d.word_lesson_id}`})}):e.jsx(ne,{variant:"outline",className:"text-xs text-muted-foreground",children:"No connection"})}),e.jsx(U,{children:e.jsx("div",{className:"flex items-center gap-2",children:d.audio_url?e.jsx(N,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0",onClick:()=>n(d.audio_url),title:"Play story audio",children:e.jsx(ue,{className:"h-4 w-4 text-blue-600"})}):e.jsx(ne,{variant:"outline",className:"text-xs",children:"No audio"})})}),e.jsx(U,{children:e.jsxs(Be,{children:[e.jsx(Ke,{asChild:!0,children:e.jsxs(N,{variant:"ghost",className:"h-8 w-8 p-0",children:[e.jsx("span",{className:"sr-only",children:"Open menu"}),e.jsx(Ze,{className:"h-4 w-4"})]})}),e.jsxs(Ge,{align:"end",children:[e.jsx(Ve,{children:"Actions"}),e.jsxs(ae,{onClick:()=>p(d),children:[e.jsx(we,{className:"mr-2 h-4 w-4"}),"Edit"]}),e.jsxs(ae,{onClick:()=>t(d),className:"text-red-600",children:[e.jsx(Re,{className:"mr-2 h-4 w-4"}),"Delete"]})]})]})})]},d.id))})]})})]}),e.jsx(ze,{open:x,onOpenChange:r,title:"Delete Story",desc:"Are you sure you want to delete this story? This action cannot be undone.",confirmText:"Delete",handleConfirm:h,isLoading:_.isPending})]})}function js({title:s,description:y,accept:p,maxSize:v=10,onUpload:g,children:x,queryKey:r}){const[l,o]=m.useState(!1),[i,u]=m.useState(null),[f,w]=m.useState(!1),_=m.useRef(null),t=G(),h=V({mutationFn:()=>{if(!i)throw new Error("No file selected");return g(i)},onSuccess:A=>{C.success(A.message),r&&t.invalidateQueries({queryKey:r}),u(null),o(!1)},onError:A=>{C.error("Failed to upload file"),console.error("File upload error:",A)}}),n=A=>{if(A.size>v*1024*1024){C.error(`File size must be less than ${v}MB`);return}u(A)},d=A=>{A.preventDefault(),w(!1);const I=Array.from(A.dataTransfer.files);I.length>0&&n(I[0])},P=A=>{A.preventDefault(),w(!0)},z=A=>{A.preventDefault(),w(!1)},S=A=>{const I=Array.from(A.target.files||[]);I.length>0&&n(I[0])},j=()=>{h.mutate()},L=()=>p.includes("image")?e.jsx(nt,{className:"h-8 w-8"}):p.includes("audio")?e.jsx(tt,{className:"h-8 w-8"}):e.jsx(Q,{className:"h-8 w-8"}),be=A=>{if(A===0)return"0 Bytes";const I=1024,le=["Bytes","KB","MB","GB"],c=Math.floor(Math.log(A)/Math.log(I));return parseFloat((A/Math.pow(I,c)).toFixed(2))+" "+le[c]};return e.jsxs(he,{open:l,onOpenChange:o,children:[e.jsx(Xe,{asChild:!0,children:x||e.jsxs(N,{variant:"outline",size:"sm",children:[e.jsx(Q,{className:"h-4 w-4 mr-2"}),"Upload File"]})}),e.jsxs(me,{className:"sm:max-w-[500px]",children:[e.jsxs(je,{children:[e.jsxs(pe,{className:"flex items-center gap-2",children:[e.jsx(Q,{className:"h-5 w-5"}),s]}),e.jsx(ge,{children:y})]}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsx("div",{className:`border-2 border-dashed rounded-lg p-8 text-center transition-colors ${f?"border-primary bg-primary/5":"border-muted-foreground/25 hover:border-primary/50"}`,onDrop:d,onDragOver:P,onDragLeave:z,children:i?e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"flex items-center justify-center text-green-600",children:L()}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"font-medium",children:i.name}),e.jsx("p",{className:"text-sm text-muted-foreground",children:be(i.size)})]}),e.jsxs(N,{variant:"outline",size:"sm",onClick:()=>u(null),children:[e.jsx(hs,{className:"h-4 w-4 mr-2"}),"Remove"]})]}):e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"flex items-center justify-center text-muted-foreground",children:L()}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"font-medium",children:"Drop your file here"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["or click to browse (max ",v,"MB)"]})]}),e.jsx(N,{variant:"outline",onClick:()=>_.current?.click(),children:"Browse Files"})]})}),e.jsx("input",{ref:_,type:"file",accept:p,onChange:S,className:"hidden"})]}),e.jsxs(ve,{children:[e.jsx(N,{type:"button",variant:"outline",onClick:()=>o(!1),children:"Cancel"}),e.jsx(N,{type:"button",onClick:j,disabled:!i||h.isPending,className:"min-w-[120px]",children:h.isPending?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),"Uploading..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Q,{className:"h-4 w-4 mr-2"}),"Upload"]})})]})]})]})}const ft=_e({story_text:$().min(1,"Story text is required"),word_lesson_id:Oe().optional()});function Nt({lessonId:s,chapterId:y,children:p,onSuccess:v}){const[g,x]=m.useState(!1),[r,l]=m.useState(null),[o,i]=m.useState(""),[u,f]=m.useState("Betty"),w=G(),{data:_,isLoading:t}=te({queryKey:["word-lessons",y],queryFn:async()=>y?(await b.lessons.listByChapter(y)).filter(j=>j.lesson_type==="word"&&j.id!==s):[],enabled:!!y&&g}),h=_?.filter(S=>S.title.toLowerCase().includes(o.toLowerCase()))||[],n=Ae({resolver:De(ft),defaultValues:{story_text:"",word_lesson_id:void 0}}),d=V({mutationFn:S=>b.stories.create({...S,lesson_id:s,audio_url:null,word_lesson_id:S.word_lesson_id}),onSuccess:S=>{C.success("Story created successfully"),w.invalidateQueries({queryKey:["stories",s]}),l(S.id),n.reset(),v?.()},onError:S=>{C.error("Failed to create story"),console.error("Create story error:",S)}}),P=S=>{d.mutate(S)},z=S=>{x(S),S||(l(null),i(""),f("Betty"),n.reset())};return e.jsxs(he,{open:g,onOpenChange:z,children:[e.jsx(Xe,{asChild:!0,children:p||e.jsxs(N,{children:[e.jsx(ns,{className:"h-4 w-4"}),"Add Story"]})}),e.jsxs(me,{className:"sm:max-w-[600px]",children:[e.jsxs(je,{children:[e.jsxs(pe,{className:"flex items-center gap-2",children:[e.jsx(Ue,{className:"h-5 w-5"}),"Create New Story"]}),e.jsx(ge,{children:"Add a new story to this lesson with engaging content."})]}),e.jsx(Ee,{...n,children:e.jsxs("form",{onSubmit:n.handleSubmit(P),className:"space-y-6",children:[e.jsxs("div",{className:"grid gap-4",children:[e.jsx(D,{control:n.control,name:"story_text",render:({field:S})=>e.jsxs(E,{children:[e.jsx(F,{children:"Story Content *"}),e.jsx(k,{children:e.jsx(Fe,{placeholder:"Once upon a time, there was a young student learning English...",className:"min-h-[200px]",...S})}),e.jsx(T,{})]})}),e.jsx(D,{control:n.control,name:"word_lesson_id",render:({field:S})=>e.jsxs(E,{children:[e.jsx(F,{children:"Connect to Word Lesson (Optional)"}),e.jsxs(ie,{onValueChange:j=>S.onChange(j==="none"?void 0:Number(j)),value:S.value?String(S.value):void 0,children:[e.jsx(k,{children:e.jsx(de,{children:e.jsx(ce,{placeholder:"Select a word lesson to connect..."})})}),e.jsxs(xe,{children:[e.jsx("div",{className:"p-2",children:e.jsxs("div",{className:"relative",children:[e.jsx(as,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground h-4 w-4"}),e.jsx(H,{placeholder:"Search word lessons...",value:o,onChange:j=>i(j.target.value),className:"pl-10"})]})}),e.jsx(M,{value:"none",children:"No word lesson connection"}),t?e.jsx("div",{className:"p-2 text-center text-sm text-muted-foreground",children:"Loading word lessons..."}):h.length>0?h.map(j=>e.jsx(M,{value:String(j.id),children:j.title},j.id)):e.jsx("div",{className:"p-2 text-center text-sm text-muted-foreground",children:o?"No word lessons found matching your search":"No word lessons available"})]})]}),e.jsx(T,{}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Connect this story to a specific word lesson to reinforce vocabulary learning."})]})}),r&&e.jsx("div",{className:"grid gap-4",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"text-sm font-medium text-green-600",children:"âœ“ Story Created! Add Audio (Optional)"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("span",{className:"text-sm font-medium",children:"Story Narration"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(ie,{value:u,onValueChange:f,children:[e.jsx(de,{className:"w-48",children:e.jsx(ce,{})}),e.jsxs(xe,{children:[e.jsx(M,{value:"Betty",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{children:"ðŸ‡ºðŸ‡¸"}),"Betty"]})}),e.jsx(M,{value:"default",children:"Default"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(Le,{onGenerate:()=>b.stories.generateAudio(r,u==="default"?null:u),queryKey:["stories",s],children:[e.jsx(ye,{className:"h-4 w-4 mr-2"}),"Generate"]}),e.jsx(js,{title:"Upload Story Audio",description:"Upload an MP3 audio file for story narration.",accept:"audio/mp3,audio/mpeg",onUpload:S=>b.stories.uploadAudio(r,S),queryKey:["stories",s],children:e.jsxs(N,{type:"button",variant:"outline",size:"sm",children:[e.jsx(Q,{className:"h-4 w-4 mr-2"}),"Upload"]})})]})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Generate AI narration or upload your own audio file for this story."})]})]})})]}),e.jsxs(ve,{children:[e.jsx(N,{type:"button",variant:"outline",onClick:()=>x(!1),children:r?"Done":"Cancel"}),!r&&e.jsx(N,{type:"submit",disabled:d.isPending,className:"min-w-[120px]",children:d.isPending?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),"Creating..."]}):"Create Story"})]})]})})]})]})}const yt=_e({story_text:$().min(1,"Story text is required"),word_lesson_id:Oe().optional()});function wt({story:s,chapterId:y,open:p,onOpenChange:v,onSuccess:g}){const[x,r]=m.useState(""),l=G(),{data:o,isLoading:i}=te({queryKey:["word-lessons",y],queryFn:async()=>y?(await b.lessons.listByChapter(y)).filter(h=>h.lesson_type==="word"&&h.id!==s?.lesson_id):[],enabled:!!y&&p}),u=o?.filter(t=>t.title.toLowerCase().includes(x.toLowerCase()))||[],f=Ae({resolver:De(yt),defaultValues:{story_text:"",word_lesson_id:void 0}}),w=V({mutationFn:t=>{if(!s)throw new Error("No story selected");return b.stories.update(s.id,t)},onSuccess:()=>{C.success("Story updated successfully"),l.invalidateQueries({queryKey:["stories",s?.lesson_id]}),v(!1),g?.()},onError:t=>{C.error("Failed to update story"),console.error("Update story error:",t)}});m.useEffect(()=>{s&&f.reset({story_text:s.story_text,word_lesson_id:s.word_lesson_id})},[s,f]);const _=t=>{w.mutate(t)};return s?e.jsx(he,{open:p,onOpenChange:v,children:e.jsxs(me,{className:"sm:max-w-[600px]",children:[e.jsxs(je,{children:[e.jsxs(pe,{className:"flex items-center gap-2",children:[e.jsx(we,{className:"h-5 w-5"}),"Edit Story"]}),e.jsx(ge,{children:"Update the story content and narration."})]}),e.jsx(Ee,{...f,children:e.jsxs("form",{onSubmit:f.handleSubmit(_),className:"space-y-6",children:[e.jsxs("div",{className:"grid gap-4",children:[e.jsx(D,{control:f.control,name:"story_text",render:({field:t})=>e.jsxs(E,{children:[e.jsx(F,{children:"Story Content *"}),e.jsx(k,{children:e.jsx(Fe,{placeholder:"Once upon a time, there was a young student learning English...",className:"min-h-[200px]",...t})}),e.jsx(T,{})]})}),e.jsx(D,{control:f.control,name:"word_lesson_id",render:({field:t})=>e.jsxs(E,{children:[e.jsx(F,{children:"Connect to Word Lesson (Optional)"}),e.jsxs(ie,{onValueChange:h=>t.onChange(h==="none"?void 0:Number(h)),value:t.value?String(t.value):void 0,children:[e.jsx(k,{children:e.jsx(de,{children:e.jsx(ce,{placeholder:"Select a word lesson to connect..."})})}),e.jsxs(xe,{children:[e.jsx("div",{className:"p-2",children:e.jsxs("div",{className:"relative",children:[e.jsx(as,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground h-4 w-4"}),e.jsx(H,{placeholder:"Search word lessons...",value:x,onChange:h=>r(h.target.value),className:"pl-10"})]})}),e.jsx(M,{value:"none",children:"No word lesson connection"}),i?e.jsx("div",{className:"p-2 text-center text-sm text-muted-foreground",children:"Loading word lessons..."}):u.length>0?u.map(h=>e.jsx(M,{value:String(h.id),children:h.title},h.id)):e.jsx("div",{className:"p-2 text-center text-sm text-muted-foreground",children:x?"No word lessons found matching your search":"No word lessons available"})]})]}),e.jsx(T,{}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Connect this story to a specific word lesson to reinforce vocabulary learning."})]})}),e.jsx("div",{className:"grid gap-4",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"text-sm font-medium text-muted-foreground",children:"Audio Management"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium",children:"Story Narration"}),s?.audio_url&&e.jsx(N,{type:"button",variant:"ghost",size:"sm",onClick:()=>{new Audio(Ne(s.audio_url)).play().catch(console.error)},children:e.jsx(ue,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(Le,{onGenerate:()=>b.stories.generateAudio(s.id,null),queryKey:["stories",s?.lesson_id],children:[e.jsx(ye,{className:"h-4 w-4 mr-2"}),"Generate"]}),e.jsx(js,{title:"Upload Story Audio",description:"Upload an MP3 audio file for story narration.",accept:"audio/mp3,audio/mpeg",onUpload:t=>b.stories.uploadAudio(s.id,t),queryKey:["stories",s?.lesson_id],children:e.jsxs(N,{type:"button",variant:"outline",size:"sm",children:[e.jsx(Q,{className:"h-4 w-4 mr-2"}),"Upload"]})})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Generate AI narration or upload your own audio file for this story."})]})]})})]}),e.jsxs(ve,{children:[e.jsx(N,{type:"button",variant:"outline",onClick:()=>v(!1),children:"Cancel"}),e.jsx(N,{type:"submit",disabled:w.isPending,className:"min-w-[120px]",children:w.isPending?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),"Updating..."]}):"Update Story"})]})]})})]})}):null}function vt(){const s=()=>{const a=new URLSearchParams(window.location.search);return{courseId:a.get("courseId")?Number(a.get("courseId")):void 0,chapterId:a.get("chapterId")?Number(a.get("chapterId")):void 0,lessonId:a.get("lessonId")?Number(a.get("lessonId")):void 0,tab:a.get("tab")||"courses"}},y=a=>{const K=new URLSearchParams(window.location.search);Object.entries(a).forEach(([cs,rs])=>{rs==null?K.delete(cs):K.set(cs,String(rs))});const fe=`${window.location.pathname}?${K.toString()}`;window.history.pushState({},"",fe)},[p,v]=m.useState(null),[g,x]=m.useState(null),[r,l]=m.useState(null),[o,i]=m.useState(!1),[u,f]=m.useState(!1),[w,_]=m.useState(!1),[t,h]=m.useState(!1),[n,d]=m.useState(null),[P,z]=m.useState(!1),[S,j]=m.useState(null),[L,be]=m.useState(""),[A,I]=m.useState("courses"),{data:le=[],isLoading:c,refetch:B}=te({queryKey:["courses"],queryFn:()=>b.courses.list()}),q=p?.id,{data:W=[],isLoading:se,refetch:R}=te({queryKey:["chapters",q],queryFn:()=>b.chapters.listByCourse(q),enabled:!!q}),ke=g?.id,{data:Pe=[],isLoading:ps,refetch:gs}=te({queryKey:["lessons",ke],queryFn:()=>b.lessons.listByChapter(ke),enabled:!!ke}),Ce=r?.id,{data:fs=[],isLoading:Ns,refetch:ys}=te({queryKey:["words",Ce],queryFn:()=>b.words.listByLesson(Ce),enabled:!!Ce}),{data:ws=[],isLoading:vs,refetch:bs}=te({queryKey:["stories",Ce],queryFn:()=>b.stories.listByLesson(Ce),enabled:!!Ce});m.useEffect(()=>{const a=s();I(a.tab)},[]),m.useEffect(()=>{const a=s();if(le.length>0&&a.courseId){const K=le.find(fe=>fe.id===a.courseId);K&&v(K)}},[le]),m.useEffect(()=>{const a=s();if(W.length>0&&a.chapterId){const K=W.find(fe=>fe.id===a.chapterId);K&&x(K)}},[W]),m.useEffect(()=>{const a=s();if(Pe.length>0&&a.lessonId){const K=Pe.find(fe=>fe.id===a.lessonId);K&&l(K)}},[Pe]);const Cs=a=>{v(a),i(!0)},Ss=a=>{x(a),f(!0)},Ls=a=>{l(a),_(!0)},_s=a=>{d(a),h(!0)},As=a=>{j(a),z(!0)},Ds=a=>{if(a.lesson_type==="test")return;l(a);const K=a.lesson_type==="word"?"words":a.lesson_type==="story"?"story":"words";I(K),y({lessonId:a.id,tab:K})},Es=a=>{v(a),I("chapters"),y({courseId:a.id,chapterId:void 0,lessonId:void 0,tab:"chapters"})},Fs=a=>{x(a),I("lessons"),y({chapterId:a.id,lessonId:void 0,tab:"lessons"})},Ye=()=>{B()},Je=()=>{R()},es=()=>{gs()},ss=()=>{ys()},ts=()=>{bs()},ls=le.filter(a=>a.title.toLowerCase().includes(L.toLowerCase())||a.native_language.toLowerCase().includes(L.toLowerCase())||a.learning_language.toLowerCase().includes(L.toLowerCase())),os=W.filter(a=>a.title.toLowerCase().includes(L.toLowerCase())),is=Pe.filter(a=>a.title.toLowerCase().includes(L.toLowerCase())||a.content.toLowerCase().includes(L.toLowerCase())),ds=fs.filter(a=>a.word.toLowerCase().includes(L.toLowerCase())||a.translation.toLowerCase().includes(L.toLowerCase())||a.example_sentence.toLowerCase().includes(L.toLowerCase())),ks=ws.filter(a=>a.story_text.toLowerCase().includes(L.toLowerCase()));return e.jsxs(e.Fragment,{children:[e.jsxs(Ks,{children:[e.jsx(Ts,{links:bt}),e.jsxs("div",{className:"ms-auto flex items-center space-x-4",children:[e.jsx(Gs,{}),e.jsx(Vs,{})]})]}),e.jsxs(qs,{children:[e.jsx("div",{className:"mb-6 flex flex-col gap-4 md:flex-row md:items-center md:justify-between",children:e.jsxs("div",{className:"space-y-1",children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight bg-gradient-to-r from-primary to-primary/70 bg-clip-text text-transparent",children:"Zehnly Duo Management"}),e.jsx("p",{className:"text-muted-foreground text-lg",children:"Complete language learning content management system"})]})}),e.jsx("div",{className:"mb-6",children:e.jsx(H,{placeholder:"Search across all content...",value:L,onChange:a=>be(a.target.value),className:"max-w-sm"})}),e.jsxs(Us,{value:A,onValueChange:a=>{I(a),y({tab:a})},className:"space-y-6",children:[e.jsxs(Ps,{className:"grid w-full grid-cols-5",children:[e.jsxs(Te,{value:"courses",className:"flex items-center gap-2",children:[e.jsx(et,{className:"h-4 w-4"}),"Courses (",ls.length,")"]}),e.jsxs(Te,{value:"chapters",className:"flex items-center gap-2",children:[e.jsx(Ue,{className:"h-4 w-4"}),"Chapters (",os.length,")"]}),e.jsxs(Te,{value:"lessons",className:"flex items-center gap-2",children:[e.jsx(re,{className:"h-4 w-4"}),"Lessons (",is.length,")"]}),e.jsxs(Te,{value:"words",className:"flex items-center gap-2",children:[e.jsx(Ie,{className:"h-4 w-4"}),"Words (",ds.length,")"]}),e.jsxs(Te,{value:"story",className:"flex items-center gap-2",children:[e.jsx(Ue,{className:"h-4 w-4"}),"Story Content"]})]}),e.jsxs(qe,{value:"courses",className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-2xl font-semibold",children:"Courses"}),e.jsx(Rs,{onSuccess:Ye,children:e.jsxs(N,{children:[e.jsx(We,{className:"mr-2 h-4 w-4"}),"Add Course"]})})]}),e.jsx(at,{data:ls,isLoading:c,onEdit:Cs,onCourseClick:Es,onRefresh:Ye,selectedCourse:p})]}),e.jsxs(qe,{value:"chapters",className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-semibold",children:"Chapters"}),p&&e.jsxs("p",{className:"text-muted-foreground",children:[p.title," â€¢ ",p.native_language," â†’ ",p.learning_language]})]}),p&&e.jsx(Hs,{courseId:p.id,onSuccess:Je,children:e.jsxs(N,{children:[e.jsx(We,{className:"mr-2 h-4 w-4"}),"Add Chapter"]})})]}),p?e.jsx(Zs,{data:os,isLoading:se,onEdit:Ss,onChapterClick:Fs,onRefresh:Je,selectedChapter:g}):e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"Select a course from the Courses tab to view its chapters"})]}),e.jsxs(qe,{value:"lessons",className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-semibold",children:"Lessons"}),g&&e.jsxs("p",{className:"text-muted-foreground",children:[g.title," â€¢ Order ",g.order]})]}),g&&e.jsx(it,{chapterId:g.id,onSuccess:es,children:e.jsxs(N,{children:[e.jsx(We,{className:"mr-2 h-4 w-4"}),"Add Lesson"]})})]}),g?e.jsx(lt,{data:is,isLoading:ps,onEdit:Ls,onLessonClick:Ds,onRefresh:es,selectedLesson:r}):e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"Select a chapter from the Chapters tab to view its lessons"})]}),e.jsxs(qe,{value:"words",className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-semibold",children:"Words"}),r&&e.jsxs("p",{className:"text-muted-foreground",children:[r.title," â€¢ ",r.lesson_type," lesson â€¢ Order ",r.order]})]}),r&&e.jsx(mt,{lessonId:r.id,onSuccess:ss,children:e.jsxs(N,{children:[e.jsx(We,{className:"mr-2 h-4 w-4"}),"Add Word"]})})]}),r?e.jsx(ut,{data:ds,isLoading:Ns,onEdit:_s,onRefresh:ss,lessonId:r.id}):e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"Select a lesson from the Lessons tab to view its vocabulary words"})]}),e.jsxs(qe,{value:"story",className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-semibold",children:"Story Management"}),r&&e.jsxs("p",{className:"text-muted-foreground",children:[r.title," â€¢ Story lesson â€¢ Order ",r.order]})]}),r&&r.lesson_type==="story"&&g&&e.jsx(Nt,{lessonId:r.id,chapterId:g.id,onSuccess:ts,children:e.jsxs(N,{children:[e.jsx(We,{className:"mr-2 h-4 w-4"}),"Add Story"]})})]}),r&&r.lesson_type==="story"?e.jsx(gt,{data:ks,isLoading:vs,onEdit:As,onRefresh:ts,lessonId:r.id}):e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"Select a story lesson from the Lessons tab to manage its stories"})]})]})]}),e.jsx(Qs,{course:p,open:o,onOpenChange:i,onSuccess:Ye}),e.jsx(Xs,{chapter:g,open:u,onOpenChange:f,onSuccess:Je}),e.jsx(ct,{lesson:r,open:w,onOpenChange:_,onSuccess:es}),e.jsx(pt,{word:n,open:t,onOpenChange:h,onSuccess:ss}),e.jsx(wt,{story:S,chapterId:g?.id,open:P,onOpenChange:z,onSuccess:ts})]})}const bt=[{title:"Zehnly Duo",href:"/zehnly-duo",isActive:!0,disabled:!1}],Xt=vt;export{Xt as component};

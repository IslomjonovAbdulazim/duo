import{r as h,f as U,j as e,B as x,t as v,o as ue,s as M,n as Ze,_ as is}from"./index-BZy3F_hY.js";import{u as O,T as Ae,a as Ee,b as H,c as L,d as Te,e as _,E as ke,S as ee,f as qe,F as je,g as D,h as F,i as A,j as E,k as T,l as ce,m as As,M as Es}from"./table-8jJIXZOX.js";import{C as W,b as P,c as K,d as z,e as B,u as pe,a as ge,I as G}from"./card-BHaA6RoO.js";import{T as fe,a as Ts,b as ks,c as ye,d as we}from"./textarea-CP4sjhmo.js";import{H as qs,S as Us,T as Os,C as Is,P as Ms}from"./config-drawer-DB2N_wK3.js";import{c as w,C as ss,b as Y,F as be}from"./content-api-BUtLuLVY.js";import{U as Ws,C as Ps,E as Ks}from"./upload-course-logo-dialog-D6pzL8Pn.js";import{M as Q,A as zs,s as Bs,t as Gs,D as Ue,j as Oe,k as Ie,l as Me,n as V,N as We,O as se,Q as Pe,R as te,T as re,U as ae,V as ne,W as le,X as Rs,Y as _e,Z as J,_ as Qs,$ as Vs}from"./sign-out-dialog-BE13U0RL.js";import{g as $s}from"./media-utils-Cpm_6zhn.js";import{U as I}from"./upload-BHH2W6tB.js";import{C as Hs,a as Zs,E as Xs}from"./chapters-table-BLWW3RFj.js";import{B as De}from"./badge-DfwYUQkb.js";import{S as Xe,a as Ye,b as Je,c as es,d as X}from"./select-BOtA9b2C.js";import{V as me}from"./volume-2-CWGIMSHx.js";import{I as Fe}from"./image-B5lNZ-no.js";import{c as os}from"./createLucideIcon-cOgFtlW0.js";import{P as ve}from"./plus-BHfmr8Lx.js";import"./loader-circle-CCm-xBy1.js";/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ys=[["path",{d:"M17.5 22h.5a2 2 0 0 0 2-2V7l-5-5H6a2 2 0 0 0-2 2v3",key:"rslqgf"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M2 19a2 2 0 1 1 4 0v1a2 2 0 1 1-4 0v-4a6 6 0 0 1 12 0v4a2 2 0 1 1-4 0v-1a2 2 0 1 1 4 0",key:"9f7x3i"}]],Js=os("file-audio",Ys);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const et=[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["circle",{cx:"10",cy:"12",r:"2",key:"737tya"}],["path",{d:"m20 17-1.296-1.296a2.41 2.41 0 0 0-3.408 0L9 22",key:"wt3hpn"}]],st=os("file-image",et);function tt({data:s,isLoading:y,onEdit:c,onCourseClick:N,onRefresh:m,selectedCourse:l}){const[n,o]=h.useState(!1),[t,d]=h.useState(!1),[u,g]=h.useState(null),[i,r]=h.useState(null),p=U(),b=O({mutationFn:f=>w.courses.delete(f),onSuccess:f=>{v.success(f.message),p.invalidateQueries({queryKey:["courses"]}),m(),o(!1),g(null)},onError:f=>{v.error("Failed to delete course"),console.error("Delete error:",f)}}),j=(f,C)=>{C.stopPropagation(),g(f),o(!0)},R=(f,C)=>{C.stopPropagation(),c(f)},$=(f,C)=>{C.stopPropagation(),r(f),d(!0)},ie=()=>{u&&b.mutate(u.id)},Ne=()=>{p.invalidateQueries({queryKey:["courses"]}),m(),d(!1),r(null)};return y?e.jsxs(W,{children:[e.jsxs(P,{children:[e.jsx(K,{children:"Courses"}),e.jsx(z,{children:"Loading..."})]}),e.jsx(B,{children:e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})})})]}):s.length===0?e.jsxs(W,{children:[e.jsxs(P,{children:[e.jsx(K,{children:"Courses"}),e.jsx(z,{children:"No courses found"})]}),e.jsx(B,{children:e.jsxs("div",{className:"flex flex-col items-center justify-center py-8",children:[e.jsx(Q,{className:"h-12 w-12 text-muted-foreground mb-4"}),e.jsxs("p",{className:"text-muted-foreground text-center",children:["No courses have been created yet.",e.jsx("br",{}),'Click "Add Course" to get started.']})]})})]}):e.jsxs(e.Fragment,{children:[e.jsxs(W,{className:"border-0 shadow-lg bg-gradient-to-br from-card via-card to-card/95",children:[e.jsx(P,{className:"pb-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs(K,{className:"text-xl font-semibold flex items-center gap-2",children:[e.jsx(Q,{className:"h-5 w-5 text-primary"}),"Courses (",s.length,")"]}),e.jsx(z,{className:"mt-1",children:"Click on a course to view its chapters"})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"Total Courses"}),e.jsx("div",{className:"text-2xl font-bold text-primary",children:s.length})]})]})}),e.jsx(B,{children:e.jsxs(Ae,{children:[e.jsx(Ee,{children:e.jsxs(H,{children:[e.jsx(L,{children:"Course"}),e.jsx(L,{children:"Languages"}),e.jsx(L,{children:"Logo"}),e.jsx(L,{className:"w-[70px]",children:"Actions"})]})}),e.jsx(Te,{children:s.map(f=>e.jsxs(H,{className:`cursor-pointer transition-colors hover:bg-muted/50 ${l?.id===f.id?"bg-muted":""}`,onClick:()=>N(f),children:[e.jsx(_,{className:"max-w-[350px]",children:e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"font-medium truncate",title:f.title,children:f.title}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:["ID: #",f.id]})]})}),e.jsx(_,{className:"max-w-[200px]",children:e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx("span",{className:"font-medium text-blue-600",children:f.native_language}),e.jsx("span",{className:"text-muted-foreground",children:"→"}),e.jsx("span",{className:"font-medium text-green-600",children:f.learning_language})]}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Native → Target"})]})}),e.jsx(_,{children:e.jsxs("div",{className:"flex items-center gap-3",children:[f.logo_url?e.jsxs("div",{className:"relative",children:[e.jsxs(zs,{className:"h-10 w-10 border-2 border-green-200",children:[e.jsx(Bs,{src:$s(f.logo_url),alt:f.title}),e.jsx(Gs,{className:"bg-green-50",children:e.jsx(Q,{className:"h-5 w-5 text-green-600"})})]}),e.jsx("div",{className:"absolute -bottom-1 -right-1 w-3 h-3 bg-green-500 rounded-full border-2 border-white"})]}):e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"h-10 w-10 rounded-full bg-gray-100 border-2 border-gray-200 flex items-center justify-center",children:e.jsx(Q,{className:"h-5 w-5 text-gray-400"})}),e.jsx("div",{className:"absolute -bottom-1 -right-1 w-3 h-3 bg-gray-300 rounded-full border-2 border-white"})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:`text-xs font-medium ${f.logo_url?"text-green-600":"text-gray-500"}`,children:f.logo_url?"✓ Logo uploaded":"○ No logo"}),e.jsx("span",{className:"text-[10px] text-muted-foreground",children:f.logo_url?"Ready to display":"Upload recommended"})]})]})}),e.jsx(_,{children:e.jsxs(Ue,{children:[e.jsx(Oe,{asChild:!0,children:e.jsxs(x,{variant:"ghost",className:"h-8 w-8 p-0",onClick:C=>C.stopPropagation(),children:[e.jsx("span",{className:"sr-only",children:"Open menu"}),e.jsx(ke,{className:"h-4 w-4"})]})}),e.jsxs(Ie,{align:"end",children:[e.jsx(Me,{children:"Actions"}),e.jsxs(V,{onClick:C=>$(f,C),children:[e.jsx(I,{className:"mr-2 h-4 w-4"}),"Upload Logo"]}),e.jsxs(V,{onClick:C=>R(f,C),children:[e.jsx(ee,{className:"mr-2 h-4 w-4"}),"Edit"]}),e.jsxs(V,{onClick:C=>j(f,C),className:"text-red-600",children:[e.jsx(qe,{className:"mr-2 h-4 w-4"}),"Delete"]})]})]})})]},f.id))})]})})]}),e.jsx(We,{open:n,onOpenChange:o,title:"Delete Course",desc:`Are you sure you want to delete "${u?.title}"? This action cannot be undone and will also delete all associated lessons and words.`,confirmText:"Delete",handleConfirm:ie,isLoading:b.isPending}),i&&e.jsx(Ws,{open:t,onOpenChange:d,course:i,onSuccess:Ne})]})}function rt({data:s,isLoading:y,onEdit:c,onLessonClick:N,onRefresh:m,selectedLesson:l}){const[n,o]=h.useState(!1),[t,d]=h.useState(null),u=U(),g=O({mutationFn:j=>w.lessons.delete(j),onSuccess:j=>{v.success(j.message),u.invalidateQueries({queryKey:["lessons"]}),m(),o(!1),d(null)},onError:j=>{v.error("Failed to delete lesson"),console.error("Delete error:",j)}}),i=j=>{d(j),o(!0)},r=()=>{t&&g.mutate(t.id)},p=j=>{switch(j){case"word":return"bg-blue-100 text-blue-800 hover:bg-blue-100";case"story":return"bg-purple-100 text-purple-800 hover:bg-purple-100";case"test":return"bg-orange-100 text-orange-800 hover:bg-orange-100";default:return"bg-gray-100 text-gray-800 hover:bg-gray-100"}};if(y)return e.jsxs(W,{children:[e.jsxs(P,{children:[e.jsx(K,{children:"Lessons"}),e.jsx(z,{children:"Loading..."})]}),e.jsx(B,{children:e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})})})]});if(s.length===0)return e.jsxs(W,{children:[e.jsxs(P,{children:[e.jsx(K,{children:"Lessons"}),e.jsx(z,{children:"No lessons found"})]}),e.jsx(B,{children:e.jsxs("div",{className:"flex flex-col items-center justify-center py-8",children:[e.jsx(Q,{className:"h-12 w-12 text-muted-foreground mb-4"}),e.jsxs("p",{className:"text-muted-foreground text-center",children:["No lessons have been created yet.",e.jsx("br",{}),'Click "Add Lesson" to get started.']})]})})]});const b=[...s].sort((j,R)=>j.order-R.order);return e.jsxs(e.Fragment,{children:[e.jsxs(W,{className:"border-0 shadow-lg bg-gradient-to-br from-card via-card to-card/95",children:[e.jsx(P,{className:"pb-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs(K,{className:"text-xl font-semibold flex items-center gap-2",children:[e.jsx(Q,{className:"h-5 w-5 text-primary"}),"Lessons (",b.length,")"]}),e.jsx(z,{className:"mt-1",children:"Manage chapter lessons and their content"})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"Total Lessons"}),e.jsx("div",{className:"text-2xl font-bold text-primary",children:b.length})]})]})}),e.jsx(B,{children:e.jsxs(Ae,{children:[e.jsx(Ee,{children:e.jsxs(H,{children:[e.jsx(L,{children:"Order"}),e.jsx(L,{children:"Lesson Title"}),e.jsx(L,{children:"Type"}),e.jsx(L,{children:"Content"}),e.jsx(L,{className:"w-[70px]",children:"Actions"})]})}),e.jsx(Te,{children:b.map(j=>{const R=l?.id===j.id,$=j.lesson_type==="test";return e.jsxs(H,{className:`transition-colors ${$?"cursor-not-allowed opacity-70":"cursor-pointer hover:bg-muted/50"} ${R?"bg-muted border-l-4 border-l-primary":""}`,onClick:()=>!$&&N?.(j),children:[e.jsx(_,{children:e.jsx(De,{variant:"outline",className:"w-8 h-8 rounded-full flex items-center justify-center p-0",children:j.order})}),e.jsx(_,{className:"max-w-[300px]",children:e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"font-medium truncate",title:j.title,children:j.title}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:["ID: #",j.id]})]})}),e.jsx(_,{children:e.jsx(De,{variant:"secondary",className:p(j.lesson_type),children:j.lesson_type.charAt(0).toUpperCase()+j.lesson_type.slice(1)})}),e.jsx(_,{className:"max-w-[400px]",children:e.jsx("p",{className:"text-sm text-muted-foreground truncate",title:j.content,children:j.content})}),e.jsx(_,{children:e.jsxs(Ue,{children:[e.jsx(Oe,{asChild:!0,children:e.jsxs(x,{variant:"ghost",className:"h-8 w-8 p-0",children:[e.jsx("span",{className:"sr-only",children:"Open menu"}),e.jsx(ke,{className:"h-4 w-4"})]})}),e.jsxs(Ie,{align:"end",children:[e.jsx(Me,{children:"Actions"}),e.jsxs(V,{onClick:()=>c(j),children:[e.jsx(ee,{className:"mr-2 h-4 w-4"}),"Edit"]}),e.jsxs(V,{onClick:()=>i(j),className:"text-red-600",children:[e.jsx(qe,{className:"mr-2 h-4 w-4"}),"Delete"]})]})]})})]},j.id)})})]})})]}),e.jsx(We,{open:n,onOpenChange:o,title:"Delete Lesson",desc:`Are you sure you want to delete "${t?.title}"? This action cannot be undone.`,confirmText:"Delete",handleConfirm:r,isLoading:g.isPending})]})}const at=ue({title:M().min(1,"Lesson title is required"),lesson_type:is(["word","story"]),order:Ze().min(1,"Order must be at least 1"),content:M().min(1,"Content is required")});function nt({chapterId:s,children:y,onSuccess:c}){const[N,m]=h.useState(!1),l=U(),n=pe({resolver:ge(at),defaultValues:{title:"",lesson_type:"word",order:1,content:""}}),o=O({mutationFn:d=>w.lessons.create({...d,chapter_id:s}),onSuccess:()=>{v.success("Lesson created successfully"),l.invalidateQueries({queryKey:["lessons",s]}),n.reset(),m(!1),c?.()},onError:d=>{v.error("Failed to create lesson"),console.error("Create lesson error:",d)}}),t=d=>{o.mutate(d)};return e.jsxs(se,{open:N,onOpenChange:m,children:[e.jsx(Pe,{asChild:!0,children:y||e.jsxs(x,{children:[e.jsx(ss,{className:"h-4 w-4"}),"Add Lesson"]})}),e.jsxs(te,{className:"sm:max-w-[600px]",children:[e.jsxs(re,{children:[e.jsxs(ae,{className:"flex items-center gap-2",children:[e.jsx(Q,{className:"h-5 w-5"}),"Create New Lesson"]}),e.jsx(ne,{children:"Add a new lesson to this chapter with content and exercises."})]}),e.jsx(je,{...n,children:e.jsxs("form",{onSubmit:n.handleSubmit(t),className:"space-y-6",children:[e.jsxs("div",{className:"grid gap-4",children:[e.jsx(D,{control:n.control,name:"title",render:({field:d})=>e.jsxs(F,{children:[e.jsx(A,{children:"Lesson Title *"}),e.jsx(E,{children:e.jsx(G,{placeholder:"e.g., Hello and Goodbye",...d})}),e.jsx(T,{})]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(D,{control:n.control,name:"lesson_type",render:({field:d})=>e.jsxs(F,{children:[e.jsx(A,{children:"Lesson Type *"}),e.jsxs(Xe,{onValueChange:d.onChange,defaultValue:d.value,children:[e.jsx(E,{children:e.jsx(Ye,{children:e.jsx(Je,{placeholder:"Select lesson type"})})}),e.jsxs(es,{children:[e.jsx(X,{value:"word",children:"Word"}),e.jsx(X,{value:"story",children:"Story"}),e.jsx(X,{value:"test",children:"Test"})]})]}),e.jsx(T,{})]})}),e.jsx(D,{control:n.control,name:"order",render:({field:d})=>e.jsxs(F,{children:[e.jsx(A,{children:"Order *"}),e.jsx(E,{children:e.jsx(G,{type:"number",min:"1",placeholder:"1",...d,onChange:u=>d.onChange(parseInt(u.target.value)||1)})}),e.jsx(T,{})]})})]}),e.jsx(D,{control:n.control,name:"content",render:({field:d})=>e.jsxs(F,{children:[e.jsx(A,{children:"Content *"}),e.jsx(E,{children:e.jsx(fe,{placeholder:"In this lesson we learn basic greetings...",className:"min-h-[120px]",...d})}),e.jsx(T,{})]})})]}),e.jsxs(le,{children:[e.jsx(x,{type:"button",variant:"outline",onClick:()=>m(!1),children:"Cancel"}),e.jsx(x,{type:"submit",disabled:o.isPending,className:"min-w-[120px]",children:o.isPending?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),"Creating..."]}):"Create Lesson"})]})]})})]})]})}const lt=ue({title:M().min(1,"Lesson title is required"),lesson_type:is(["word","story","test"]),order:Ze().min(1,"Order must be at least 1"),content:M().min(1,"Content is required"),word_lesson_id:Ze().optional()});function it({lesson:s,open:y,onOpenChange:c,onSuccess:N}){const m=U(),[l,n]=h.useState(""),o=pe({resolver:ge(lt),defaultValues:{title:"",lesson_type:"word",order:1,content:"",word_lesson_id:void 0}}),t=o.watch("lesson_type"),{data:d,isLoading:u}=ce({queryKey:["word-lessons",s?.chapter_id],queryFn:async()=>s?.chapter_id?(await w.lessons.listByChapter(s.chapter_id)).filter(b=>b.lesson_type==="word"&&b.id!==s?.id):[],enabled:t==="test"&&!!s&&y}),g=d?.filter(p=>p.title.toLowerCase().includes(l.toLowerCase()))||[],i=O({mutationFn:p=>{if(!s)throw new Error("No lesson selected");return w.lessons.update(s.id,p)},onSuccess:()=>{v.success("Lesson updated successfully"),m.invalidateQueries({queryKey:["lessons",s?.chapter_id]}),c(!1),N?.()},onError:p=>{v.error("Failed to update lesson"),console.error("Update lesson error:",p)}});h.useEffect(()=>{s&&o.reset({title:s.title,lesson_type:s.lesson_type,order:s.order,content:s.content,word_lesson_id:s.word_lesson_id})},[s,o]);const r=p=>{i.mutate(p)};return s?e.jsx(se,{open:y,onOpenChange:c,children:e.jsxs(te,{className:"sm:max-w-[600px]",children:[e.jsxs(re,{children:[e.jsxs(ae,{className:"flex items-center gap-2",children:[e.jsx(ee,{className:"h-5 w-5"}),"Edit Lesson"]}),e.jsx(ne,{children:"Update the lesson information, type, and content."})]}),e.jsx(je,{...o,children:e.jsxs("form",{onSubmit:o.handleSubmit(r),className:"space-y-6",children:[e.jsxs("div",{className:"grid gap-4",children:[e.jsx(D,{control:o.control,name:"title",render:({field:p})=>e.jsxs(F,{children:[e.jsx(A,{children:"Lesson Title *"}),e.jsx(E,{children:e.jsx(G,{placeholder:"e.g., Hello and Goodbye",...p})}),e.jsx(T,{})]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(D,{control:o.control,name:"lesson_type",render:({field:p})=>e.jsxs(F,{children:[e.jsx(A,{children:"Lesson Type *"}),e.jsxs(Xe,{onValueChange:p.onChange,value:p.value,children:[e.jsx(E,{children:e.jsx(Ye,{children:e.jsx(Je,{placeholder:"Select lesson type"})})}),e.jsxs(es,{children:[e.jsx(X,{value:"word",children:"Word"}),e.jsx(X,{value:"story",children:"Story"}),e.jsx(X,{value:"test",children:"Test"})]})]}),e.jsx(T,{})]})}),e.jsx(D,{control:o.control,name:"order",render:({field:p})=>e.jsxs(F,{children:[e.jsx(A,{children:"Order *"}),e.jsx(E,{children:e.jsx(G,{type:"number",min:"1",placeholder:"1",...p,onChange:b=>p.onChange(parseInt(b.target.value)||1)})}),e.jsx(T,{})]})})]}),t==="test"&&e.jsx(D,{control:o.control,name:"word_lesson_id",render:({field:p})=>e.jsxs(F,{children:[e.jsx(A,{children:"Connect to Word Lesson *"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"relative",children:[e.jsx(Rs,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),e.jsx(G,{placeholder:"Search word lessons...",value:l,onChange:b=>n(b.target.value),className:"pl-10"})]}),e.jsxs(Xe,{onValueChange:b=>p.onChange(parseInt(b)),value:p.value?.toString(),disabled:u,children:[e.jsx(E,{children:e.jsx(Ye,{children:e.jsx(Je,{placeholder:"Select a word lesson to connect"})})}),e.jsxs(es,{className:"max-h-60",children:[g.map(b=>e.jsx(X,{value:b.id.toString(),children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Q,{className:"h-4 w-4 text-muted-foreground"}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{children:b.title}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:["Order: ",b.order]})]})]})},b.id)),g.length===0&&!u&&e.jsx("div",{className:"p-2 text-sm text-muted-foreground text-center",children:l?"No word lessons found matching your search":"No word lessons available"})]})]})]}),e.jsx(T,{})]})}),e.jsx(D,{control:o.control,name:"content",render:({field:p})=>e.jsxs(F,{children:[e.jsx(A,{children:"Content *"}),e.jsx(E,{children:e.jsx(fe,{placeholder:"In this lesson we learn basic greetings...",className:"min-h-[120px]",...p})}),e.jsx(T,{})]})})]}),e.jsxs(le,{children:[e.jsx(x,{type:"button",variant:"outline",onClick:()=>c(!1),children:"Cancel"}),e.jsx(x,{type:"submit",disabled:i.isPending,className:"min-w-[120px]",children:i.isPending?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),"Updating..."]}):"Update Lesson"})]})]})})]})}):null}function ot({data:s,isLoading:y,onEdit:c,onRefresh:N}){const[m,l]=h.useState(!1),[n,o]=h.useState(null),t=U(),d=O({mutationFn:r=>w.words.delete(r),onSuccess:r=>{v.success(r.message),t.invalidateQueries({queryKey:["words"]}),N(),l(!1),o(null)},onError:r=>{v.error("Failed to delete word"),console.error("Delete error:",r)}}),u=r=>{o(r),l(!0)},g=()=>{n&&d.mutate(n.id)},i=r=>{if(r){const p=Y(r);p&&new Audio(p).play().catch(j=>{console.error("Error playing audio:",j),v.error("Failed to play audio")})}};return y?e.jsxs(W,{children:[e.jsxs(P,{children:[e.jsx(K,{children:"Words"}),e.jsx(z,{children:"Loading..."})]}),e.jsx(B,{children:e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})})})]}):s.length===0?e.jsxs(W,{children:[e.jsxs(P,{children:[e.jsx(K,{children:"Words"}),e.jsx(z,{children:"No words found"})]}),e.jsx(B,{children:e.jsxs("div",{className:"flex flex-col items-center justify-center py-8",children:[e.jsx(_e,{className:"h-12 w-12 text-muted-foreground mb-4"}),e.jsxs("p",{className:"text-muted-foreground text-center",children:["No words have been created yet.",e.jsx("br",{}),'Click "Add Word" to get started.']})]})})]}):e.jsxs(e.Fragment,{children:[e.jsxs(W,{className:"border-0 shadow-lg bg-gradient-to-br from-card via-card to-card/95",children:[e.jsx(P,{className:"pb-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs(K,{className:"text-xl font-semibold flex items-center gap-2",children:[e.jsx(_e,{className:"h-5 w-5 text-primary"}),"Words (",s.length,")"]}),e.jsx(z,{className:"mt-1",children:"Manage vocabulary words and their translations"})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"Total Words"}),e.jsx("div",{className:"text-2xl font-bold text-primary",children:s.length})]})]})}),e.jsx(B,{children:e.jsxs(Ae,{children:[e.jsx(Ee,{children:e.jsxs(H,{children:[e.jsx(L,{children:"Word"}),e.jsx(L,{children:"Translation"}),e.jsx(L,{children:"Example"}),e.jsx(L,{children:"Media"}),e.jsx(L,{className:"w-[70px]",children:"Actions"})]})}),e.jsx(Te,{children:s.map(r=>e.jsxs(H,{children:[e.jsx(_,{className:"max-w-[200px]",children:e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"font-medium truncate",title:r.word,children:r.word}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:["ID: #",r.id]})]})}),e.jsx(_,{className:"max-w-[200px]",children:e.jsx("div",{className:"font-medium text-green-600 truncate",title:r.translation,children:r.translation})}),e.jsx(_,{className:"max-w-[300px]",children:e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-sm text-muted-foreground truncate",title:r.example_sentence,children:r.example_sentence}),r.example_audio&&e.jsxs(x,{variant:"ghost",size:"sm",className:"h-6 px-2 text-xs",onClick:()=>i(r.example_audio),children:[e.jsx(me,{className:"h-3 w-3 mr-1"}),"Play Example"]})]})}),e.jsx(_,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[r.audio_url&&e.jsx(x,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0",onClick:()=>i(r.audio_url),title:"Play audio",children:e.jsx(me,{className:"h-4 w-4 text-blue-600"})}),r.image_url&&e.jsx(x,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0",onClick:()=>window.open(Y(r.image_url),"_blank"),title:"View image",children:e.jsx(Fe,{className:"h-4 w-4 text-green-600"})}),!r.audio_url&&!r.image_url&&e.jsx(De,{variant:"outline",className:"text-xs",children:"No media"})]})}),e.jsx(_,{children:e.jsxs(Ue,{children:[e.jsx(Oe,{asChild:!0,children:e.jsxs(x,{variant:"ghost",className:"h-8 w-8 p-0",children:[e.jsx("span",{className:"sr-only",children:"Open menu"}),e.jsx(ke,{className:"h-4 w-4"})]})}),e.jsxs(Ie,{align:"end",children:[e.jsx(Me,{children:"Actions"}),e.jsxs(V,{onClick:()=>c(r),children:[e.jsx(ee,{className:"mr-2 h-4 w-4"}),"Edit"]}),e.jsxs(V,{onClick:()=>u(r),className:"text-red-600",children:[e.jsx(qe,{className:"mr-2 h-4 w-4"}),"Delete"]})]})]})})]},r.id))})]})})]}),e.jsx(We,{open:m,onOpenChange:l,title:"Delete Word",desc:`Are you sure you want to delete "${n?.word}"? This action cannot be undone.`,confirmText:"Delete",handleConfirm:g,isLoading:d.isPending})]})}function he({onGenerate:s,children:y,queryKey:c,disabled:N=!1}){const m=U(),l=O({mutationFn:s,onSuccess:o=>{v.success(o.message||"Audio generated successfully"),c&&m.invalidateQueries({queryKey:c})},onError:o=>{v.error("Failed to generate audio"),console.error("Audio generation error:",o)}}),n=()=>{l.mutate()};return e.jsx(x,{type:"button",variant:"outline",size:"sm",onClick:n,disabled:N||l.isPending,className:"flex items-center gap-2",children:l.isPending?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-current"}),"Generating..."]}):y||e.jsxs(e.Fragment,{children:[e.jsx(J,{className:"h-4 w-4"}),"Generate"]})})}function xe({onUpload:s,accept:y,children:c,queryKey:N,disabled:m=!1}){const l=h.useRef(null),n=U(),o=O({mutationFn:async u=>{console.log("Starting upload for file:",u.name,"Size:",u.size,"Type:",u.type);try{const g=await s(u);return console.log("Upload successful:",g),g}catch(g){throw console.error("Upload failed:",g),g}},onSuccess:u=>{console.log("Upload success handler:",u),v.success(u.message||"File uploaded successfully"),N&&n.invalidateQueries({queryKey:N})},onError:u=>{console.error("Upload error handler:",u);const g=u?.response?.data?.detail||u?.message||"Failed to upload file";v.error(g)}}),t=u=>{const g=u.target.files?.[0];if(g){if(g.size>10*1024*1024){v.error("File size must be less than 10MB");return}o.mutate(g)}u.target.value=""},d=()=>{l.current?.click()};return e.jsxs(e.Fragment,{children:[e.jsx(x,{type:"button",variant:"outline",size:"sm",onClick:d,disabled:m||o.isPending,className:"flex items-center gap-2",children:o.isPending?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-current"}),"Uploading..."]}):c||e.jsxs(e.Fragment,{children:[e.jsx(I,{className:"h-4 w-4"}),"Upload"]})}),e.jsx("input",{ref:l,type:"file",accept:y,onChange:t,className:"hidden"})]})}const dt=ue({word:M().min(1,"Word is required"),translation:M().min(1,"Translation is required"),example_sentence:M().min(1,"Example sentence is required")});function ct({lessonId:s,children:y,onSuccess:c}){const[N,m]=h.useState(!1),[l,n]=h.useState(null),o=U(),t=pe({resolver:ge(dt),defaultValues:{word:"",translation:"",example_sentence:""}}),d=O({mutationFn:i=>w.words.create({...i,lesson_id:s,audio_url:null,image_url:null,example_audio:null}),onSuccess:i=>{v.success("Word created successfully"),o.invalidateQueries({queryKey:["words",s]}),n(i.id),t.reset(),c?.()},onError:i=>{v.error("Failed to create word"),console.error("Create word error:",i)}}),u=i=>{d.mutate(i)},g=i=>{m(i),i||(n(null),t.reset())};return e.jsxs(se,{open:N,onOpenChange:g,children:[e.jsx(Pe,{asChild:!0,children:y||e.jsxs(x,{children:[e.jsx(ss,{className:"h-4 w-4"}),"Add Word"]})}),e.jsxs(te,{className:"sm:max-w-[600px]",children:[e.jsxs(re,{children:[e.jsxs(ae,{className:"flex items-center gap-2",children:[e.jsx(_e,{className:"h-5 w-5"}),"Create New Word"]}),e.jsx(ne,{children:"Add a new vocabulary word with translation and example sentence."})]}),e.jsx(je,{...t,children:e.jsxs("form",{onSubmit:t.handleSubmit(u),className:"space-y-6",children:[e.jsxs("div",{className:"grid gap-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(D,{control:t.control,name:"word",render:({field:i})=>e.jsxs(F,{children:[e.jsx(A,{children:"Word *"}),e.jsx(E,{children:e.jsx(G,{placeholder:"e.g., hello",...i})}),e.jsx(T,{})]})}),e.jsx(D,{control:t.control,name:"translation",render:({field:i})=>e.jsxs(F,{children:[e.jsx(A,{children:"Translation *"}),e.jsx(E,{children:e.jsx(G,{placeholder:"e.g., salom",...i})}),e.jsx(T,{})]})})]}),e.jsx(D,{control:t.control,name:"example_sentence",render:({field:i})=>e.jsxs(F,{children:[e.jsx(A,{children:"Example Sentence *"}),e.jsx(E,{children:e.jsx(fe,{placeholder:"Hello, how are you?",className:"min-h-[80px]",...i})}),e.jsx(T,{})]})}),l&&e.jsx("div",{className:"grid gap-4",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"text-sm font-medium text-green-600",children:"✓ Word Created! Add Media (Optional)"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("span",{className:"text-sm font-medium",children:"Word Audio"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(he,{onGenerate:()=>w.words.generateAudio(l,null),queryKey:["words",s],children:[e.jsx(J,{className:"h-4 w-4 mr-2"}),"Generate"]}),e.jsxs(xe,{accept:"audio/mp3,audio/mpeg,audio/*",onUpload:i=>w.words.uploadAudio(l,i),queryKey:["words",s],children:[e.jsx(I,{className:"h-4 w-4 mr-2"}),"Upload Audio"]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("span",{className:"text-sm font-medium",children:"Word Image"}),e.jsxs(xe,{accept:"image/jpeg,image/png,image/jpg,image/*",onUpload:i=>w.words.uploadImage(l,i),queryKey:["words",s],children:[e.jsx(Fe,{className:"h-4 w-4 mr-2"}),"Upload Image"]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("span",{className:"text-sm font-medium",children:"Example Audio"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(he,{onGenerate:()=>w.words.generateExampleAudio(l,null),queryKey:["words",s],children:[e.jsx(J,{className:"h-4 w-4 mr-2"}),"Generate"]}),e.jsxs(xe,{accept:"audio/mp3,audio/mpeg,audio/*",onUpload:i=>w.words.uploadExampleAudio(l,i),queryKey:["words",s],children:[e.jsx(I,{className:"h-4 w-4 mr-2"}),"Upload Audio"]})]})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Media upload is optional. You can add or update media files later by editing the word."})]})})]}),e.jsxs(le,{children:[e.jsx(x,{type:"button",variant:"outline",onClick:()=>m(!1),children:l?"Done":"Cancel"}),!l&&e.jsx(x,{type:"submit",disabled:d.isPending,className:"min-w-[120px]",children:d.isPending?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),"Creating..."]}):"Create Word"})]})]})})]})]})}const xt=ue({word:M().min(1,"Word is required"),translation:M().min(1,"Translation is required"),example_sentence:M().min(1,"Example sentence is required")});function mt({word:s,open:y,onOpenChange:c,onSuccess:N}){const m=U(),l=pe({resolver:ge(xt),defaultValues:{word:"",translation:"",example_sentence:""}}),n=O({mutationFn:t=>{if(!s)throw new Error("No word selected");return w.words.update(s.id,t)},onSuccess:()=>{v.success("Word updated successfully"),m.invalidateQueries({queryKey:["words",s?.lesson_id]}),c(!1),N?.()},onError:t=>{v.error("Failed to update word"),console.error("Update word error:",t)}});h.useEffect(()=>{s&&l.reset({word:s.word,translation:s.translation,example_sentence:s.example_sentence})},[s,l]);const o=t=>{n.mutate(t)};return s?e.jsx(se,{open:y,onOpenChange:c,children:e.jsxs(te,{className:"sm:max-w-[600px]",children:[e.jsxs(re,{children:[e.jsxs(ae,{className:"flex items-center gap-2",children:[e.jsx(ee,{className:"h-5 w-5"}),"Edit Word"]}),e.jsx(ne,{children:"Update the word information, translation, and example sentence."})]}),e.jsx(je,{...l,children:e.jsxs("form",{onSubmit:l.handleSubmit(o),className:"space-y-6",children:[e.jsxs("div",{className:"grid gap-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(D,{control:l.control,name:"word",render:({field:t})=>e.jsxs(F,{children:[e.jsx(A,{children:"Word *"}),e.jsx(E,{children:e.jsx(G,{placeholder:"e.g., hello",...t})}),e.jsx(T,{})]})}),e.jsx(D,{control:l.control,name:"translation",render:({field:t})=>e.jsxs(F,{children:[e.jsx(A,{children:"Translation *"}),e.jsx(E,{children:e.jsx(G,{placeholder:"e.g., salom",...t})}),e.jsx(T,{})]})})]}),e.jsx(D,{control:l.control,name:"example_sentence",render:({field:t})=>e.jsxs(F,{children:[e.jsx(A,{children:"Example Sentence *"}),e.jsx(E,{children:e.jsx(fe,{placeholder:"Hello, how are you?",className:"min-h-[80px]",...t})}),e.jsx(T,{})]})}),e.jsx("div",{className:"grid gap-4",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"text-sm font-medium text-muted-foreground",children:"Media Management"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium",children:"Word Audio"}),s?.audio_url&&e.jsx(x,{type:"button",variant:"ghost",size:"sm",onClick:()=>{new Audio(Y(s.audio_url)).play().catch(console.error)},children:e.jsx(me,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(he,{onGenerate:()=>w.words.generateAudio(s.id,null),queryKey:["words",s?.lesson_id],children:[e.jsx(J,{className:"h-4 w-4 mr-2"}),"Generate"]}),e.jsxs(xe,{accept:"audio/mp3,audio/mpeg,audio/*",onUpload:t=>w.words.uploadAudio(s.id,t),queryKey:["words",s?.lesson_id],children:[e.jsx(I,{className:"h-4 w-4 mr-2"}),"Upload Audio"]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium",children:"Word Image"}),s?.image_url&&e.jsx(x,{type:"button",variant:"ghost",size:"sm",onClick:()=>window.open(Y(s.image_url),"_blank"),children:e.jsx(Fe,{className:"h-4 w-4"})})]}),e.jsxs(xe,{accept:"image/jpeg,image/png,image/jpg,image/*",onUpload:t=>w.words.uploadImage(s.id,t),queryKey:["words",s?.lesson_id],children:[e.jsx(Fe,{className:"h-4 w-4 mr-2"}),s?.image_url?"Replace Image":"Upload Image"]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium",children:"Example Audio"}),s?.example_audio&&e.jsx(x,{type:"button",variant:"ghost",size:"sm",onClick:()=>{new Audio(Y(s.example_audio)).play().catch(console.error)},children:e.jsx(me,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(he,{onGenerate:()=>w.words.generateExampleAudio(s.id,null),queryKey:["words",s?.lesson_id],children:[e.jsx(J,{className:"h-4 w-4 mr-2"}),"Generate"]}),e.jsxs(xe,{accept:"audio/mp3,audio/mpeg,audio/*",onUpload:t=>w.words.uploadExampleAudio(s.id,t),queryKey:["words",s?.lesson_id],children:[e.jsx(I,{className:"h-4 w-4 mr-2"}),"Upload Audio"]})]})]})]})})]}),e.jsxs(le,{children:[e.jsx(x,{type:"button",variant:"outline",onClick:()=>c(!1),children:"Cancel"}),e.jsx(x,{type:"submit",disabled:n.isPending,className:"min-w-[120px]",children:n.isPending?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),"Updating..."]}):"Update Word"})]})]})})]})}):null}function ht({data:s,isLoading:y,onEdit:c,onRefresh:N}){const[m,l]=h.useState(!1),[n,o]=h.useState(null),t=U(),d=O({mutationFn:r=>w.stories.delete(r),onSuccess:r=>{v.success(r.message),t.invalidateQueries({queryKey:["stories"]}),N(),l(!1),o(null)},onError:r=>{v.error("Failed to delete story"),console.error("Delete error:",r)}}),u=r=>{o(r),l(!0)},g=()=>{n&&d.mutate(n.id)},i=r=>{if(r){const p=Y(r);p&&new Audio(p).play().catch(j=>{console.error("Error playing audio:",j),v.error("Failed to play audio")})}};return y?e.jsxs(W,{children:[e.jsxs(P,{children:[e.jsx(K,{children:"Stories"}),e.jsx(z,{children:"Loading..."})]}),e.jsx(B,{children:e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})})})]}):s.length===0?e.jsxs(W,{children:[e.jsxs(P,{children:[e.jsx(K,{children:"Stories"}),e.jsx(z,{children:"No stories found"})]}),e.jsx(B,{children:e.jsxs("div",{className:"flex flex-col items-center justify-center py-8",children:[e.jsx(be,{className:"h-12 w-12 text-muted-foreground mb-4"}),e.jsxs("p",{className:"text-muted-foreground text-center",children:["No stories have been created yet.",e.jsx("br",{}),'Click "Add Story" to get started.']})]})})]}):e.jsxs(e.Fragment,{children:[e.jsxs(W,{className:"border-0 shadow-lg bg-gradient-to-br from-card via-card to-card/95",children:[e.jsx(P,{className:"pb-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs(K,{className:"text-xl font-semibold flex items-center gap-2",children:[e.jsx(be,{className:"h-5 w-5 text-primary"}),"Stories (",s.length,")"]}),e.jsx(z,{className:"mt-1",children:"Manage story content for this lesson"})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"Total Stories"}),e.jsx("div",{className:"text-2xl font-bold text-primary",children:s.length})]})]})}),e.jsx(B,{children:e.jsxs(Ae,{children:[e.jsx(Ee,{children:e.jsxs(H,{children:[e.jsx(L,{children:"Story Text"}),e.jsx(L,{children:"Audio"}),e.jsx(L,{className:"w-[70px]",children:"Actions"})]})}),e.jsx(Te,{children:s.map(r=>e.jsxs(H,{children:[e.jsx(_,{className:"max-w-[500px]",children:e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"text-sm text-muted-foreground",style:{display:"-webkit-box",WebkitLineClamp:3,WebkitBoxOrient:"vertical",overflow:"hidden"},title:r.story_text,children:r.story_text}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:["ID: #",r.id," • ",r.story_text.length," characters"]})]})}),e.jsx(_,{children:e.jsx("div",{className:"flex items-center gap-2",children:r.audio_url?e.jsx(x,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0",onClick:()=>i(r.audio_url),title:"Play story audio",children:e.jsx(me,{className:"h-4 w-4 text-blue-600"})}):e.jsx(De,{variant:"outline",className:"text-xs",children:"No audio"})})}),e.jsx(_,{children:e.jsxs(Ue,{children:[e.jsx(Oe,{asChild:!0,children:e.jsxs(x,{variant:"ghost",className:"h-8 w-8 p-0",children:[e.jsx("span",{className:"sr-only",children:"Open menu"}),e.jsx(ke,{className:"h-4 w-4"})]})}),e.jsxs(Ie,{align:"end",children:[e.jsx(Me,{children:"Actions"}),e.jsxs(V,{onClick:()=>c(r),children:[e.jsx(ee,{className:"mr-2 h-4 w-4"}),"Edit"]}),e.jsxs(V,{onClick:()=>u(r),className:"text-red-600",children:[e.jsx(qe,{className:"mr-2 h-4 w-4"}),"Delete"]})]})]})})]},r.id))})]})})]}),e.jsx(We,{open:m,onOpenChange:l,title:"Delete Story",desc:"Are you sure you want to delete this story? This action cannot be undone.",confirmText:"Delete",handleConfirm:g,isLoading:d.isPending})]})}function ds({title:s,description:y,accept:c,maxSize:N=10,onUpload:m,children:l,queryKey:n}){const[o,t]=h.useState(!1),[d,u]=h.useState(null),[g,i]=h.useState(!1),r=h.useRef(null),p=U(),b=O({mutationFn:()=>{if(!d)throw new Error("No file selected");return m(d)},onSuccess:S=>{v.success(S.message),n&&p.invalidateQueries({queryKey:n}),u(null),t(!1)},onError:S=>{v.error("Failed to upload file"),console.error("File upload error:",S)}}),j=S=>{if(S.size>N*1024*1024){v.error(`File size must be less than ${N}MB`);return}u(S)},R=S=>{S.preventDefault(),i(!1);const q=Array.from(S.dataTransfer.files);q.length>0&&j(q[0])},$=S=>{S.preventDefault(),i(!0)},ie=S=>{S.preventDefault(),i(!1)},Ne=S=>{const q=Array.from(S.target.files||[]);q.length>0&&j(q[0])},f=()=>{b.mutate()},C=()=>c.includes("image")?e.jsx(st,{className:"h-8 w-8"}):c.includes("audio")?e.jsx(Js,{className:"h-8 w-8"}):e.jsx(I,{className:"h-8 w-8"}),Ke=S=>{if(S===0)return"0 Bytes";const q=1024,oe=["Bytes","KB","MB","GB"],Ce=Math.floor(Math.log(S)/Math.log(q));return parseFloat((S/Math.pow(q,Ce)).toFixed(2))+" "+oe[Ce]};return e.jsxs(se,{open:o,onOpenChange:t,children:[e.jsx(Pe,{asChild:!0,children:l||e.jsxs(x,{variant:"outline",size:"sm",children:[e.jsx(I,{className:"h-4 w-4 mr-2"}),"Upload File"]})}),e.jsxs(te,{className:"sm:max-w-[500px]",children:[e.jsxs(re,{children:[e.jsxs(ae,{className:"flex items-center gap-2",children:[e.jsx(I,{className:"h-5 w-5"}),s]}),e.jsx(ne,{children:y})]}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsx("div",{className:`border-2 border-dashed rounded-lg p-8 text-center transition-colors ${g?"border-primary bg-primary/5":"border-muted-foreground/25 hover:border-primary/50"}`,onDrop:R,onDragOver:$,onDragLeave:ie,children:d?e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"flex items-center justify-center text-green-600",children:C()}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"font-medium",children:d.name}),e.jsx("p",{className:"text-sm text-muted-foreground",children:Ke(d.size)})]}),e.jsxs(x,{variant:"outline",size:"sm",onClick:()=>u(null),children:[e.jsx(Qs,{className:"h-4 w-4 mr-2"}),"Remove"]})]}):e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"flex items-center justify-center text-muted-foreground",children:C()}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"font-medium",children:"Drop your file here"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["or click to browse (max ",N,"MB)"]})]}),e.jsx(x,{variant:"outline",onClick:()=>r.current?.click(),children:"Browse Files"})]})}),e.jsx("input",{ref:r,type:"file",accept:c,onChange:Ne,className:"hidden"})]}),e.jsxs(le,{children:[e.jsx(x,{type:"button",variant:"outline",onClick:()=>t(!1),children:"Cancel"}),e.jsx(x,{type:"button",onClick:f,disabled:!d||b.isPending,className:"min-w-[120px]",children:b.isPending?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),"Uploading..."]}):e.jsxs(e.Fragment,{children:[e.jsx(I,{className:"h-4 w-4 mr-2"}),"Upload"]})})]})]})]})}const ut=ue({story_text:M().min(1,"Story text is required")});function jt({lessonId:s,children:y,onSuccess:c}){const[N,m]=h.useState(!1),[l,n]=h.useState(null),o=U(),t=pe({resolver:ge(ut),defaultValues:{story_text:""}}),d=O({mutationFn:i=>w.stories.create({...i,lesson_id:s,audio_url:null}),onSuccess:i=>{v.success("Story created successfully"),o.invalidateQueries({queryKey:["stories",s]}),n(i.id),t.reset(),c?.()},onError:i=>{v.error("Failed to create story"),console.error("Create story error:",i)}}),u=i=>{d.mutate(i)},g=i=>{m(i),i||(n(null),t.reset())};return e.jsxs(se,{open:N,onOpenChange:g,children:[e.jsx(Pe,{asChild:!0,children:y||e.jsxs(x,{children:[e.jsx(ss,{className:"h-4 w-4"}),"Add Story"]})}),e.jsxs(te,{className:"sm:max-w-[600px]",children:[e.jsxs(re,{children:[e.jsxs(ae,{className:"flex items-center gap-2",children:[e.jsx(be,{className:"h-5 w-5"}),"Create New Story"]}),e.jsx(ne,{children:"Add a new story to this lesson with engaging content."})]}),e.jsx(je,{...t,children:e.jsxs("form",{onSubmit:t.handleSubmit(u),className:"space-y-6",children:[e.jsxs("div",{className:"grid gap-4",children:[e.jsx(D,{control:t.control,name:"story_text",render:({field:i})=>e.jsxs(F,{children:[e.jsx(A,{children:"Story Content *"}),e.jsx(E,{children:e.jsx(fe,{placeholder:"Once upon a time, there was a young student learning English...",className:"min-h-[200px]",...i})}),e.jsx(T,{})]})}),l&&e.jsx("div",{className:"grid gap-4",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"text-sm font-medium text-green-600",children:"✓ Story Created! Add Audio (Optional)"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("span",{className:"text-sm font-medium",children:"Story Narration"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(he,{onGenerate:()=>w.stories.generateAudio(l,null),queryKey:["stories",s],children:[e.jsx(J,{className:"h-4 w-4 mr-2"}),"Generate"]}),e.jsx(ds,{title:"Upload Story Audio",description:"Upload an MP3 audio file for story narration.",accept:"audio/mp3,audio/mpeg",onUpload:i=>w.stories.uploadAudio(l,i),queryKey:["stories",s],children:e.jsxs(x,{type:"button",variant:"outline",size:"sm",children:[e.jsx(I,{className:"h-4 w-4 mr-2"}),"Upload"]})})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Generate AI narration or upload your own audio file for this story."})]})]})})]}),e.jsxs(le,{children:[e.jsx(x,{type:"button",variant:"outline",onClick:()=>m(!1),children:l?"Done":"Cancel"}),!l&&e.jsx(x,{type:"submit",disabled:d.isPending,className:"min-w-[120px]",children:d.isPending?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),"Creating..."]}):"Create Story"})]})]})})]})]})}const pt=ue({story_text:M().min(1,"Story text is required")});function gt({story:s,open:y,onOpenChange:c,onSuccess:N}){const m=U(),l=pe({resolver:ge(pt),defaultValues:{story_text:""}}),n=O({mutationFn:t=>{if(!s)throw new Error("No story selected");return w.stories.update(s.id,t)},onSuccess:()=>{v.success("Story updated successfully"),m.invalidateQueries({queryKey:["stories",s?.lesson_id]}),c(!1),N?.()},onError:t=>{v.error("Failed to update story"),console.error("Update story error:",t)}});h.useEffect(()=>{s&&l.reset({story_text:s.story_text})},[s,l]);const o=t=>{n.mutate(t)};return s?e.jsx(se,{open:y,onOpenChange:c,children:e.jsxs(te,{className:"sm:max-w-[600px]",children:[e.jsxs(re,{children:[e.jsxs(ae,{className:"flex items-center gap-2",children:[e.jsx(ee,{className:"h-5 w-5"}),"Edit Story"]}),e.jsx(ne,{children:"Update the story content and narration."})]}),e.jsx(je,{...l,children:e.jsxs("form",{onSubmit:l.handleSubmit(o),className:"space-y-6",children:[e.jsxs("div",{className:"grid gap-4",children:[e.jsx(D,{control:l.control,name:"story_text",render:({field:t})=>e.jsxs(F,{children:[e.jsx(A,{children:"Story Content *"}),e.jsx(E,{children:e.jsx(fe,{placeholder:"Once upon a time, there was a young student learning English...",className:"min-h-[200px]",...t})}),e.jsx(T,{})]})}),e.jsx("div",{className:"grid gap-4",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"text-sm font-medium text-muted-foreground",children:"Audio Management"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium",children:"Story Narration"}),s?.audio_url&&e.jsx(x,{type:"button",variant:"ghost",size:"sm",onClick:()=>{new Audio(Y(s.audio_url)).play().catch(console.error)},children:e.jsx(me,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(he,{onGenerate:()=>w.stories.generateAudio(s.id,null),queryKey:["stories",s?.lesson_id],children:[e.jsx(J,{className:"h-4 w-4 mr-2"}),"Generate"]}),e.jsx(ds,{title:"Upload Story Audio",description:"Upload an MP3 audio file for story narration.",accept:"audio/mp3,audio/mpeg",onUpload:t=>w.stories.uploadAudio(s.id,t),queryKey:["stories",s?.lesson_id],children:e.jsxs(x,{type:"button",variant:"outline",size:"sm",children:[e.jsx(I,{className:"h-4 w-4 mr-2"}),"Upload"]})})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Generate AI narration or upload your own audio file for this story."})]})]})})]}),e.jsxs(le,{children:[e.jsx(x,{type:"button",variant:"outline",onClick:()=>c(!1),children:"Cancel"}),e.jsx(x,{type:"submit",disabled:n.isPending,className:"min-w-[120px]",children:n.isPending?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),"Updating..."]}):"Update Story"})]})]})})]})}):null}function ft(){const s=()=>{const a=new URLSearchParams(window.location.search);return{courseId:a.get("courseId")?Number(a.get("courseId")):void 0,chapterId:a.get("chapterId")?Number(a.get("chapterId")):void 0,lessonId:a.get("lessonId")?Number(a.get("lessonId")):void 0,tab:a.get("tab")||"courses"}},y=a=>{const k=new URLSearchParams(window.location.search);Object.entries(a).forEach(([ls,He])=>{He==null?k.delete(ls):k.set(ls,String(He))});const Z=`${window.location.pathname}?${k.toString()}`;window.history.pushState({},"",Z)},[c,N]=h.useState(null),[m,l]=h.useState(null),[n,o]=h.useState(null),[t,d]=h.useState(!1),[u,g]=h.useState(!1),[i,r]=h.useState(!1),[p,b]=h.useState(!1),[j,R]=h.useState(null),[$,ie]=h.useState(!1),[Ne,f]=h.useState(null),[C,Ke]=h.useState(""),[S,q]=h.useState("courses"),{data:oe=[],isLoading:Ce,refetch:cs}=ce({queryKey:["courses"],queryFn:()=>w.courses.list()}),ze=c?.id,{data:Se=[],isLoading:xs,refetch:ms}=ce({queryKey:["chapters",ze],queryFn:()=>w.chapters.listByCourse(ze),enabled:!!ze}),Be=m?.id,{data:Le=[],isLoading:hs,refetch:us}=ce({queryKey:["lessons",Be],queryFn:()=>w.lessons.listByChapter(Be),enabled:!!Be}),de=n?.id,{data:js=[],isLoading:ps,refetch:gs}=ce({queryKey:["words",de],queryFn:()=>w.words.listByLesson(de),enabled:!!de}),{data:fs=[],isLoading:Ns,refetch:ys}=ce({queryKey:["stories",de],queryFn:()=>w.stories.listByLesson(de),enabled:!!de});h.useEffect(()=>{const a=s();q(a.tab)},[]),h.useEffect(()=>{const a=s();if(oe.length>0&&a.courseId){const k=oe.find(Z=>Z.id===a.courseId);k&&N(k)}},[oe]),h.useEffect(()=>{const a=s();if(Se.length>0&&a.chapterId){const k=Se.find(Z=>Z.id===a.chapterId);k&&l(k)}},[Se]),h.useEffect(()=>{const a=s();if(Le.length>0&&a.lessonId){const k=Le.find(Z=>Z.id===a.lessonId);k&&o(k)}},[Le]);const ws=a=>{N(a),d(!0)},vs=a=>{l(a),g(!0)},bs=a=>{o(a),r(!0)},Cs=a=>{R(a),b(!0)},Ss=a=>{f(a),ie(!0)},Ls=a=>{if(a.lesson_type==="test")return;o(a);const k=a.lesson_type==="word"?"words":a.lesson_type==="story"?"story":"words";q(k),y({lessonId:a.id,tab:k})},_s=a=>{N(a),q("chapters"),y({courseId:a.id,chapterId:void 0,lessonId:void 0,tab:"chapters"})},Ds=a=>{l(a),q("lessons"),y({chapterId:a.id,lessonId:void 0,tab:"lessons"})},Ge=()=>{cs()},Re=()=>{ms()},Qe=()=>{us()},Ve=()=>{gs()},$e=()=>{ys()},ts=oe.filter(a=>a.title.toLowerCase().includes(C.toLowerCase())||a.native_language.toLowerCase().includes(C.toLowerCase())||a.learning_language.toLowerCase().includes(C.toLowerCase())),rs=Se.filter(a=>a.title.toLowerCase().includes(C.toLowerCase())),as=Le.filter(a=>a.title.toLowerCase().includes(C.toLowerCase())||a.content.toLowerCase().includes(C.toLowerCase())),ns=js.filter(a=>a.word.toLowerCase().includes(C.toLowerCase())||a.translation.toLowerCase().includes(C.toLowerCase())||a.example_sentence.toLowerCase().includes(C.toLowerCase())),Fs=fs.filter(a=>a.story_text.toLowerCase().includes(C.toLowerCase()));return e.jsxs(e.Fragment,{children:[e.jsxs(qs,{children:[e.jsx(As,{links:Nt}),e.jsxs("div",{className:"ms-auto flex items-center space-x-4",children:[e.jsx(Us,{}),e.jsx(Os,{}),e.jsx(Is,{}),e.jsx(Ms,{})]})]}),e.jsxs(Es,{children:[e.jsx("div",{className:"mb-6 flex flex-col gap-4 md:flex-row md:items-center md:justify-between",children:e.jsxs("div",{className:"space-y-1",children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight bg-gradient-to-r from-primary to-primary/70 bg-clip-text text-transparent",children:"Zehnly Duo Management"}),e.jsx("p",{className:"text-muted-foreground text-lg",children:"Complete language learning content management system"})]})}),e.jsx("div",{className:"mb-6",children:e.jsx(G,{placeholder:"Search across all content...",value:C,onChange:a=>Ke(a.target.value),className:"max-w-sm"})}),e.jsxs(Ts,{value:S,onValueChange:a=>{q(a),y({tab:a})},className:"space-y-6",children:[e.jsxs(ks,{className:"grid w-full grid-cols-5",children:[e.jsxs(ye,{value:"courses",className:"flex items-center gap-2",children:[e.jsx(Vs,{className:"h-4 w-4"}),"Courses (",ts.length,")"]}),e.jsxs(ye,{value:"chapters",className:"flex items-center gap-2",children:[e.jsx(be,{className:"h-4 w-4"}),"Chapters (",rs.length,")"]}),e.jsxs(ye,{value:"lessons",className:"flex items-center gap-2",children:[e.jsx(Q,{className:"h-4 w-4"}),"Lessons (",as.length,")"]}),e.jsxs(ye,{value:"words",className:"flex items-center gap-2",children:[e.jsx(_e,{className:"h-4 w-4"}),"Words (",ns.length,")"]}),e.jsxs(ye,{value:"story",className:"flex items-center gap-2",children:[e.jsx(be,{className:"h-4 w-4"}),"Story Content"]})]}),e.jsxs(we,{value:"courses",className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-2xl font-semibold",children:"Courses"}),e.jsx(Ps,{onSuccess:Ge,children:e.jsxs(x,{children:[e.jsx(ve,{className:"mr-2 h-4 w-4"}),"Add Course"]})})]}),e.jsx(tt,{data:ts,isLoading:Ce,onEdit:ws,onCourseClick:_s,onRefresh:Ge,selectedCourse:c})]}),e.jsxs(we,{value:"chapters",className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-semibold",children:"Chapters"}),c&&e.jsxs("p",{className:"text-muted-foreground",children:[c.title," • ",c.native_language," → ",c.learning_language]})]}),c&&e.jsx(Hs,{courseId:c.id,onSuccess:Re,children:e.jsxs(x,{children:[e.jsx(ve,{className:"mr-2 h-4 w-4"}),"Add Chapter"]})})]}),c?e.jsx(Zs,{data:rs,isLoading:xs,onEdit:vs,onChapterClick:Ds,onRefresh:Re,selectedChapter:m}):e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"Select a course from the Courses tab to view its chapters"})]}),e.jsxs(we,{value:"lessons",className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-semibold",children:"Lessons"}),m&&e.jsxs("p",{className:"text-muted-foreground",children:[m.title," • Order ",m.order]})]}),m&&e.jsx(nt,{chapterId:m.id,onSuccess:Qe,children:e.jsxs(x,{children:[e.jsx(ve,{className:"mr-2 h-4 w-4"}),"Add Lesson"]})})]}),m?e.jsx(rt,{data:as,isLoading:hs,onEdit:bs,onLessonClick:Ls,onRefresh:Qe,selectedLesson:n}):e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"Select a chapter from the Chapters tab to view its lessons"})]}),e.jsxs(we,{value:"words",className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-semibold",children:"Words"}),n&&e.jsxs("p",{className:"text-muted-foreground",children:[n.title," • ",n.lesson_type," lesson • Order ",n.order]})]}),n&&e.jsx(ct,{lessonId:n.id,onSuccess:Ve,children:e.jsxs(x,{children:[e.jsx(ve,{className:"mr-2 h-4 w-4"}),"Add Word"]})})]}),n?e.jsx(ot,{data:ns,isLoading:ps,onEdit:Cs,onRefresh:Ve}):e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"Select a lesson from the Lessons tab to view its vocabulary words"})]}),e.jsxs(we,{value:"story",className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-semibold",children:"Story Management"}),n&&e.jsxs("p",{className:"text-muted-foreground",children:[n.title," • Story lesson • Order ",n.order]})]}),n&&n.lesson_type==="story"&&e.jsx(jt,{lessonId:n.id,onSuccess:$e,children:e.jsxs(x,{children:[e.jsx(ve,{className:"mr-2 h-4 w-4"}),"Add Story"]})})]}),n&&n.lesson_type==="story"?e.jsx(ht,{data:Fs,isLoading:Ns,onEdit:Ss,onRefresh:$e}):e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"Select a story lesson from the Lessons tab to manage its stories"})]})]})]}),e.jsx(Ks,{course:c,open:t,onOpenChange:d,onSuccess:Ge}),e.jsx(Xs,{chapter:m,open:u,onOpenChange:g,onSuccess:Re}),e.jsx(it,{lesson:n,open:i,onOpenChange:r,onSuccess:Qe}),e.jsx(mt,{word:j,open:p,onOpenChange:b,onSuccess:Ve}),e.jsx(gt,{story:Ne,open:$,onOpenChange:ie,onSuccess:$e})]})}const Nt=[{title:"Zehnly Duo",href:"/zehnly-duo",isActive:!0,disabled:!1}],Mt=ft;export{Mt as component};

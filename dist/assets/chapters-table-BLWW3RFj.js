import{r as g,f as O,j as e,B as x,o as K,t as m,n as U,s as H}from"./index-BZy3F_hY.js";import{u as L,a as R,I as f,C as T,b as F,c as S,d as E,e as M}from"./card-BHaA6RoO.js";import{u as P,F as V,g as C,h as b,i as N,j as y,k as v,S as $,T as se,a as re,b as B,c as j,d as te,e as p,E as ae,f as ne}from"./table-8jJIXZOX.js";import{O as z,Q as ie,R as G,T as _,U as W,V as J,W as X,D as le,j as de,k as oe,l as ce,m as he,n as Q,N as xe}from"./sign-out-dialog-BE13U0RL.js";import{C as me,F as q,c as k}from"./content-api-BUtLuLVY.js";import{B as I}from"./badge-DfwYUQkb.js";const ue=K({title:H().min(1,"Chapter title is required"),order:U().min(1,"Order must be at least 1")});function ye({courseId:a,children:u,onSuccess:c}){const[h,o]=g.useState(!1),n=O(),i=L({resolver:R(ue),defaultValues:{title:"",order:1}}),d=P({mutationFn:t=>k.chapters.create({...t,course_id:a}),onSuccess:()=>{m.success("Chapter created successfully"),n.invalidateQueries({queryKey:["chapters",a]}),n.invalidateQueries({queryKey:["courses"]}),i.reset(),o(!1),c?.()},onError:t=>{m.error("Failed to create chapter"),console.error("Create chapter error:",t)}}),r=t=>{d.mutate(t)};return e.jsxs(z,{open:h,onOpenChange:o,children:[e.jsx(ie,{asChild:!0,children:u||e.jsxs(x,{children:[e.jsx(me,{className:"h-4 w-4"}),"Add Chapter"]})}),e.jsxs(G,{className:"sm:max-w-[500px]",children:[e.jsxs(_,{children:[e.jsxs(W,{className:"flex items-center gap-2",children:[e.jsx(q,{className:"h-5 w-5"}),"Create New Chapter"]}),e.jsx(J,{children:"Add a new chapter to organize course content."})]}),e.jsx(V,{...i,children:e.jsxs("form",{onSubmit:i.handleSubmit(r),className:"space-y-6",children:[e.jsxs("div",{className:"grid gap-4",children:[e.jsx(C,{control:i.control,name:"title",render:({field:t})=>e.jsxs(b,{children:[e.jsx(N,{children:"Chapter Title *"}),e.jsx(y,{children:e.jsx(f,{placeholder:"e.g., Basic Greetings",...t})}),e.jsx(v,{})]})}),e.jsx(C,{control:i.control,name:"order",render:({field:t})=>e.jsxs(b,{children:[e.jsx(N,{children:"Order *"}),e.jsx(y,{children:e.jsx(f,{type:"number",min:"1",placeholder:"1",...t,onChange:w=>t.onChange(parseInt(w.target.value)||1)})}),e.jsx(v,{})]})})]}),e.jsxs(X,{children:[e.jsx(x,{type:"button",variant:"outline",onClick:()=>o(!1),children:"Cancel"}),e.jsx(x,{type:"submit",disabled:d.isPending,className:"min-w-[100px]",children:d.isPending?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),"Creating..."]}):"Create Chapter"})]})]})})]})]})}const je=K({title:H().min(1,"Chapter title is required"),order:U().min(1,"Order must be at least 1")});function ve({chapter:a,open:u,onOpenChange:c,onSuccess:h}){const o=O(),n=L({resolver:R(je),defaultValues:{title:"",order:1}}),i=P({mutationFn:r=>{if(!a)throw new Error("No chapter selected");return k.chapters.update(a.id,r)},onSuccess:()=>{m.success("Chapter updated successfully"),o.invalidateQueries({queryKey:["chapters",a?.course_id]}),o.invalidateQueries({queryKey:["courses"]}),c(!1),h?.()},onError:r=>{m.error("Failed to update chapter"),console.error("Update chapter error:",r)}});g.useEffect(()=>{a&&n.reset({title:a.title,order:a.order})},[a,n]);const d=r=>{i.mutate(r)};return a?e.jsx(z,{open:u,onOpenChange:c,children:e.jsxs(G,{className:"sm:max-w-[500px]",children:[e.jsxs(_,{children:[e.jsxs(W,{className:"flex items-center gap-2",children:[e.jsx($,{className:"h-5 w-5"}),"Edit Chapter"]}),e.jsx(J,{children:"Update the chapter information and order."})]}),e.jsx(V,{...n,children:e.jsxs("form",{onSubmit:n.handleSubmit(d),className:"space-y-6",children:[e.jsxs("div",{className:"grid gap-4",children:[e.jsx(C,{control:n.control,name:"title",render:({field:r})=>e.jsxs(b,{children:[e.jsx(N,{children:"Chapter Title *"}),e.jsx(y,{children:e.jsx(f,{placeholder:"e.g., Basic Greetings",...r})}),e.jsx(v,{})]})}),e.jsx(C,{control:n.control,name:"order",render:({field:r})=>e.jsxs(b,{children:[e.jsx(N,{children:"Order *"}),e.jsx(y,{children:e.jsx(f,{type:"number",min:"1",placeholder:"1",...r,onChange:t=>r.onChange(parseInt(t.target.value)||1)})}),e.jsx(v,{})]})})]}),e.jsxs(X,{children:[e.jsx(x,{type:"button",variant:"outline",onClick:()=>c(!1),children:"Cancel"}),e.jsx(x,{type:"submit",disabled:i.isPending,className:"min-w-[100px]",children:i.isPending?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),"Updating..."]}):"Update Chapter"})]})]})})]})}):null}function we({data:a,isLoading:u,onEdit:c,onChapterClick:h,onRefresh:o,selectedChapter:n}){const[i,d]=g.useState(!1),[r,t]=g.useState(null),w=O(),A=P({mutationFn:s=>k.chapters.delete(s),onSuccess:s=>{m.success(s.message),w.invalidateQueries({queryKey:["chapters"]}),o(),d(!1),t(null)},onError:s=>{m.error("Failed to delete chapter"),console.error("Delete error:",s)}}),Y=(s,l)=>{l?.stopPropagation(),t(s),d(!0)},Z=(s,l)=>{l?.stopPropagation(),c(s)},ee=()=>{r&&A.mutate(r.id)};if(u)return e.jsxs(T,{children:[e.jsxs(F,{children:[e.jsx(S,{children:"Chapters"}),e.jsx(E,{children:"Loading..."})]}),e.jsx(M,{children:e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})})})]});if(a.length===0)return e.jsxs(T,{children:[e.jsxs(F,{children:[e.jsx(S,{children:"Chapters"}),e.jsx(E,{children:"No chapters found"})]}),e.jsx(M,{children:e.jsxs("div",{className:"flex flex-col items-center justify-center py-8",children:[e.jsx(q,{className:"h-12 w-12 text-muted-foreground mb-4"}),e.jsxs("p",{className:"text-muted-foreground text-center",children:["No chapters have been created yet.",e.jsx("br",{}),'Click "Add Chapter" to get started.']})]})})]});const D=[...a].sort((s,l)=>s.order-l.order);return e.jsxs(e.Fragment,{children:[e.jsxs(T,{className:"border-0 shadow-lg bg-gradient-to-br from-card via-card to-card/95",children:[e.jsx(F,{className:"pb-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs(S,{className:"text-xl font-semibold flex items-center gap-2",children:[e.jsx(q,{className:"h-5 w-5 text-primary"}),"Chapters (",D.length,")"]}),e.jsx(E,{className:"mt-1",children:h?"Click on a chapter to view its lessons":"Manage course chapters and their organization"})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"Total Chapters"}),e.jsx("div",{className:"text-2xl font-bold text-primary",children:D.length})]})]})}),e.jsx(M,{children:e.jsxs(se,{children:[e.jsx(re,{children:e.jsxs(B,{children:[e.jsx(j,{children:"Order"}),e.jsx(j,{children:"Chapter Title"}),e.jsx(j,{children:"Status"}),e.jsx(j,{className:"w-[70px]",children:"Actions"})]})}),e.jsx(te,{children:D.map(s=>e.jsxs(B,{className:`${h?"cursor-pointer hover:bg-muted/50":""} ${n?.id===s.id?"bg-muted":""}`,onClick:()=>h?.(s),children:[e.jsx(p,{children:e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(I,{variant:"outline",className:"w-8 h-8 rounded-full flex items-center justify-center p-0",children:s.order})})}),e.jsx(p,{className:"max-w-[350px]",children:e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"font-medium truncate",title:s.title,children:s.title}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:["ID: #",s.id]})]})}),e.jsx(p,{children:e.jsx(I,{variant:"default",className:"bg-green-100 text-green-800 hover:bg-green-100",children:"Active"})}),e.jsx(p,{children:e.jsxs(le,{children:[e.jsx(de,{asChild:!0,children:e.jsxs(x,{variant:"ghost",className:"h-8 w-8 p-0",onClick:l=>l.stopPropagation(),children:[e.jsx("span",{className:"sr-only",children:"Open menu"}),e.jsx(ae,{className:"h-4 w-4"})]})}),e.jsxs(oe,{align:"end",children:[e.jsx(ce,{children:"Actions"}),e.jsx(he,{}),e.jsxs(Q,{onClick:l=>Z(s,l),children:[e.jsx($,{className:"mr-2 h-4 w-4"}),"Edit"]}),e.jsxs(Q,{onClick:l=>Y(s,l),className:"text-red-600",children:[e.jsx(ne,{className:"mr-2 h-4 w-4"}),"Delete"]})]})]})})]},s.id))})]})})]}),e.jsx(xe,{open:i,onOpenChange:d,title:"Delete Chapter",desc:`Are you sure you want to delete "${r?.title}"? This action cannot be undone.`,confirmText:"Delete",handleConfirm:ee,isLoading:A.isPending})]})}export{ye as C,ve as E,we as a};

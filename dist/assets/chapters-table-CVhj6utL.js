import{r as g,d as P,j as e,B as x,o as K,t as m,n as H,s as L}from"./index-C1dgz4Nm.js";import{u as U,a as $,I as f}from"./label-tLKrJ59s.js";import{u as O,D as z,a as se,b as G,c as R,d as V,e as _,F as J,f as C,g as b,h as N,i as y,j as v,k as W,S as X,E as re,T as te}from"./form-B718r0vi.js";import{C as ae,F as q,c as A}from"./content-api-DvAdUDEe.js";import{C as T,a as F,b as S,c as E,d as M}from"./card-CuBB0wwQ.js";import{D as ne,c as ie,d as le,e as de,g as oe,f as B,C as ce}from"./theme-switch-D0Hy7_tu.js";import{T as he,a as xe,b as I,c as j,d as me,e as p,B as Q}from"./badge-z_9uRZcm.js";const ue=K({title:L().min(1,"Chapter title is required"),order:H().min(1,"Order must be at least 1")});function ve({courseId:a,children:u,onSuccess:c}){const[h,o]=g.useState(!1),n=P(),i=U({resolver:$(ue),defaultValues:{title:"",order:1}}),d=O({mutationFn:t=>A.chapters.create({...t,course_id:a}),onSuccess:()=>{m.success("Chapter created successfully"),n.invalidateQueries({queryKey:["chapters",a]}),n.invalidateQueries({queryKey:["courses"]}),i.reset(),o(!1),c?.()},onError:t=>{m.error("Failed to create chapter"),console.error("Create chapter error:",t)}}),r=t=>{d.mutate(t)};return e.jsxs(z,{open:h,onOpenChange:o,children:[e.jsx(se,{asChild:!0,children:u||e.jsxs(x,{children:[e.jsx(ae,{className:"h-4 w-4"}),"Add Chapter"]})}),e.jsxs(G,{className:"sm:max-w-[500px]",children:[e.jsxs(R,{children:[e.jsxs(V,{className:"flex items-center gap-2",children:[e.jsx(q,{className:"h-5 w-5"}),"Create New Chapter"]}),e.jsx(_,{children:"Add a new chapter to organize course content."})]}),e.jsx(J,{...i,children:e.jsxs("form",{onSubmit:i.handleSubmit(r),className:"space-y-6",children:[e.jsxs("div",{className:"grid gap-4",children:[e.jsx(C,{control:i.control,name:"title",render:({field:t})=>e.jsxs(b,{children:[e.jsx(N,{children:"Chapter Title *"}),e.jsx(y,{children:e.jsx(f,{placeholder:"e.g., Basic Greetings",...t})}),e.jsx(v,{})]})}),e.jsx(C,{control:i.control,name:"order",render:({field:t})=>e.jsxs(b,{children:[e.jsx(N,{children:"Order *"}),e.jsx(y,{children:e.jsx(f,{type:"number",min:"1",placeholder:"1",...t,onChange:w=>t.onChange(parseInt(w.target.value)||1)})}),e.jsx(v,{})]})})]}),e.jsxs(W,{children:[e.jsx(x,{type:"button",variant:"outline",onClick:()=>o(!1),children:"Cancel"}),e.jsx(x,{type:"submit",disabled:d.isPending,className:"min-w-[100px]",children:d.isPending?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),"Creating..."]}):"Create Chapter"})]})]})})]})]})}const je=K({title:L().min(1,"Chapter title is required"),order:H().min(1,"Order must be at least 1")});function we({chapter:a,open:u,onOpenChange:c,onSuccess:h}){const o=P(),n=U({resolver:$(je),defaultValues:{title:"",order:1}}),i=O({mutationFn:r=>{if(!a)throw new Error("No chapter selected");return A.chapters.update(a.id,r)},onSuccess:()=>{m.success("Chapter updated successfully"),o.invalidateQueries({queryKey:["chapters",a?.course_id]}),o.invalidateQueries({queryKey:["courses"]}),c(!1),h?.()},onError:r=>{m.error("Failed to update chapter"),console.error("Update chapter error:",r)}});g.useEffect(()=>{a&&n.reset({title:a.title,order:a.order})},[a,n]);const d=r=>{i.mutate(r)};return a?e.jsx(z,{open:u,onOpenChange:c,children:e.jsxs(G,{className:"sm:max-w-[500px]",children:[e.jsxs(R,{children:[e.jsxs(V,{className:"flex items-center gap-2",children:[e.jsx(X,{className:"h-5 w-5"}),"Edit Chapter"]}),e.jsx(_,{children:"Update the chapter information and order."})]}),e.jsx(J,{...n,children:e.jsxs("form",{onSubmit:n.handleSubmit(d),className:"space-y-6",children:[e.jsxs("div",{className:"grid gap-4",children:[e.jsx(C,{control:n.control,name:"title",render:({field:r})=>e.jsxs(b,{children:[e.jsx(N,{children:"Chapter Title *"}),e.jsx(y,{children:e.jsx(f,{placeholder:"e.g., Basic Greetings",...r})}),e.jsx(v,{})]})}),e.jsx(C,{control:n.control,name:"order",render:({field:r})=>e.jsxs(b,{children:[e.jsx(N,{children:"Order *"}),e.jsx(y,{children:e.jsx(f,{type:"number",min:"1",placeholder:"1",...r,onChange:t=>r.onChange(parseInt(t.target.value)||1)})}),e.jsx(v,{})]})})]}),e.jsxs(W,{children:[e.jsx(x,{type:"button",variant:"outline",onClick:()=>c(!1),children:"Cancel"}),e.jsx(x,{type:"submit",disabled:i.isPending,className:"min-w-[100px]",children:i.isPending?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),"Updating..."]}):"Update Chapter"})]})]})})]})}):null}function De({data:a,isLoading:u,onEdit:c,onChapterClick:h,onRefresh:o,selectedChapter:n}){const[i,d]=g.useState(!1),[r,t]=g.useState(null),w=P(),k=O({mutationFn:s=>A.chapters.delete(s),onSuccess:s=>{m.success(s.message),w.invalidateQueries({queryKey:["chapters"]}),o(),d(!1),t(null)},onError:s=>{m.error("Failed to delete chapter"),console.error("Delete error:",s)}}),Y=(s,l)=>{l?.stopPropagation(),t(s),d(!0)},Z=(s,l)=>{l?.stopPropagation(),c(s)},ee=()=>{r&&k.mutate(r.id)};if(u)return e.jsxs(T,{children:[e.jsxs(F,{children:[e.jsx(S,{children:"Chapters"}),e.jsx(E,{children:"Loading..."})]}),e.jsx(M,{children:e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})})})]});if(a.length===0)return e.jsxs(T,{children:[e.jsxs(F,{children:[e.jsx(S,{children:"Chapters"}),e.jsx(E,{children:"No chapters found"})]}),e.jsx(M,{children:e.jsxs("div",{className:"flex flex-col items-center justify-center py-8",children:[e.jsx(q,{className:"h-12 w-12 text-muted-foreground mb-4"}),e.jsxs("p",{className:"text-muted-foreground text-center",children:["No chapters have been created yet.",e.jsx("br",{}),'Click "Add Chapter" to get started.']})]})})]});const D=[...a].sort((s,l)=>s.order-l.order);return e.jsxs(e.Fragment,{children:[e.jsxs(T,{className:"border-0 shadow-lg bg-gradient-to-br from-card via-card to-card/95",children:[e.jsx(F,{className:"pb-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs(S,{className:"text-xl font-semibold flex items-center gap-2",children:[e.jsx(q,{className:"h-5 w-5 text-primary"}),"Chapters (",D.length,")"]}),e.jsx(E,{className:"mt-1",children:h?"Click on a chapter to view its lessons":"Manage course chapters and their organization"})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"Total Chapters"}),e.jsx("div",{className:"text-2xl font-bold text-primary",children:D.length})]})]})}),e.jsx(M,{children:e.jsxs(he,{children:[e.jsx(xe,{children:e.jsxs(I,{children:[e.jsx(j,{children:"Order"}),e.jsx(j,{children:"Chapter Title"}),e.jsx(j,{children:"Status"}),e.jsx(j,{className:"w-[70px]",children:"Actions"})]})}),e.jsx(me,{children:D.map(s=>e.jsxs(I,{className:`${h?"cursor-pointer hover:bg-muted/50":""} ${n?.id===s.id?"bg-muted":""}`,onClick:()=>h?.(s),children:[e.jsx(p,{children:e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(Q,{variant:"outline",className:"w-8 h-8 rounded-full flex items-center justify-center p-0",children:s.order})})}),e.jsx(p,{className:"max-w-[350px]",children:e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"font-medium truncate",title:s.title,children:s.title}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:["ID: #",s.id]})]})}),e.jsx(p,{children:e.jsx(Q,{variant:"default",className:"bg-green-100 text-green-800 hover:bg-green-100",children:"Active"})}),e.jsx(p,{children:e.jsxs(ne,{children:[e.jsx(ie,{asChild:!0,children:e.jsxs(x,{variant:"ghost",className:"h-8 w-8 p-0",onClick:l=>l.stopPropagation(),children:[e.jsx("span",{className:"sr-only",children:"Open menu"}),e.jsx(re,{className:"h-4 w-4"})]})}),e.jsxs(le,{align:"end",children:[e.jsx(de,{children:"Actions"}),e.jsx(oe,{}),e.jsxs(B,{onClick:l=>Z(s,l),children:[e.jsx(X,{className:"mr-2 h-4 w-4"}),"Edit"]}),e.jsxs(B,{onClick:l=>Y(s,l),className:"text-red-600",children:[e.jsx(te,{className:"mr-2 h-4 w-4"}),"Delete"]})]})]})})]},s.id))})]})})]}),e.jsx(ce,{open:i,onOpenChange:d,title:"Delete Chapter",desc:`Are you sure you want to delete "${r?.title}"? This action cannot be undone.`,confirmText:"Delete",handleConfirm:ee,isLoading:k.isPending})]})}export{ve as C,we as E,De as a};

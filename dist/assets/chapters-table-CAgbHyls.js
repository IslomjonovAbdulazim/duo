import{r as g,f as O,j as e,B as x,o as K,t as m,n as U,s as H}from"./index-CyfqMSRO.js";import{u as L,a as R,I as f}from"./label-CnTJIlJR.js";import{u as P,F as V,a as C,b,c as N,d as y,e as v,S as $,E as se,T as re}from"./form-hqjEauTZ.js";import{O as z,Q as te,R as G,T as _,U as W,V as J,W as X,D as ae,j as ne,k as ie,l as le,m as oe,n as B,N as de}from"./sign-out-dialog-MZk34Vm3.js";import{C as ce,F as q,c as A}from"./content-api-CAfDKib3.js";import{C as T,a as F,b as S,c as E,d as M}from"./card-BNLdo4DD.js";import{T as he,a as xe,b as Q,c as j,d as me,e as p}from"./table-BWo1WtLU.js";import{B as I}from"./badge-BLI5LmMG.js";const ue=K({title:H().min(1,"Chapter title is required"),order:U().min(1,"Order must be at least 1")});function we({courseId:a,children:u,onSuccess:c}){const[h,d]=g.useState(!1),n=O(),i=L({resolver:R(ue),defaultValues:{title:"",order:1}}),o=P({mutationFn:t=>A.chapters.create({...t,course_id:a}),onSuccess:()=>{m.success("Chapter created successfully"),n.invalidateQueries({queryKey:["chapters",a]}),n.invalidateQueries({queryKey:["courses"]}),i.reset(),d(!1),c?.()},onError:t=>{m.error("Failed to create chapter"),console.error("Create chapter error:",t)}}),r=t=>{o.mutate(t)};return e.jsxs(z,{open:h,onOpenChange:d,children:[e.jsx(te,{asChild:!0,children:u||e.jsxs(x,{children:[e.jsx(ce,{className:"h-4 w-4"}),"Add Chapter"]})}),e.jsxs(G,{className:"sm:max-w-[500px]",children:[e.jsxs(_,{children:[e.jsxs(W,{className:"flex items-center gap-2",children:[e.jsx(q,{className:"h-5 w-5"}),"Create New Chapter"]}),e.jsx(J,{children:"Add a new chapter to organize course content."})]}),e.jsx(V,{...i,children:e.jsxs("form",{onSubmit:i.handleSubmit(r),className:"space-y-6",children:[e.jsxs("div",{className:"grid gap-4",children:[e.jsx(C,{control:i.control,name:"title",render:({field:t})=>e.jsxs(b,{children:[e.jsx(N,{children:"Chapter Title *"}),e.jsx(y,{children:e.jsx(f,{placeholder:"e.g., Basic Greetings",...t})}),e.jsx(v,{})]})}),e.jsx(C,{control:i.control,name:"order",render:({field:t})=>e.jsxs(b,{children:[e.jsx(N,{children:"Order *"}),e.jsx(y,{children:e.jsx(f,{type:"number",min:"1",placeholder:"1",...t,onChange:w=>t.onChange(parseInt(w.target.value)||1)})}),e.jsx(v,{})]})})]}),e.jsxs(X,{children:[e.jsx(x,{type:"button",variant:"outline",onClick:()=>d(!1),children:"Cancel"}),e.jsx(x,{type:"submit",disabled:o.isPending,className:"min-w-[100px]",children:o.isPending?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),"Creating..."]}):"Create Chapter"})]})]})})]})]})}const je=K({title:H().min(1,"Chapter title is required"),order:U().min(1,"Order must be at least 1")});function De({chapter:a,open:u,onOpenChange:c,onSuccess:h}){const d=O(),n=L({resolver:R(je),defaultValues:{title:"",order:1}}),i=P({mutationFn:r=>{if(!a)throw new Error("No chapter selected");return A.chapters.update(a.id,r)},onSuccess:()=>{m.success("Chapter updated successfully"),d.invalidateQueries({queryKey:["chapters",a?.course_id]}),d.invalidateQueries({queryKey:["courses"]}),c(!1),h?.()},onError:r=>{m.error("Failed to update chapter"),console.error("Update chapter error:",r)}});g.useEffect(()=>{a&&n.reset({title:a.title,order:a.order})},[a,n]);const o=r=>{i.mutate(r)};return a?e.jsx(z,{open:u,onOpenChange:c,children:e.jsxs(G,{className:"sm:max-w-[500px]",children:[e.jsxs(_,{children:[e.jsxs(W,{className:"flex items-center gap-2",children:[e.jsx($,{className:"h-5 w-5"}),"Edit Chapter"]}),e.jsx(J,{children:"Update the chapter information and order."})]}),e.jsx(V,{...n,children:e.jsxs("form",{onSubmit:n.handleSubmit(o),className:"space-y-6",children:[e.jsxs("div",{className:"grid gap-4",children:[e.jsx(C,{control:n.control,name:"title",render:({field:r})=>e.jsxs(b,{children:[e.jsx(N,{children:"Chapter Title *"}),e.jsx(y,{children:e.jsx(f,{placeholder:"e.g., Basic Greetings",...r})}),e.jsx(v,{})]})}),e.jsx(C,{control:n.control,name:"order",render:({field:r})=>e.jsxs(b,{children:[e.jsx(N,{children:"Order *"}),e.jsx(y,{children:e.jsx(f,{type:"number",min:"1",placeholder:"1",...r,onChange:t=>r.onChange(parseInt(t.target.value)||1)})}),e.jsx(v,{})]})})]}),e.jsxs(X,{children:[e.jsx(x,{type:"button",variant:"outline",onClick:()=>c(!1),children:"Cancel"}),e.jsx(x,{type:"submit",disabled:i.isPending,className:"min-w-[100px]",children:i.isPending?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),"Updating..."]}):"Update Chapter"})]})]})})]})}):null}function Te({data:a,isLoading:u,onEdit:c,onChapterClick:h,onRefresh:d,selectedChapter:n}){const[i,o]=g.useState(!1),[r,t]=g.useState(null),w=O(),k=P({mutationFn:s=>A.chapters.delete(s),onSuccess:s=>{m.success(s.message),w.invalidateQueries({queryKey:["chapters"]}),d(),o(!1),t(null)},onError:s=>{m.error("Failed to delete chapter"),console.error("Delete error:",s)}}),Y=(s,l)=>{l?.stopPropagation(),t(s),o(!0)},Z=(s,l)=>{l?.stopPropagation(),c(s)},ee=()=>{r&&k.mutate(r.id)};if(u)return e.jsxs(T,{children:[e.jsxs(F,{children:[e.jsx(S,{children:"Chapters"}),e.jsx(E,{children:"Loading..."})]}),e.jsx(M,{children:e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})})})]});if(a.length===0)return e.jsxs(T,{children:[e.jsxs(F,{children:[e.jsx(S,{children:"Chapters"}),e.jsx(E,{children:"No chapters found"})]}),e.jsx(M,{children:e.jsxs("div",{className:"flex flex-col items-center justify-center py-8",children:[e.jsx(q,{className:"h-12 w-12 text-muted-foreground mb-4"}),e.jsxs("p",{className:"text-muted-foreground text-center",children:["No chapters have been created yet.",e.jsx("br",{}),'Click "Add Chapter" to get started.']})]})})]});const D=[...a].sort((s,l)=>s.order-l.order);return e.jsxs(e.Fragment,{children:[e.jsxs(T,{className:"border-0 shadow-lg bg-gradient-to-br from-card via-card to-card/95",children:[e.jsx(F,{className:"pb-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs(S,{className:"text-xl font-semibold flex items-center gap-2",children:[e.jsx(q,{className:"h-5 w-5 text-primary"}),"Chapters (",D.length,")"]}),e.jsx(E,{className:"mt-1",children:h?"Click on a chapter to view its lessons":"Manage course chapters and their organization"})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"Total Chapters"}),e.jsx("div",{className:"text-2xl font-bold text-primary",children:D.length})]})]})}),e.jsx(M,{children:e.jsxs(he,{children:[e.jsx(xe,{children:e.jsxs(Q,{children:[e.jsx(j,{children:"Order"}),e.jsx(j,{children:"Chapter Title"}),e.jsx(j,{children:"Status"}),e.jsx(j,{className:"w-[70px]",children:"Actions"})]})}),e.jsx(me,{children:D.map(s=>e.jsxs(Q,{className:`${h?"cursor-pointer hover:bg-muted/50":""} ${n?.id===s.id?"bg-muted":""}`,onClick:()=>h?.(s),children:[e.jsx(p,{children:e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(I,{variant:"outline",className:"w-8 h-8 rounded-full flex items-center justify-center p-0",children:s.order})})}),e.jsx(p,{className:"max-w-[350px]",children:e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"font-medium truncate",title:s.title,children:s.title}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:["ID: #",s.id]})]})}),e.jsx(p,{children:e.jsx(I,{variant:"default",className:"bg-green-100 text-green-800 hover:bg-green-100",children:"Active"})}),e.jsx(p,{children:e.jsxs(ae,{children:[e.jsx(ne,{asChild:!0,children:e.jsxs(x,{variant:"ghost",className:"h-8 w-8 p-0",onClick:l=>l.stopPropagation(),children:[e.jsx("span",{className:"sr-only",children:"Open menu"}),e.jsx(se,{className:"h-4 w-4"})]})}),e.jsxs(ie,{align:"end",children:[e.jsx(le,{children:"Actions"}),e.jsx(oe,{}),e.jsxs(B,{onClick:l=>Z(s,l),children:[e.jsx($,{className:"mr-2 h-4 w-4"}),"Edit"]}),e.jsxs(B,{onClick:l=>Y(s,l),className:"text-red-600",children:[e.jsx(re,{className:"mr-2 h-4 w-4"}),"Delete"]})]})]})})]},s.id))})]})})]}),e.jsx(de,{open:i,onOpenChange:o,title:"Delete Chapter",desc:`Are you sure you want to delete "${r?.title}"? This action cannot be undone.`,confirmText:"Delete",handleConfirm:ee,isLoading:k.isPending})]})}export{we as C,De as E,Te as a};

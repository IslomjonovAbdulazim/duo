import{r as h,f as U,j as e,B as x,t as y,o as xe,s as M,n as ts,_ as rs}from"./index-CLHUakAX.js";import{u as O,T as Ae,a as Ee,b as H,c as C,d as ke,e as S,E as Te,S as Y,f as qe,F as me,g as L,h as D,i as _,j as F,k as A,l as fe,m as As,M as Es}from"./table-ldpN8xw4.js";import{C as W,b as P,c as K,d as z,e as B,u as he,a as ue,I as Q}from"./card-CukyQwW8.js";import{T as je,a as ks,b as Ts,c as Ne,d as ye}from"./textarea-BXuluAVS.js";import{H as qs,S as Us,T as Os,C as Is,P as Ms}from"./config-drawer-CDF0ceuM.js";import{c as w,C as Ze,b as Z,F as ve}from"./content-api-DOJ1H-iu.js";import{U as Ws,C as Ps,E as Ks}from"./upload-course-logo-dialog-BajiLJ6W.js";import{M as V,A as zs,s as Bs,t as Gs,D as Ue,j as Oe,k as Ie,l as Me,n as R,N as We,O as J,Q as Pe,R as ee,T as se,U as te,V as re,W as ae,X as Le,Z as X,Y as Rs,_ as Qs}from"./sign-out-dialog-BmFH9JZt.js";import{g as Vs}from"./media-utils-Cpm_6zhn.js";import{U as I}from"./upload--srzgdWy.js";import{C as Hs,a as $s,E as Zs}from"./chapters-table-CVSsb85a.js";import{B as De}from"./badge-CdB_N4w5.js";import{S as as,a as ns,b as ls,c as is,d as _e}from"./select-CDtJ4CEX.js";import{V as de}from"./volume-2-BMh1r1fz.js";import{I as Fe}from"./image-DkjMzjig.js";import{c as os}from"./createLucideIcon-Yuvaac23.js";import{P as we}from"./plus-I1W4vLC2.js";import"./loader-circle-B0uIBIqp.js";/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xs=[["path",{d:"M17.5 22h.5a2 2 0 0 0 2-2V7l-5-5H6a2 2 0 0 0-2 2v3",key:"rslqgf"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M2 19a2 2 0 1 1 4 0v1a2 2 0 1 1-4 0v-4a6 6 0 0 1 12 0v4a2 2 0 1 1-4 0v-1a2 2 0 1 1 4 0",key:"9f7x3i"}]],Ys=os("file-audio",Xs);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Js=[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["circle",{cx:"10",cy:"12",r:"2",key:"737tya"}],["path",{d:"m20 17-1.296-1.296a2.41 2.41 0 0 0-3.408 0L9 22",key:"wt3hpn"}]],et=os("file-image",Js);function st({data:s,isLoading:f,onEdit:d,onCourseClick:g,onRefresh:m,selectedCourse:r}){const[a,c]=h.useState(!1),[t,o]=h.useState(!1),[j,N]=h.useState(null),[i,n]=h.useState(null),T=U(),E=O({mutationFn:p=>w.courses.delete(p),onSuccess:p=>{y.success(p.message),T.invalidateQueries({queryKey:["courses"]}),m(),c(!1),N(null)},onError:p=>{y.error("Failed to delete course"),console.error("Delete error:",p)}}),u=(p,v)=>{v.stopPropagation(),N(p),c(!0)},G=(p,v)=>{v.stopPropagation(),d(p)},pe=(p,v)=>{v.stopPropagation(),n(p),o(!0)},ne=()=>{j&&E.mutate(j.id)},ge=()=>{T.invalidateQueries({queryKey:["courses"]}),m(),o(!1),n(null)};return f?e.jsxs(W,{children:[e.jsxs(P,{children:[e.jsx(K,{children:"Courses"}),e.jsx(z,{children:"Loading..."})]}),e.jsx(B,{children:e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})})})]}):s.length===0?e.jsxs(W,{children:[e.jsxs(P,{children:[e.jsx(K,{children:"Courses"}),e.jsx(z,{children:"No courses found"})]}),e.jsx(B,{children:e.jsxs("div",{className:"flex flex-col items-center justify-center py-8",children:[e.jsx(V,{className:"h-12 w-12 text-muted-foreground mb-4"}),e.jsxs("p",{className:"text-muted-foreground text-center",children:["No courses have been created yet.",e.jsx("br",{}),'Click "Add Course" to get started.']})]})})]}):e.jsxs(e.Fragment,{children:[e.jsxs(W,{className:"border-0 shadow-lg bg-gradient-to-br from-card via-card to-card/95",children:[e.jsx(P,{className:"pb-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs(K,{className:"text-xl font-semibold flex items-center gap-2",children:[e.jsx(V,{className:"h-5 w-5 text-primary"}),"Courses (",s.length,")"]}),e.jsx(z,{className:"mt-1",children:"Click on a course to view its chapters"})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"Total Courses"}),e.jsx("div",{className:"text-2xl font-bold text-primary",children:s.length})]})]})}),e.jsx(B,{children:e.jsxs(Ae,{children:[e.jsx(Ee,{children:e.jsxs(H,{children:[e.jsx(C,{children:"Course"}),e.jsx(C,{children:"Languages"}),e.jsx(C,{children:"Logo"}),e.jsx(C,{className:"w-[70px]",children:"Actions"})]})}),e.jsx(ke,{children:s.map(p=>e.jsxs(H,{className:`cursor-pointer transition-colors hover:bg-muted/50 ${r?.id===p.id?"bg-muted":""}`,onClick:()=>g(p),children:[e.jsx(S,{className:"max-w-[350px]",children:e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"font-medium truncate",title:p.title,children:p.title}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:["ID: #",p.id]})]})}),e.jsx(S,{className:"max-w-[200px]",children:e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx("span",{className:"font-medium text-blue-600",children:p.native_language}),e.jsx("span",{className:"text-muted-foreground",children:"→"}),e.jsx("span",{className:"font-medium text-green-600",children:p.learning_language})]}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Native → Target"})]})}),e.jsx(S,{children:e.jsxs("div",{className:"flex items-center gap-3",children:[p.logo_url?e.jsxs("div",{className:"relative",children:[e.jsxs(zs,{className:"h-10 w-10 border-2 border-green-200",children:[e.jsx(Bs,{src:Vs(p.logo_url),alt:p.title}),e.jsx(Gs,{className:"bg-green-50",children:e.jsx(V,{className:"h-5 w-5 text-green-600"})})]}),e.jsx("div",{className:"absolute -bottom-1 -right-1 w-3 h-3 bg-green-500 rounded-full border-2 border-white"})]}):e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"h-10 w-10 rounded-full bg-gray-100 border-2 border-gray-200 flex items-center justify-center",children:e.jsx(V,{className:"h-5 w-5 text-gray-400"})}),e.jsx("div",{className:"absolute -bottom-1 -right-1 w-3 h-3 bg-gray-300 rounded-full border-2 border-white"})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:`text-xs font-medium ${p.logo_url?"text-green-600":"text-gray-500"}`,children:p.logo_url?"✓ Logo uploaded":"○ No logo"}),e.jsx("span",{className:"text-[10px] text-muted-foreground",children:p.logo_url?"Ready to display":"Upload recommended"})]})]})}),e.jsx(S,{children:e.jsxs(Ue,{children:[e.jsx(Oe,{asChild:!0,children:e.jsxs(x,{variant:"ghost",className:"h-8 w-8 p-0",onClick:v=>v.stopPropagation(),children:[e.jsx("span",{className:"sr-only",children:"Open menu"}),e.jsx(Te,{className:"h-4 w-4"})]})}),e.jsxs(Ie,{align:"end",children:[e.jsx(Me,{children:"Actions"}),e.jsxs(R,{onClick:v=>pe(p,v),children:[e.jsx(I,{className:"mr-2 h-4 w-4"}),"Upload Logo"]}),e.jsxs(R,{onClick:v=>G(p,v),children:[e.jsx(Y,{className:"mr-2 h-4 w-4"}),"Edit"]}),e.jsxs(R,{onClick:v=>u(p,v),className:"text-red-600",children:[e.jsx(qe,{className:"mr-2 h-4 w-4"}),"Delete"]})]})]})})]},p.id))})]})})]}),e.jsx(We,{open:a,onOpenChange:c,title:"Delete Course",desc:`Are you sure you want to delete "${j?.title}"? This action cannot be undone and will also delete all associated lessons and words.`,confirmText:"Delete",handleConfirm:ne,isLoading:E.isPending}),i&&e.jsx(Ws,{open:t,onOpenChange:o,course:i,onSuccess:ge})]})}function tt({data:s,isLoading:f,onEdit:d,onLessonClick:g,onRefresh:m,selectedLesson:r}){const[a,c]=h.useState(!1),[t,o]=h.useState(null),j=U(),N=O({mutationFn:u=>w.lessons.delete(u),onSuccess:u=>{y.success(u.message),j.invalidateQueries({queryKey:["lessons"]}),m(),c(!1),o(null)},onError:u=>{y.error("Failed to delete lesson"),console.error("Delete error:",u)}}),i=u=>{o(u),c(!0)},n=()=>{t&&N.mutate(t.id)},T=u=>{switch(u){case"word":return"bg-blue-100 text-blue-800 hover:bg-blue-100";case"story":return"bg-purple-100 text-purple-800 hover:bg-purple-100";default:return"bg-gray-100 text-gray-800 hover:bg-gray-100"}};if(f)return e.jsxs(W,{children:[e.jsxs(P,{children:[e.jsx(K,{children:"Lessons"}),e.jsx(z,{children:"Loading..."})]}),e.jsx(B,{children:e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})})})]});if(s.length===0)return e.jsxs(W,{children:[e.jsxs(P,{children:[e.jsx(K,{children:"Lessons"}),e.jsx(z,{children:"No lessons found"})]}),e.jsx(B,{children:e.jsxs("div",{className:"flex flex-col items-center justify-center py-8",children:[e.jsx(V,{className:"h-12 w-12 text-muted-foreground mb-4"}),e.jsxs("p",{className:"text-muted-foreground text-center",children:["No lessons have been created yet.",e.jsx("br",{}),'Click "Add Lesson" to get started.']})]})})]});const E=[...s].sort((u,G)=>u.order-G.order);return e.jsxs(e.Fragment,{children:[e.jsxs(W,{className:"border-0 shadow-lg bg-gradient-to-br from-card via-card to-card/95",children:[e.jsx(P,{className:"pb-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs(K,{className:"text-xl font-semibold flex items-center gap-2",children:[e.jsx(V,{className:"h-5 w-5 text-primary"}),"Lessons (",E.length,")"]}),e.jsx(z,{className:"mt-1",children:"Manage chapter lessons and their content"})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"Total Lessons"}),e.jsx("div",{className:"text-2xl font-bold text-primary",children:E.length})]})]})}),e.jsx(B,{children:e.jsxs(Ae,{children:[e.jsx(Ee,{children:e.jsxs(H,{children:[e.jsx(C,{children:"Order"}),e.jsx(C,{children:"Lesson Title"}),e.jsx(C,{children:"Type"}),e.jsx(C,{children:"Content"}),e.jsx(C,{className:"w-[70px]",children:"Actions"})]})}),e.jsx(ke,{children:E.map(u=>{const G=r?.id===u.id;return e.jsxs(H,{className:`cursor-pointer transition-colors hover:bg-muted/50 ${G?"bg-muted border-l-4 border-l-primary":""}`,onClick:()=>g?.(u),children:[e.jsx(S,{children:e.jsx(De,{variant:"outline",className:"w-8 h-8 rounded-full flex items-center justify-center p-0",children:u.order})}),e.jsx(S,{className:"max-w-[300px]",children:e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"font-medium truncate",title:u.title,children:u.title}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:["ID: #",u.id]})]})}),e.jsx(S,{children:e.jsx(De,{variant:"secondary",className:T(u.lesson_type),children:u.lesson_type.charAt(0).toUpperCase()+u.lesson_type.slice(1)})}),e.jsx(S,{className:"max-w-[400px]",children:e.jsx("p",{className:"text-sm text-muted-foreground truncate",title:u.content,children:u.content})}),e.jsx(S,{children:e.jsxs(Ue,{children:[e.jsx(Oe,{asChild:!0,children:e.jsxs(x,{variant:"ghost",className:"h-8 w-8 p-0",children:[e.jsx("span",{className:"sr-only",children:"Open menu"}),e.jsx(Te,{className:"h-4 w-4"})]})}),e.jsxs(Ie,{align:"end",children:[e.jsx(Me,{children:"Actions"}),e.jsxs(R,{onClick:()=>d(u),children:[e.jsx(Y,{className:"mr-2 h-4 w-4"}),"Edit"]}),e.jsxs(R,{onClick:()=>i(u),className:"text-red-600",children:[e.jsx(qe,{className:"mr-2 h-4 w-4"}),"Delete"]})]})]})})]},u.id)})})]})})]}),e.jsx(We,{open:a,onOpenChange:c,title:"Delete Lesson",desc:`Are you sure you want to delete "${t?.title}"? This action cannot be undone.`,confirmText:"Delete",handleConfirm:n,isLoading:N.isPending})]})}const rt=xe({title:M().min(1,"Lesson title is required"),lesson_type:rs(["word","story"]),order:ts().min(1,"Order must be at least 1"),content:M().min(1,"Content is required")});function at({chapterId:s,children:f,onSuccess:d}){const[g,m]=h.useState(!1),r=U(),a=he({resolver:ue(rt),defaultValues:{title:"",lesson_type:"word",order:1,content:""}}),c=O({mutationFn:o=>w.lessons.create({...o,chapter_id:s}),onSuccess:()=>{y.success("Lesson created successfully"),r.invalidateQueries({queryKey:["lessons",s]}),a.reset(),m(!1),d?.()},onError:o=>{y.error("Failed to create lesson"),console.error("Create lesson error:",o)}}),t=o=>{c.mutate(o)};return e.jsxs(J,{open:g,onOpenChange:m,children:[e.jsx(Pe,{asChild:!0,children:f||e.jsxs(x,{children:[e.jsx(Ze,{className:"h-4 w-4"}),"Add Lesson"]})}),e.jsxs(ee,{className:"sm:max-w-[600px]",children:[e.jsxs(se,{children:[e.jsxs(te,{className:"flex items-center gap-2",children:[e.jsx(V,{className:"h-5 w-5"}),"Create New Lesson"]}),e.jsx(re,{children:"Add a new lesson to this chapter with content and exercises."})]}),e.jsx(me,{...a,children:e.jsxs("form",{onSubmit:a.handleSubmit(t),className:"space-y-6",children:[e.jsxs("div",{className:"grid gap-4",children:[e.jsx(L,{control:a.control,name:"title",render:({field:o})=>e.jsxs(D,{children:[e.jsx(_,{children:"Lesson Title *"}),e.jsx(F,{children:e.jsx(Q,{placeholder:"e.g., Hello and Goodbye",...o})}),e.jsx(A,{})]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(L,{control:a.control,name:"lesson_type",render:({field:o})=>e.jsxs(D,{children:[e.jsx(_,{children:"Lesson Type *"}),e.jsxs(as,{onValueChange:o.onChange,defaultValue:o.value,children:[e.jsx(F,{children:e.jsx(ns,{children:e.jsx(ls,{placeholder:"Select lesson type"})})}),e.jsxs(is,{children:[e.jsx(_e,{value:"word",children:"Word"}),e.jsx(_e,{value:"story",children:"Story"})]})]}),e.jsx(A,{})]})}),e.jsx(L,{control:a.control,name:"order",render:({field:o})=>e.jsxs(D,{children:[e.jsx(_,{children:"Order *"}),e.jsx(F,{children:e.jsx(Q,{type:"number",min:"1",placeholder:"1",...o,onChange:j=>o.onChange(parseInt(j.target.value)||1)})}),e.jsx(A,{})]})})]}),e.jsx(L,{control:a.control,name:"content",render:({field:o})=>e.jsxs(D,{children:[e.jsx(_,{children:"Content *"}),e.jsx(F,{children:e.jsx(je,{placeholder:"In this lesson we learn basic greetings...",className:"min-h-[120px]",...o})}),e.jsx(A,{})]})})]}),e.jsxs(ae,{children:[e.jsx(x,{type:"button",variant:"outline",onClick:()=>m(!1),children:"Cancel"}),e.jsx(x,{type:"submit",disabled:c.isPending,className:"min-w-[120px]",children:c.isPending?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),"Creating..."]}):"Create Lesson"})]})]})})]})]})}const nt=xe({title:M().min(1,"Lesson title is required"),lesson_type:rs(["word","story"]),order:ts().min(1,"Order must be at least 1"),content:M().min(1,"Content is required")});function lt({lesson:s,open:f,onOpenChange:d,onSuccess:g}){const m=U(),r=he({resolver:ue(nt),defaultValues:{title:"",lesson_type:"word",order:1,content:""}}),a=O({mutationFn:t=>{if(!s)throw new Error("No lesson selected");return w.lessons.update(s.id,t)},onSuccess:()=>{y.success("Lesson updated successfully"),m.invalidateQueries({queryKey:["lessons",s?.chapter_id]}),d(!1),g?.()},onError:t=>{y.error("Failed to update lesson"),console.error("Update lesson error:",t)}});h.useEffect(()=>{s&&r.reset({title:s.title,lesson_type:s.lesson_type,order:s.order,content:s.content})},[s,r]);const c=t=>{a.mutate(t)};return s?e.jsx(J,{open:f,onOpenChange:d,children:e.jsxs(ee,{className:"sm:max-w-[600px]",children:[e.jsxs(se,{children:[e.jsxs(te,{className:"flex items-center gap-2",children:[e.jsx(Y,{className:"h-5 w-5"}),"Edit Lesson"]}),e.jsx(re,{children:"Update the lesson information, type, and content."})]}),e.jsx(me,{...r,children:e.jsxs("form",{onSubmit:r.handleSubmit(c),className:"space-y-6",children:[e.jsxs("div",{className:"grid gap-4",children:[e.jsx(L,{control:r.control,name:"title",render:({field:t})=>e.jsxs(D,{children:[e.jsx(_,{children:"Lesson Title *"}),e.jsx(F,{children:e.jsx(Q,{placeholder:"e.g., Hello and Goodbye",...t})}),e.jsx(A,{})]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(L,{control:r.control,name:"lesson_type",render:({field:t})=>e.jsxs(D,{children:[e.jsx(_,{children:"Lesson Type *"}),e.jsxs(as,{onValueChange:t.onChange,value:t.value,children:[e.jsx(F,{children:e.jsx(ns,{children:e.jsx(ls,{placeholder:"Select lesson type"})})}),e.jsxs(is,{children:[e.jsx(_e,{value:"word",children:"Word"}),e.jsx(_e,{value:"story",children:"Story"})]})]}),e.jsx(A,{})]})}),e.jsx(L,{control:r.control,name:"order",render:({field:t})=>e.jsxs(D,{children:[e.jsx(_,{children:"Order *"}),e.jsx(F,{children:e.jsx(Q,{type:"number",min:"1",placeholder:"1",...t,onChange:o=>t.onChange(parseInt(o.target.value)||1)})}),e.jsx(A,{})]})})]}),e.jsx(L,{control:r.control,name:"content",render:({field:t})=>e.jsxs(D,{children:[e.jsx(_,{children:"Content *"}),e.jsx(F,{children:e.jsx(je,{placeholder:"In this lesson we learn basic greetings...",className:"min-h-[120px]",...t})}),e.jsx(A,{})]})})]}),e.jsxs(ae,{children:[e.jsx(x,{type:"button",variant:"outline",onClick:()=>d(!1),children:"Cancel"}),e.jsx(x,{type:"submit",disabled:a.isPending,className:"min-w-[120px]",children:a.isPending?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),"Updating..."]}):"Update Lesson"})]})]})})]})}):null}function it({data:s,isLoading:f,onEdit:d,onRefresh:g}){const[m,r]=h.useState(!1),[a,c]=h.useState(null),t=U(),o=O({mutationFn:n=>w.words.delete(n),onSuccess:n=>{y.success(n.message),t.invalidateQueries({queryKey:["words"]}),g(),r(!1),c(null)},onError:n=>{y.error("Failed to delete word"),console.error("Delete error:",n)}}),j=n=>{c(n),r(!0)},N=()=>{a&&o.mutate(a.id)},i=n=>{if(n){const T=Z(n);T&&new Audio(T).play().catch(u=>{console.error("Error playing audio:",u),y.error("Failed to play audio")})}};return f?e.jsxs(W,{children:[e.jsxs(P,{children:[e.jsx(K,{children:"Words"}),e.jsx(z,{children:"Loading..."})]}),e.jsx(B,{children:e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})})})]}):s.length===0?e.jsxs(W,{children:[e.jsxs(P,{children:[e.jsx(K,{children:"Words"}),e.jsx(z,{children:"No words found"})]}),e.jsx(B,{children:e.jsxs("div",{className:"flex flex-col items-center justify-center py-8",children:[e.jsx(Le,{className:"h-12 w-12 text-muted-foreground mb-4"}),e.jsxs("p",{className:"text-muted-foreground text-center",children:["No words have been created yet.",e.jsx("br",{}),'Click "Add Word" to get started.']})]})})]}):e.jsxs(e.Fragment,{children:[e.jsxs(W,{className:"border-0 shadow-lg bg-gradient-to-br from-card via-card to-card/95",children:[e.jsx(P,{className:"pb-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs(K,{className:"text-xl font-semibold flex items-center gap-2",children:[e.jsx(Le,{className:"h-5 w-5 text-primary"}),"Words (",s.length,")"]}),e.jsx(z,{className:"mt-1",children:"Manage vocabulary words and their translations"})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"Total Words"}),e.jsx("div",{className:"text-2xl font-bold text-primary",children:s.length})]})]})}),e.jsx(B,{children:e.jsxs(Ae,{children:[e.jsx(Ee,{children:e.jsxs(H,{children:[e.jsx(C,{children:"Word"}),e.jsx(C,{children:"Translation"}),e.jsx(C,{children:"Example"}),e.jsx(C,{children:"Media"}),e.jsx(C,{className:"w-[70px]",children:"Actions"})]})}),e.jsx(ke,{children:s.map(n=>e.jsxs(H,{children:[e.jsx(S,{className:"max-w-[200px]",children:e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"font-medium truncate",title:n.word,children:n.word}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:["ID: #",n.id]})]})}),e.jsx(S,{className:"max-w-[200px]",children:e.jsx("div",{className:"font-medium text-green-600 truncate",title:n.translation,children:n.translation})}),e.jsx(S,{className:"max-w-[300px]",children:e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-sm text-muted-foreground truncate",title:n.example_sentence,children:n.example_sentence}),n.example_audio&&e.jsxs(x,{variant:"ghost",size:"sm",className:"h-6 px-2 text-xs",onClick:()=>i(n.example_audio),children:[e.jsx(de,{className:"h-3 w-3 mr-1"}),"Play Example"]})]})}),e.jsx(S,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[n.audio_url&&e.jsx(x,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0",onClick:()=>i(n.audio_url),title:"Play audio",children:e.jsx(de,{className:"h-4 w-4 text-blue-600"})}),n.image_url&&e.jsx(x,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0",onClick:()=>window.open(Z(n.image_url),"_blank"),title:"View image",children:e.jsx(Fe,{className:"h-4 w-4 text-green-600"})}),!n.audio_url&&!n.image_url&&e.jsx(De,{variant:"outline",className:"text-xs",children:"No media"})]})}),e.jsx(S,{children:e.jsxs(Ue,{children:[e.jsx(Oe,{asChild:!0,children:e.jsxs(x,{variant:"ghost",className:"h-8 w-8 p-0",children:[e.jsx("span",{className:"sr-only",children:"Open menu"}),e.jsx(Te,{className:"h-4 w-4"})]})}),e.jsxs(Ie,{align:"end",children:[e.jsx(Me,{children:"Actions"}),e.jsxs(R,{onClick:()=>d(n),children:[e.jsx(Y,{className:"mr-2 h-4 w-4"}),"Edit"]}),e.jsxs(R,{onClick:()=>j(n),className:"text-red-600",children:[e.jsx(qe,{className:"mr-2 h-4 w-4"}),"Delete"]})]})]})})]},n.id))})]})})]}),e.jsx(We,{open:m,onOpenChange:r,title:"Delete Word",desc:`Are you sure you want to delete "${a?.word}"? This action cannot be undone.`,confirmText:"Delete",handleConfirm:N,isLoading:o.isPending})]})}function ce({onGenerate:s,children:f,queryKey:d,disabled:g=!1}){const m=U(),r=O({mutationFn:s,onSuccess:c=>{y.success(c.message||"Audio generated successfully"),d&&m.invalidateQueries({queryKey:d})},onError:c=>{y.error("Failed to generate audio"),console.error("Audio generation error:",c)}}),a=()=>{r.mutate()};return e.jsx(x,{type:"button",variant:"outline",size:"sm",onClick:a,disabled:g||r.isPending,className:"flex items-center gap-2",children:r.isPending?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-current"}),"Generating..."]}):f||e.jsxs(e.Fragment,{children:[e.jsx(X,{className:"h-4 w-4"}),"Generate"]})})}function oe({onUpload:s,accept:f,children:d,queryKey:g,disabled:m=!1}){const r=h.useRef(null),a=U(),c=O({mutationFn:async j=>{console.log("Starting upload for file:",j.name,"Size:",j.size,"Type:",j.type);try{const N=await s(j);return console.log("Upload successful:",N),N}catch(N){throw console.error("Upload failed:",N),N}},onSuccess:j=>{console.log("Upload success handler:",j),y.success(j.message||"File uploaded successfully"),g&&a.invalidateQueries({queryKey:g})},onError:j=>{console.error("Upload error handler:",j);const N=j?.response?.data?.detail||j?.message||"Failed to upload file";y.error(N)}}),t=j=>{const N=j.target.files?.[0];if(N){if(N.size>10*1024*1024){y.error("File size must be less than 10MB");return}c.mutate(N)}j.target.value=""},o=()=>{r.current?.click()};return e.jsxs(e.Fragment,{children:[e.jsx(x,{type:"button",variant:"outline",size:"sm",onClick:o,disabled:m||c.isPending,className:"flex items-center gap-2",children:c.isPending?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-current"}),"Uploading..."]}):d||e.jsxs(e.Fragment,{children:[e.jsx(I,{className:"h-4 w-4"}),"Upload"]})}),e.jsx("input",{ref:r,type:"file",accept:f,onChange:t,className:"hidden"})]})}const ot=xe({word:M().min(1,"Word is required"),translation:M().min(1,"Translation is required"),example_sentence:M().min(1,"Example sentence is required")});function dt({lessonId:s,children:f,onSuccess:d}){const[g,m]=h.useState(!1),[r,a]=h.useState(null),c=U(),t=he({resolver:ue(ot),defaultValues:{word:"",translation:"",example_sentence:""}}),o=O({mutationFn:i=>w.words.create({...i,lesson_id:s,audio_url:null,image_url:null,example_audio:null}),onSuccess:i=>{y.success("Word created successfully"),c.invalidateQueries({queryKey:["words",s]}),a(i.id),t.reset(),d?.()},onError:i=>{y.error("Failed to create word"),console.error("Create word error:",i)}}),j=i=>{o.mutate(i)},N=i=>{m(i),i||(a(null),t.reset())};return e.jsxs(J,{open:g,onOpenChange:N,children:[e.jsx(Pe,{asChild:!0,children:f||e.jsxs(x,{children:[e.jsx(Ze,{className:"h-4 w-4"}),"Add Word"]})}),e.jsxs(ee,{className:"sm:max-w-[600px]",children:[e.jsxs(se,{children:[e.jsxs(te,{className:"flex items-center gap-2",children:[e.jsx(Le,{className:"h-5 w-5"}),"Create New Word"]}),e.jsx(re,{children:"Add a new vocabulary word with translation and example sentence."})]}),e.jsx(me,{...t,children:e.jsxs("form",{onSubmit:t.handleSubmit(j),className:"space-y-6",children:[e.jsxs("div",{className:"grid gap-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(L,{control:t.control,name:"word",render:({field:i})=>e.jsxs(D,{children:[e.jsx(_,{children:"Word *"}),e.jsx(F,{children:e.jsx(Q,{placeholder:"e.g., hello",...i})}),e.jsx(A,{})]})}),e.jsx(L,{control:t.control,name:"translation",render:({field:i})=>e.jsxs(D,{children:[e.jsx(_,{children:"Translation *"}),e.jsx(F,{children:e.jsx(Q,{placeholder:"e.g., salom",...i})}),e.jsx(A,{})]})})]}),e.jsx(L,{control:t.control,name:"example_sentence",render:({field:i})=>e.jsxs(D,{children:[e.jsx(_,{children:"Example Sentence *"}),e.jsx(F,{children:e.jsx(je,{placeholder:"Hello, how are you?",className:"min-h-[80px]",...i})}),e.jsx(A,{})]})}),r&&e.jsx("div",{className:"grid gap-4",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"text-sm font-medium text-green-600",children:"✓ Word Created! Add Media (Optional)"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("span",{className:"text-sm font-medium",children:"Word Audio"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(ce,{onGenerate:()=>w.words.generateAudio(r,null),queryKey:["words",s],children:[e.jsx(X,{className:"h-4 w-4 mr-2"}),"Generate"]}),e.jsxs(oe,{accept:"audio/mp3,audio/mpeg,audio/*",onUpload:i=>w.words.uploadAudio(r,i),queryKey:["words",s],children:[e.jsx(I,{className:"h-4 w-4 mr-2"}),"Upload Audio"]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("span",{className:"text-sm font-medium",children:"Word Image"}),e.jsxs(oe,{accept:"image/jpeg,image/png,image/jpg,image/*",onUpload:i=>w.words.uploadImage(r,i),queryKey:["words",s],children:[e.jsx(Fe,{className:"h-4 w-4 mr-2"}),"Upload Image"]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("span",{className:"text-sm font-medium",children:"Example Audio"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(ce,{onGenerate:()=>w.words.generateExampleAudio(r,null),queryKey:["words",s],children:[e.jsx(X,{className:"h-4 w-4 mr-2"}),"Generate"]}),e.jsxs(oe,{accept:"audio/mp3,audio/mpeg,audio/*",onUpload:i=>w.words.uploadExampleAudio(r,i),queryKey:["words",s],children:[e.jsx(I,{className:"h-4 w-4 mr-2"}),"Upload Audio"]})]})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Media upload is optional. You can add or update media files later by editing the word."})]})})]}),e.jsxs(ae,{children:[e.jsx(x,{type:"button",variant:"outline",onClick:()=>m(!1),children:r?"Done":"Cancel"}),!r&&e.jsx(x,{type:"submit",disabled:o.isPending,className:"min-w-[120px]",children:o.isPending?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),"Creating..."]}):"Create Word"})]})]})})]})]})}const ct=xe({word:M().min(1,"Word is required"),translation:M().min(1,"Translation is required"),example_sentence:M().min(1,"Example sentence is required")});function xt({word:s,open:f,onOpenChange:d,onSuccess:g}){const m=U(),r=he({resolver:ue(ct),defaultValues:{word:"",translation:"",example_sentence:""}}),a=O({mutationFn:t=>{if(!s)throw new Error("No word selected");return w.words.update(s.id,t)},onSuccess:()=>{y.success("Word updated successfully"),m.invalidateQueries({queryKey:["words",s?.lesson_id]}),d(!1),g?.()},onError:t=>{y.error("Failed to update word"),console.error("Update word error:",t)}});h.useEffect(()=>{s&&r.reset({word:s.word,translation:s.translation,example_sentence:s.example_sentence})},[s,r]);const c=t=>{a.mutate(t)};return s?e.jsx(J,{open:f,onOpenChange:d,children:e.jsxs(ee,{className:"sm:max-w-[600px]",children:[e.jsxs(se,{children:[e.jsxs(te,{className:"flex items-center gap-2",children:[e.jsx(Y,{className:"h-5 w-5"}),"Edit Word"]}),e.jsx(re,{children:"Update the word information, translation, and example sentence."})]}),e.jsx(me,{...r,children:e.jsxs("form",{onSubmit:r.handleSubmit(c),className:"space-y-6",children:[e.jsxs("div",{className:"grid gap-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(L,{control:r.control,name:"word",render:({field:t})=>e.jsxs(D,{children:[e.jsx(_,{children:"Word *"}),e.jsx(F,{children:e.jsx(Q,{placeholder:"e.g., hello",...t})}),e.jsx(A,{})]})}),e.jsx(L,{control:r.control,name:"translation",render:({field:t})=>e.jsxs(D,{children:[e.jsx(_,{children:"Translation *"}),e.jsx(F,{children:e.jsx(Q,{placeholder:"e.g., salom",...t})}),e.jsx(A,{})]})})]}),e.jsx(L,{control:r.control,name:"example_sentence",render:({field:t})=>e.jsxs(D,{children:[e.jsx(_,{children:"Example Sentence *"}),e.jsx(F,{children:e.jsx(je,{placeholder:"Hello, how are you?",className:"min-h-[80px]",...t})}),e.jsx(A,{})]})}),e.jsx("div",{className:"grid gap-4",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"text-sm font-medium text-muted-foreground",children:"Media Management"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium",children:"Word Audio"}),s?.audio_url&&e.jsx(x,{type:"button",variant:"ghost",size:"sm",onClick:()=>{new Audio(Z(s.audio_url)).play().catch(console.error)},children:e.jsx(de,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(ce,{onGenerate:()=>w.words.generateAudio(s.id,null),queryKey:["words",s?.lesson_id],children:[e.jsx(X,{className:"h-4 w-4 mr-2"}),"Generate"]}),e.jsxs(oe,{accept:"audio/mp3,audio/mpeg,audio/*",onUpload:t=>w.words.uploadAudio(s.id,t),queryKey:["words",s?.lesson_id],children:[e.jsx(I,{className:"h-4 w-4 mr-2"}),"Upload Audio"]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium",children:"Word Image"}),s?.image_url&&e.jsx(x,{type:"button",variant:"ghost",size:"sm",onClick:()=>window.open(Z(s.image_url),"_blank"),children:e.jsx(Fe,{className:"h-4 w-4"})})]}),e.jsxs(oe,{accept:"image/jpeg,image/png,image/jpg,image/*",onUpload:t=>w.words.uploadImage(s.id,t),queryKey:["words",s?.lesson_id],children:[e.jsx(Fe,{className:"h-4 w-4 mr-2"}),s?.image_url?"Replace Image":"Upload Image"]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium",children:"Example Audio"}),s?.example_audio&&e.jsx(x,{type:"button",variant:"ghost",size:"sm",onClick:()=>{new Audio(Z(s.example_audio)).play().catch(console.error)},children:e.jsx(de,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(ce,{onGenerate:()=>w.words.generateExampleAudio(s.id,null),queryKey:["words",s?.lesson_id],children:[e.jsx(X,{className:"h-4 w-4 mr-2"}),"Generate"]}),e.jsxs(oe,{accept:"audio/mp3,audio/mpeg,audio/*",onUpload:t=>w.words.uploadExampleAudio(s.id,t),queryKey:["words",s?.lesson_id],children:[e.jsx(I,{className:"h-4 w-4 mr-2"}),"Upload Audio"]})]})]})]})})]}),e.jsxs(ae,{children:[e.jsx(x,{type:"button",variant:"outline",onClick:()=>d(!1),children:"Cancel"}),e.jsx(x,{type:"submit",disabled:a.isPending,className:"min-w-[120px]",children:a.isPending?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),"Updating..."]}):"Update Word"})]})]})})]})}):null}function mt({data:s,isLoading:f,onEdit:d,onRefresh:g}){const[m,r]=h.useState(!1),[a,c]=h.useState(null),t=U(),o=O({mutationFn:n=>w.stories.delete(n),onSuccess:n=>{y.success(n.message),t.invalidateQueries({queryKey:["stories"]}),g(),r(!1),c(null)},onError:n=>{y.error("Failed to delete story"),console.error("Delete error:",n)}}),j=n=>{c(n),r(!0)},N=()=>{a&&o.mutate(a.id)},i=n=>{if(n){const T=Z(n);T&&new Audio(T).play().catch(u=>{console.error("Error playing audio:",u),y.error("Failed to play audio")})}};return f?e.jsxs(W,{children:[e.jsxs(P,{children:[e.jsx(K,{children:"Stories"}),e.jsx(z,{children:"Loading..."})]}),e.jsx(B,{children:e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})})})]}):s.length===0?e.jsxs(W,{children:[e.jsxs(P,{children:[e.jsx(K,{children:"Stories"}),e.jsx(z,{children:"No stories found"})]}),e.jsx(B,{children:e.jsxs("div",{className:"flex flex-col items-center justify-center py-8",children:[e.jsx(ve,{className:"h-12 w-12 text-muted-foreground mb-4"}),e.jsxs("p",{className:"text-muted-foreground text-center",children:["No stories have been created yet.",e.jsx("br",{}),'Click "Add Story" to get started.']})]})})]}):e.jsxs(e.Fragment,{children:[e.jsxs(W,{className:"border-0 shadow-lg bg-gradient-to-br from-card via-card to-card/95",children:[e.jsx(P,{className:"pb-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs(K,{className:"text-xl font-semibold flex items-center gap-2",children:[e.jsx(ve,{className:"h-5 w-5 text-primary"}),"Stories (",s.length,")"]}),e.jsx(z,{className:"mt-1",children:"Manage story content for this lesson"})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"Total Stories"}),e.jsx("div",{className:"text-2xl font-bold text-primary",children:s.length})]})]})}),e.jsx(B,{children:e.jsxs(Ae,{children:[e.jsx(Ee,{children:e.jsxs(H,{children:[e.jsx(C,{children:"Story Text"}),e.jsx(C,{children:"Audio"}),e.jsx(C,{className:"w-[70px]",children:"Actions"})]})}),e.jsx(ke,{children:s.map(n=>e.jsxs(H,{children:[e.jsx(S,{className:"max-w-[500px]",children:e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"text-sm text-muted-foreground",style:{display:"-webkit-box",WebkitLineClamp:3,WebkitBoxOrient:"vertical",overflow:"hidden"},title:n.story_text,children:n.story_text}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:["ID: #",n.id," • ",n.story_text.length," characters"]})]})}),e.jsx(S,{children:e.jsx("div",{className:"flex items-center gap-2",children:n.audio_url?e.jsx(x,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0",onClick:()=>i(n.audio_url),title:"Play story audio",children:e.jsx(de,{className:"h-4 w-4 text-blue-600"})}):e.jsx(De,{variant:"outline",className:"text-xs",children:"No audio"})})}),e.jsx(S,{children:e.jsxs(Ue,{children:[e.jsx(Oe,{asChild:!0,children:e.jsxs(x,{variant:"ghost",className:"h-8 w-8 p-0",children:[e.jsx("span",{className:"sr-only",children:"Open menu"}),e.jsx(Te,{className:"h-4 w-4"})]})}),e.jsxs(Ie,{align:"end",children:[e.jsx(Me,{children:"Actions"}),e.jsxs(R,{onClick:()=>d(n),children:[e.jsx(Y,{className:"mr-2 h-4 w-4"}),"Edit"]}),e.jsxs(R,{onClick:()=>j(n),className:"text-red-600",children:[e.jsx(qe,{className:"mr-2 h-4 w-4"}),"Delete"]})]})]})})]},n.id))})]})})]}),e.jsx(We,{open:m,onOpenChange:r,title:"Delete Story",desc:"Are you sure you want to delete this story? This action cannot be undone.",confirmText:"Delete",handleConfirm:N,isLoading:o.isPending})]})}function ds({title:s,description:f,accept:d,maxSize:g=10,onUpload:m,children:r,queryKey:a}){const[c,t]=h.useState(!1),[o,j]=h.useState(null),[N,i]=h.useState(!1),n=h.useRef(null),T=U(),E=O({mutationFn:()=>{if(!o)throw new Error("No file selected");return m(o)},onSuccess:b=>{y.success(b.message),a&&T.invalidateQueries({queryKey:a}),j(null),t(!1)},onError:b=>{y.error("Failed to upload file"),console.error("File upload error:",b)}}),u=b=>{if(b.size>g*1024*1024){y.error(`File size must be less than ${g}MB`);return}j(b)},G=b=>{b.preventDefault(),i(!1);const q=Array.from(b.dataTransfer.files);q.length>0&&u(q[0])},pe=b=>{b.preventDefault(),i(!0)},ne=b=>{b.preventDefault(),i(!1)},ge=b=>{const q=Array.from(b.target.files||[]);q.length>0&&u(q[0])},p=()=>{E.mutate()},v=()=>d.includes("image")?e.jsx(et,{className:"h-8 w-8"}):d.includes("audio")?e.jsx(Ys,{className:"h-8 w-8"}):e.jsx(I,{className:"h-8 w-8"}),Ke=b=>{if(b===0)return"0 Bytes";const q=1024,le=["Bytes","KB","MB","GB"],be=Math.floor(Math.log(b)/Math.log(q));return parseFloat((b/Math.pow(q,be)).toFixed(2))+" "+le[be]};return e.jsxs(J,{open:c,onOpenChange:t,children:[e.jsx(Pe,{asChild:!0,children:r||e.jsxs(x,{variant:"outline",size:"sm",children:[e.jsx(I,{className:"h-4 w-4 mr-2"}),"Upload File"]})}),e.jsxs(ee,{className:"sm:max-w-[500px]",children:[e.jsxs(se,{children:[e.jsxs(te,{className:"flex items-center gap-2",children:[e.jsx(I,{className:"h-5 w-5"}),s]}),e.jsx(re,{children:f})]}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsx("div",{className:`border-2 border-dashed rounded-lg p-8 text-center transition-colors ${N?"border-primary bg-primary/5":"border-muted-foreground/25 hover:border-primary/50"}`,onDrop:G,onDragOver:pe,onDragLeave:ne,children:o?e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"flex items-center justify-center text-green-600",children:v()}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"font-medium",children:o.name}),e.jsx("p",{className:"text-sm text-muted-foreground",children:Ke(o.size)})]}),e.jsxs(x,{variant:"outline",size:"sm",onClick:()=>j(null),children:[e.jsx(Rs,{className:"h-4 w-4 mr-2"}),"Remove"]})]}):e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"flex items-center justify-center text-muted-foreground",children:v()}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"font-medium",children:"Drop your file here"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["or click to browse (max ",g,"MB)"]})]}),e.jsx(x,{variant:"outline",onClick:()=>n.current?.click(),children:"Browse Files"})]})}),e.jsx("input",{ref:n,type:"file",accept:d,onChange:ge,className:"hidden"})]}),e.jsxs(ae,{children:[e.jsx(x,{type:"button",variant:"outline",onClick:()=>t(!1),children:"Cancel"}),e.jsx(x,{type:"button",onClick:p,disabled:!o||E.isPending,className:"min-w-[120px]",children:E.isPending?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),"Uploading..."]}):e.jsxs(e.Fragment,{children:[e.jsx(I,{className:"h-4 w-4 mr-2"}),"Upload"]})})]})]})]})}const ht=xe({story_text:M().min(1,"Story text is required")});function ut({lessonId:s,children:f,onSuccess:d}){const[g,m]=h.useState(!1),[r,a]=h.useState(null),c=U(),t=he({resolver:ue(ht),defaultValues:{story_text:""}}),o=O({mutationFn:i=>w.stories.create({...i,lesson_id:s,audio_url:null}),onSuccess:i=>{y.success("Story created successfully"),c.invalidateQueries({queryKey:["stories",s]}),a(i.id),t.reset(),d?.()},onError:i=>{y.error("Failed to create story"),console.error("Create story error:",i)}}),j=i=>{o.mutate(i)},N=i=>{m(i),i||(a(null),t.reset())};return e.jsxs(J,{open:g,onOpenChange:N,children:[e.jsx(Pe,{asChild:!0,children:f||e.jsxs(x,{children:[e.jsx(Ze,{className:"h-4 w-4"}),"Add Story"]})}),e.jsxs(ee,{className:"sm:max-w-[600px]",children:[e.jsxs(se,{children:[e.jsxs(te,{className:"flex items-center gap-2",children:[e.jsx(ve,{className:"h-5 w-5"}),"Create New Story"]}),e.jsx(re,{children:"Add a new story to this lesson with engaging content."})]}),e.jsx(me,{...t,children:e.jsxs("form",{onSubmit:t.handleSubmit(j),className:"space-y-6",children:[e.jsxs("div",{className:"grid gap-4",children:[e.jsx(L,{control:t.control,name:"story_text",render:({field:i})=>e.jsxs(D,{children:[e.jsx(_,{children:"Story Content *"}),e.jsx(F,{children:e.jsx(je,{placeholder:"Once upon a time, there was a young student learning English...",className:"min-h-[200px]",...i})}),e.jsx(A,{})]})}),r&&e.jsx("div",{className:"grid gap-4",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"text-sm font-medium text-green-600",children:"✓ Story Created! Add Audio (Optional)"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("span",{className:"text-sm font-medium",children:"Story Narration"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(ce,{onGenerate:()=>w.stories.generateAudio(r,null),queryKey:["stories",s],children:[e.jsx(X,{className:"h-4 w-4 mr-2"}),"Generate"]}),e.jsx(ds,{title:"Upload Story Audio",description:"Upload an MP3 audio file for story narration.",accept:"audio/mp3,audio/mpeg",onUpload:i=>w.stories.uploadAudio(r,i),queryKey:["stories",s],children:e.jsxs(x,{type:"button",variant:"outline",size:"sm",children:[e.jsx(I,{className:"h-4 w-4 mr-2"}),"Upload"]})})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Generate AI narration or upload your own audio file for this story."})]})]})})]}),e.jsxs(ae,{children:[e.jsx(x,{type:"button",variant:"outline",onClick:()=>m(!1),children:r?"Done":"Cancel"}),!r&&e.jsx(x,{type:"submit",disabled:o.isPending,className:"min-w-[120px]",children:o.isPending?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),"Creating..."]}):"Create Story"})]})]})})]})]})}const jt=xe({story_text:M().min(1,"Story text is required")});function pt({story:s,open:f,onOpenChange:d,onSuccess:g}){const m=U(),r=he({resolver:ue(jt),defaultValues:{story_text:""}}),a=O({mutationFn:t=>{if(!s)throw new Error("No story selected");return w.stories.update(s.id,t)},onSuccess:()=>{y.success("Story updated successfully"),m.invalidateQueries({queryKey:["stories",s?.lesson_id]}),d(!1),g?.()},onError:t=>{y.error("Failed to update story"),console.error("Update story error:",t)}});h.useEffect(()=>{s&&r.reset({story_text:s.story_text})},[s,r]);const c=t=>{a.mutate(t)};return s?e.jsx(J,{open:f,onOpenChange:d,children:e.jsxs(ee,{className:"sm:max-w-[600px]",children:[e.jsxs(se,{children:[e.jsxs(te,{className:"flex items-center gap-2",children:[e.jsx(Y,{className:"h-5 w-5"}),"Edit Story"]}),e.jsx(re,{children:"Update the story content and narration."})]}),e.jsx(me,{...r,children:e.jsxs("form",{onSubmit:r.handleSubmit(c),className:"space-y-6",children:[e.jsxs("div",{className:"grid gap-4",children:[e.jsx(L,{control:r.control,name:"story_text",render:({field:t})=>e.jsxs(D,{children:[e.jsx(_,{children:"Story Content *"}),e.jsx(F,{children:e.jsx(je,{placeholder:"Once upon a time, there was a young student learning English...",className:"min-h-[200px]",...t})}),e.jsx(A,{})]})}),e.jsx("div",{className:"grid gap-4",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"text-sm font-medium text-muted-foreground",children:"Audio Management"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium",children:"Story Narration"}),s?.audio_url&&e.jsx(x,{type:"button",variant:"ghost",size:"sm",onClick:()=>{new Audio(Z(s.audio_url)).play().catch(console.error)},children:e.jsx(de,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(ce,{onGenerate:()=>w.stories.generateAudio(s.id,null),queryKey:["stories",s?.lesson_id],children:[e.jsx(X,{className:"h-4 w-4 mr-2"}),"Generate"]}),e.jsx(ds,{title:"Upload Story Audio",description:"Upload an MP3 audio file for story narration.",accept:"audio/mp3,audio/mpeg",onUpload:t=>w.stories.uploadAudio(s.id,t),queryKey:["stories",s?.lesson_id],children:e.jsxs(x,{type:"button",variant:"outline",size:"sm",children:[e.jsx(I,{className:"h-4 w-4 mr-2"}),"Upload"]})})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Generate AI narration or upload your own audio file for this story."})]})]})})]}),e.jsxs(ae,{children:[e.jsx(x,{type:"button",variant:"outline",onClick:()=>d(!1),children:"Cancel"}),e.jsx(x,{type:"submit",disabled:a.isPending,className:"min-w-[120px]",children:a.isPending?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),"Updating..."]}):"Update Story"})]})]})})]})}):null}function gt(){const s=()=>{const l=new URLSearchParams(window.location.search);return{courseId:l.get("courseId")?Number(l.get("courseId")):void 0,chapterId:l.get("chapterId")?Number(l.get("chapterId")):void 0,lessonId:l.get("lessonId")?Number(l.get("lessonId")):void 0,tab:l.get("tab")||"courses"}},f=l=>{const k=new URLSearchParams(window.location.search);Object.entries(l).forEach(([ss,$e])=>{$e==null?k.delete(ss):k.set(ss,String($e))});const $=`${window.location.pathname}?${k.toString()}`;window.history.pushState({},"",$)},[d,g]=h.useState(null),[m,r]=h.useState(null),[a,c]=h.useState(null),[t,o]=h.useState(!1),[j,N]=h.useState(!1),[i,n]=h.useState(!1),[T,E]=h.useState(!1),[u,G]=h.useState(null),[pe,ne]=h.useState(!1),[ge,p]=h.useState(null),[v,Ke]=h.useState(""),[b,q]=h.useState("courses"),{data:le=[],isLoading:be,refetch:cs}=fe({queryKey:["courses"],queryFn:()=>w.courses.list()}),ze=d?.id,{data:Ce=[],isLoading:xs,refetch:ms}=fe({queryKey:["chapters",ze],queryFn:()=>w.chapters.listByCourse(ze),enabled:!!ze}),Be=m?.id,{data:Se=[],isLoading:hs,refetch:us}=fe({queryKey:["lessons",Be],queryFn:()=>w.lessons.listByChapter(Be),enabled:!!Be}),ie=a?.id,{data:js=[],isLoading:ps,refetch:gs}=fe({queryKey:["words",ie],queryFn:()=>w.words.listByLesson(ie),enabled:!!ie}),{data:fs=[],isLoading:Ns,refetch:ys}=fe({queryKey:["stories",ie],queryFn:()=>w.stories.listByLesson(ie),enabled:!!ie});h.useEffect(()=>{const l=s();q(l.tab)},[]),h.useEffect(()=>{const l=s();if(le.length>0&&l.courseId){const k=le.find($=>$.id===l.courseId);k&&g(k)}},[le]),h.useEffect(()=>{const l=s();if(Ce.length>0&&l.chapterId){const k=Ce.find($=>$.id===l.chapterId);k&&r(k)}},[Ce]),h.useEffect(()=>{const l=s();if(Se.length>0&&l.lessonId){const k=Se.find($=>$.id===l.lessonId);k&&c(k)}},[Se]);const ws=l=>{g(l),o(!0)},vs=l=>{r(l),N(!0)},bs=l=>{c(l),n(!0)},Cs=l=>{G(l),E(!0)},Ss=l=>{p(l),ne(!0)},Ls=l=>{c(l);const k=l.lesson_type==="word"?"words":l.lesson_type==="story"?"story":"words";q(k),f({lessonId:l.id,tab:k})},Ds=l=>{g(l),q("chapters"),f({courseId:l.id,chapterId:void 0,lessonId:void 0,tab:"chapters"})},_s=l=>{r(l),q("lessons"),f({chapterId:l.id,lessonId:void 0,tab:"lessons"})},Ge=()=>{cs()},Re=()=>{ms()},Qe=()=>{us()},Ve=()=>{gs()},He=()=>{ys()},Xe=le.filter(l=>l.title.toLowerCase().includes(v.toLowerCase())||l.native_language.toLowerCase().includes(v.toLowerCase())||l.learning_language.toLowerCase().includes(v.toLowerCase())),Ye=Ce.filter(l=>l.title.toLowerCase().includes(v.toLowerCase())),Je=Se.filter(l=>l.title.toLowerCase().includes(v.toLowerCase())||l.content.toLowerCase().includes(v.toLowerCase())),es=js.filter(l=>l.word.toLowerCase().includes(v.toLowerCase())||l.translation.toLowerCase().includes(v.toLowerCase())||l.example_sentence.toLowerCase().includes(v.toLowerCase())),Fs=fs.filter(l=>l.story_text.toLowerCase().includes(v.toLowerCase()));return e.jsxs(e.Fragment,{children:[e.jsxs(qs,{children:[e.jsx(As,{links:ft}),e.jsxs("div",{className:"ms-auto flex items-center space-x-4",children:[e.jsx(Us,{}),e.jsx(Os,{}),e.jsx(Is,{}),e.jsx(Ms,{})]})]}),e.jsxs(Es,{children:[e.jsx("div",{className:"mb-6 flex flex-col gap-4 md:flex-row md:items-center md:justify-between",children:e.jsxs("div",{className:"space-y-1",children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight bg-gradient-to-r from-primary to-primary/70 bg-clip-text text-transparent",children:"Zehnly Duo Management"}),e.jsx("p",{className:"text-muted-foreground text-lg",children:"Complete language learning content management system"})]})}),e.jsx("div",{className:"mb-6",children:e.jsx(Q,{placeholder:"Search across all content...",value:v,onChange:l=>Ke(l.target.value),className:"max-w-sm"})}),e.jsxs(ks,{value:b,onValueChange:l=>{q(l),f({tab:l})},className:"space-y-6",children:[e.jsxs(Ts,{className:"grid w-full grid-cols-5",children:[e.jsxs(Ne,{value:"courses",className:"flex items-center gap-2",children:[e.jsx(Qs,{className:"h-4 w-4"}),"Courses (",Xe.length,")"]}),e.jsxs(Ne,{value:"chapters",className:"flex items-center gap-2",children:[e.jsx(ve,{className:"h-4 w-4"}),"Chapters (",Ye.length,")"]}),e.jsxs(Ne,{value:"lessons",className:"flex items-center gap-2",children:[e.jsx(V,{className:"h-4 w-4"}),"Lessons (",Je.length,")"]}),e.jsxs(Ne,{value:"words",className:"flex items-center gap-2",children:[e.jsx(Le,{className:"h-4 w-4"}),"Words (",es.length,")"]}),e.jsxs(Ne,{value:"story",className:"flex items-center gap-2",children:[e.jsx(ve,{className:"h-4 w-4"}),"Story Content"]})]}),e.jsxs(ye,{value:"courses",className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-2xl font-semibold",children:"Courses"}),e.jsx(Ps,{onSuccess:Ge,children:e.jsxs(x,{children:[e.jsx(we,{className:"mr-2 h-4 w-4"}),"Add Course"]})})]}),e.jsx(st,{data:Xe,isLoading:be,onEdit:ws,onCourseClick:Ds,onRefresh:Ge,selectedCourse:d})]}),e.jsxs(ye,{value:"chapters",className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-semibold",children:"Chapters"}),d&&e.jsxs("p",{className:"text-muted-foreground",children:[d.title," • ",d.native_language," → ",d.learning_language]})]}),d&&e.jsx(Hs,{courseId:d.id,onSuccess:Re,children:e.jsxs(x,{children:[e.jsx(we,{className:"mr-2 h-4 w-4"}),"Add Chapter"]})})]}),d?e.jsx($s,{data:Ye,isLoading:xs,onEdit:vs,onChapterClick:_s,onRefresh:Re,selectedChapter:m}):e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"Select a course from the Courses tab to view its chapters"})]}),e.jsxs(ye,{value:"lessons",className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-semibold",children:"Lessons"}),m&&e.jsxs("p",{className:"text-muted-foreground",children:[m.title," • Order ",m.order]})]}),m&&e.jsx(at,{chapterId:m.id,onSuccess:Qe,children:e.jsxs(x,{children:[e.jsx(we,{className:"mr-2 h-4 w-4"}),"Add Lesson"]})})]}),m?e.jsx(tt,{data:Je,isLoading:hs,onEdit:bs,onLessonClick:Ls,onRefresh:Qe,selectedLesson:a}):e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"Select a chapter from the Chapters tab to view its lessons"})]}),e.jsxs(ye,{value:"words",className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-semibold",children:"Words"}),a&&e.jsxs("p",{className:"text-muted-foreground",children:[a.title," • ",a.lesson_type," lesson • Order ",a.order]})]}),a&&e.jsx(dt,{lessonId:a.id,onSuccess:Ve,children:e.jsxs(x,{children:[e.jsx(we,{className:"mr-2 h-4 w-4"}),"Add Word"]})})]}),a?e.jsx(it,{data:es,isLoading:ps,onEdit:Cs,onRefresh:Ve}):e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"Select a lesson from the Lessons tab to view its vocabulary words"})]}),e.jsxs(ye,{value:"story",className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-semibold",children:"Story Management"}),a&&e.jsxs("p",{className:"text-muted-foreground",children:[a.title," • Story lesson • Order ",a.order]})]}),a&&a.lesson_type==="story"&&e.jsx(ut,{lessonId:a.id,onSuccess:He,children:e.jsxs(x,{children:[e.jsx(we,{className:"mr-2 h-4 w-4"}),"Add Story"]})})]}),a&&a.lesson_type==="story"?e.jsx(mt,{data:Fs,isLoading:Ns,onEdit:Ss,onRefresh:He}):e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"Select a story lesson from the Lessons tab to manage its stories"})]})]})]}),e.jsx(Ks,{course:d,open:t,onOpenChange:o,onSuccess:Ge}),e.jsx(Zs,{chapter:m,open:j,onOpenChange:N,onSuccess:Re}),e.jsx(lt,{lesson:a,open:i,onOpenChange:n,onSuccess:Qe}),e.jsx(xt,{word:u,open:T,onOpenChange:E,onSuccess:Ve}),e.jsx(pt,{story:ge,open:pe,onOpenChange:ne,onSuccess:He})]})}const ft=[{title:"Zehnly Duo",href:"/zehnly-duo",isActive:!0,disabled:!1}],It=gt;export{It as component};

import{r as j,f as xe,t as b,j as e,B as u,c as re,u as ze,l as He}from"./index-CsXLUnfy.js";import{l as Q,u as ye,F as Be,g as L,h as _,i as k,j as D,k as T,S as Ve,T as Ge,a as Xe,b as Te,c as H,d as Ye,e as G,E as Ze,f as es,m as Ee,M as Ie}from"./table-CU5QHOeX.js";import{u as Re,a as Ke,I as B,C as A,b as ce,c as oe,d as de,e as J}from"./card-CIvVsfPA.js";import{O as be,Q as Qe,R as we,T as Ce,U as Se,M as V,V as Le,X as _e,W as ke,a3 as ne,D as ss,j as ts,k as rs,l as ns,n as ue,m as as,N as ls,$ as ae,A as je,s as pe,t as ge,a4 as is,a5 as cs,a6 as os,a7 as ds,a8 as xs}from"./sign-out-dialog-G8YN-xzd.js";import{h as ms,l as Ue,i as hs,C as us,a as fe,b as Ne,P as js,e as ps,f as gs,g as fs}from"./progress-5U3sx07p.js";import{B as te}from"./badge-ZZTIeOX4.js";import{H as Fe,S as Oe,T as qe,C as Pe,P as Me,a as Ns}from"./config-drawer-BOCjIL-U.js";import{c as I,C as vs,F as $e}from"./content-api-C9J9D9tx.js";import{l as ys}from"./learning-centers-api-DzQvX2iI.js";import{g as ve}from"./media-utils-Cpm_6zhn.js";import{T as De,a as bs,b as ws,c as le,d as ie}from"./textarea-Ch7azh-_.js";import{S as X,a as Y,b as Z,c as ee,d as se}from"./select-BSuPs2ZA.js";import{D as We}from"./download-DKq4IDc3.js";import{c as Cs}from"./createLucideIcon-CYEOcWL4.js";import{E as Ss}from"./eye-0i_I_DcA.js";import{C as Ls}from"./chevrons-up-down-BSNcWWiO.js";import{P as _s}from"./plus-BwYmgaLr.js";/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ks=[["line",{x1:"4",x2:"20",y1:"9",y2:"9",key:"4lhtct"}],["line",{x1:"4",x2:"20",y1:"15",y2:"15",key:"vyu0kd"}],["line",{x1:"10",x2:"8",y1:"3",y2:"21",key:"1ggp8o"}],["line",{x1:"16",x2:"14",y1:"3",y2:"21",key:"weycgp"}]],Ds=Cs("hash",ks);function Ts({courseId:a,children:N,onSuccess:C}){const[F,w]=j.useState(!1),m=xe(),o=Re({resolver:Ke(ms),defaultValues:{title:"",content:"",order:1,lesson_type:"word",word_lesson_id:void 0}}),x=o.watch("lesson_type"),[d,v]=j.useState(""),{data:h,isLoading:y}=Q({queryKey:["courses"],queryFn:()=>I.courses.list(),enabled:!a}),{data:p,isLoading:f}=Q({queryKey:["word-lessons",a],queryFn:async()=>{if(!a)return[];const n=await I.chapters.listByCourse(a);return(await Promise.all(n.map(q=>I.lessons.listByChapter(q.id)))).flat().filter(q=>q.lesson_type==="word")},enabled:x==="test"&&!!a}),l=p?.filter(n=>n.title.toLowerCase().includes(d.toLowerCase()))||[],s=ye({mutationFn:n=>I.lessons.create({title:n.title,content:n.content,order:n.order,chapter_id:n.courseId,lesson_type:n.lesson_type,word_lesson_id:n.word_lesson_id}),onSuccess:()=>{b.success("Lesson created successfully"),m.invalidateQueries({queryKey:["lessons"]}),m.invalidateQueries({queryKey:["courses"]}),o.reset(),w(!1),C?.()},onError:n=>{b.error("Failed to create lesson"),console.error("Create lesson error:",n)}}),O=n=>{const i=a||parseInt(o.watch("courseId"));if(!i){b.error("Please select a course");return}s.mutate({...n,courseId:i})};return e.jsxs(be,{open:F,onOpenChange:w,children:[e.jsx(Qe,{asChild:!0,children:N||e.jsxs(u,{children:[e.jsx(vs,{className:"h-4 w-4"}),"Add Lesson"]})}),e.jsxs(we,{className:"sm:max-w-[700px]",children:[e.jsxs(Ce,{children:[e.jsxs(Se,{className:"flex items-center gap-2",children:[e.jsx(V,{className:"h-5 w-5"}),"Create New Lesson"]}),e.jsx(Le,{children:"Add a new lesson to organize educational content and words."})]}),e.jsx(Be,{...o,children:e.jsxs("form",{onSubmit:o.handleSubmit(O),className:"space-y-6",children:[e.jsxs("div",{className:"grid gap-4",children:[!a&&e.jsx(L,{control:o.control,name:"courseId",render:({field:n})=>e.jsxs(_,{children:[e.jsx(k,{children:"Course *"}),e.jsxs(X,{onValueChange:i=>n.onChange(parseInt(i)),value:n.value?.toString(),disabled:y,children:[e.jsx(D,{children:e.jsx(Y,{children:e.jsx(Z,{placeholder:"Select a course"})})}),e.jsx(ee,{children:h?.map(i=>e.jsx(se,{value:i.id.toString(),children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${i.is_active?"bg-green-500":"bg-red-500"}`}),i.title]})},i.id))})]}),e.jsx(T,{})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx("div",{className:"md:col-span-2",children:e.jsx(L,{control:o.control,name:"title",render:({field:n})=>e.jsxs(_,{children:[e.jsx(k,{children:"Lesson Title *"}),e.jsx(D,{children:e.jsx(B,{placeholder:"e.g., Greetings and Introductions",...n})}),e.jsx(T,{})]})})}),e.jsx("div",{children:e.jsx(L,{control:o.control,name:"order",render:({field:n})=>e.jsxs(_,{children:[e.jsx(k,{children:"Order *"}),e.jsx(D,{children:e.jsx(B,{type:"number",min:"1",placeholder:"1",...n,onChange:i=>n.onChange(parseInt(i.target.value)||1)})}),e.jsx(T,{})]})})})]}),e.jsx(L,{control:o.control,name:"lesson_type",render:({field:n})=>e.jsxs(_,{children:[e.jsx(k,{children:"Lesson Type *"}),e.jsxs(X,{onValueChange:n.onChange,value:n.value,children:[e.jsx(D,{children:e.jsx(Y,{children:e.jsx(Z,{placeholder:"Select lesson type"})})}),e.jsx(ee,{children:Ue.map(i=>e.jsx(se,{value:i.value,children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"font-medium",children:i.label}),e.jsx("span",{className:"text-xs text-muted-foreground",children:i.description})]})},i.value))})]}),e.jsx(T,{})]})}),x==="test"&&e.jsx(L,{control:o.control,name:"word_lesson_id",render:({field:n})=>e.jsxs(_,{children:[e.jsx(k,{children:"Connect to Word Lesson *"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"relative",children:[e.jsx(_e,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),e.jsx(B,{placeholder:"Search word lessons...",value:d,onChange:i=>v(i.target.value),className:"pl-10"})]}),e.jsxs(X,{onValueChange:i=>n.onChange(parseInt(i)),value:n.value?.toString(),disabled:f,children:[e.jsx(D,{children:e.jsx(Y,{children:e.jsx(Z,{placeholder:"Select a word lesson to connect"})})}),e.jsxs(ee,{className:"max-h-60",children:[l.map(i=>e.jsx(se,{value:i.id.toString(),children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(V,{className:"h-4 w-4 text-muted-foreground"}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{children:i.title}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:["Order: ",i.order]})]})]})},i.id)),l.length===0&&!f&&e.jsx("div",{className:"p-2 text-sm text-muted-foreground text-center",children:d?"No word lessons found matching your search":"No word lessons available"})]})]})]}),e.jsx(T,{})]})}),e.jsx(L,{control:o.control,name:"content",render:({field:n})=>e.jsxs(_,{children:[e.jsx(k,{children:"Lesson Content *"}),e.jsx(D,{children:e.jsx(De,{placeholder:"Describe the lesson objectives, key concepts, and learning outcomes...",className:"min-h-[150px]",...n})}),e.jsx(T,{})]})})]}),e.jsxs(ke,{children:[e.jsx(u,{type:"button",variant:"outline",onClick:()=>w(!1),children:"Cancel"}),e.jsx(u,{type:"submit",disabled:s.isPending,className:"min-w-[100px]",children:s.isPending?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),"Creating..."]}):"Create Lesson"})]})]})})]})]})}function Es({lesson:a,open:N,onOpenChange:C,onSuccess:F}){const w=xe(),[m,o]=j.useState(""),x=Re({resolver:Ke(hs),defaultValues:{title:"",content:"",order:1,lesson_type:"word",word_lesson_id:void 0}}),d=x.watch("lesson_type"),{data:v,isLoading:h}=Q({queryKey:["word-lessons",a?.chapter_id],queryFn:async()=>a?.chapter_id?(await I.lessons.listByChapter(a.chapter_id)).filter(s=>s.lesson_type==="word"&&s.id!==a?.id):[],enabled:d==="test"&&!!a&&N}),y=v?.filter(l=>l.title.toLowerCase().includes(m.toLowerCase()))||[],p=ye({mutationFn:l=>{if(!a)throw new Error("No lesson selected");return I.lessons.update(a.id,l)},onSuccess:()=>{b.success("Lesson updated successfully"),w.invalidateQueries({queryKey:["lessons"]}),w.invalidateQueries({queryKey:["courses"]}),C(!1),F?.()},onError:l=>{b.error("Failed to update lesson"),console.error("Update lesson error:",l)}});j.useEffect(()=>{a&&x.reset({title:a.title,content:a.content,order:a.order,lesson_type:a.lesson_type||"word",word_lesson_id:a.word_lesson_id})},[a,x]);const f=l=>{p.mutate(l)};return a?e.jsx(be,{open:N,onOpenChange:C,children:e.jsxs(we,{className:"sm:max-w-[700px]",children:[e.jsxs(Ce,{children:[e.jsxs(Se,{className:"flex items-center gap-2",children:[e.jsx(Ve,{className:"h-5 w-5"}),"Edit Lesson"]}),e.jsx(Le,{children:"Update the lesson information and content."})]}),e.jsx(Be,{...x,children:e.jsxs("form",{onSubmit:x.handleSubmit(f),className:"space-y-6",children:[e.jsxs("div",{className:"grid gap-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx("div",{className:"md:col-span-2",children:e.jsx(L,{control:x.control,name:"title",render:({field:l})=>e.jsxs(_,{children:[e.jsx(k,{children:"Lesson Title *"}),e.jsx(D,{children:e.jsx(B,{placeholder:"e.g., Greetings and Introductions",...l})}),e.jsx(T,{})]})})}),e.jsx("div",{children:e.jsx(L,{control:x.control,name:"order",render:({field:l})=>e.jsxs(_,{children:[e.jsx(k,{children:"Order *"}),e.jsx(D,{children:e.jsx(B,{type:"number",min:"1",placeholder:"1",...l,onChange:s=>l.onChange(parseInt(s.target.value)||1)})}),e.jsx(T,{})]})})})]}),e.jsx(L,{control:x.control,name:"lesson_type",render:({field:l})=>e.jsxs(_,{children:[e.jsx(k,{children:"Lesson Type *"}),e.jsxs(X,{onValueChange:l.onChange,value:l.value,children:[e.jsx(D,{children:e.jsx(Y,{children:e.jsx(Z,{placeholder:"Select lesson type"})})}),e.jsx(ee,{children:Ue.map(s=>e.jsx(se,{value:s.value,children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"font-medium",children:s.label}),e.jsx("span",{className:"text-xs text-muted-foreground",children:s.description})]})},s.value))})]}),e.jsx(T,{})]})}),d==="test"&&e.jsx(L,{control:x.control,name:"word_lesson_id",render:({field:l})=>e.jsxs(_,{children:[e.jsx(k,{children:"Connect to Word Lesson *"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"relative",children:[e.jsx(_e,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),e.jsx(B,{placeholder:"Search word lessons...",value:m,onChange:s=>o(s.target.value),className:"pl-10"})]}),e.jsxs(X,{onValueChange:s=>l.onChange(parseInt(s)),value:l.value?.toString(),disabled:h,children:[e.jsx(D,{children:e.jsx(Y,{children:e.jsx(Z,{placeholder:"Select a word lesson to connect"})})}),e.jsxs(ee,{className:"max-h-60",children:[y.map(s=>e.jsx(se,{value:s.id.toString(),children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(V,{className:"h-4 w-4 text-muted-foreground"}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{children:s.title}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:["Order: ",s.order]})]})]})},s.id)),y.length===0&&!h&&e.jsx("div",{className:"p-2 text-sm text-muted-foreground text-center",children:m?"No word lessons found matching your search":"No word lessons available"})]})]})]}),e.jsx(T,{})]})}),e.jsx(L,{control:x.control,name:"content",render:({field:l})=>e.jsxs(_,{children:[e.jsx(k,{children:"Lesson Content *"}),e.jsx(D,{children:e.jsx(De,{placeholder:"Describe the lesson objectives, key concepts, and learning outcomes...",className:"min-h-[150px]",...l})}),e.jsx(T,{})]})}),e.jsxs("div",{className:"bg-muted/50 border rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(V,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"font-medium text-sm",children:"Current Course"})]}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Chapter ",a.chapter_id]}),e.jsx("div",{className:"text-xs text-muted-foreground mt-1",children:"Note: To move this lesson to a different course, please create a new lesson in the target course."})]})]}),e.jsxs(ke,{children:[e.jsx(u,{type:"button",variant:"outline",onClick:()=>C(!1),children:"Cancel"}),e.jsx(u,{type:"submit",disabled:p.isPending,className:"min-w-[100px]",children:p.isPending?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),"Updating..."]}):"Update Lesson"})]})]})})]})}):null}const Ae=`[
  {
    "title": "Introduction to English",
    "content": "Welcome to our English course! In this first lesson, we'll cover the basics of English grammar and pronunciation.",
    "order": 1
  },
  {
    "title": "Basic Greetings",
    "content": "Learn common greetings and how to introduce yourself in English. Practice saying hello, goodbye, and asking how someone is doing.",
    "order": 2
  },
  {
    "title": "Numbers and Counting",
    "content": "Master numbers 1-100 in English. Learn how to count, tell time, and express quantities in everyday situations.",
    "order": 3
  },
  {
    "title": "Family and Relationships",
    "content": "Vocabulary for describing family members and relationships. Learn to talk about your family tree and close friends.",
    "order": 4
  },
  {
    "title": "Daily Activities",
    "content": "Common verbs and phrases for daily routines. Practice describing what you do from morning to night.",
    "order": 5
  }
]`;function Is({courseId:a,courseName:N,children:C,onSuccess:F}){const[w,m]=j.useState(!1),[o,x]=j.useState(""),[d,v]=j.useState([]),[h,y]=j.useState([]),[,p]=j.useState(!1),[f,l]=j.useState([]),[s,O]=j.useState("input"),[n,i]=j.useState(0),q=xe(),me=t=>{const r=[];if(!t.trim())return r.push("JSON input is required"),{valid:!1,errors:r};try{const g=JSON.parse(t);if(!Array.isArray(g))return r.push("JSON must be an array of lesson objects"),{valid:!1,errors:r};if(g.length===0)return r.push("Array cannot be empty"),{valid:!1,errors:r};if(g.length>50)return r.push("Maximum 50 lessons allowed per bulk creation"),{valid:!1,errors:r};const S=[],E=new Set;return g.forEach((P,$)=>{if(typeof P!="object"||P===null){r.push(`Item ${$+1}: Must be an object`);return}const{title:W,content:z,order:M}=P;!W||typeof W!="string"?r.push(`Item ${$+1}: "title" is required and must be a string`):W.length>200&&r.push(`Item ${$+1}: "title" must be less than 200 characters`),!z||typeof z!="string"?r.push(`Item ${$+1}: "content" is required and must be a string`):z.length>5e3&&r.push(`Item ${$+1}: "content" must be less than 5000 characters`),typeof M!="number"||M<1?r.push(`Item ${$+1}: "order" must be a positive number`):E.has(M)?r.push(`Item ${$+1}: "order" ${M} is duplicated`):E.add(M),W&&z&&typeof M=="number"&&M>=1&&S.push({title:W.trim(),content:z.trim(),order:M})}),{valid:r.length===0,lessons:S,errors:r}}catch(g){return r.push("Invalid JSON format: "+g.message),{valid:!1,errors:r}}},R=()=>{const{valid:t,lessons:r,errors:g}=me(o);v(g),t&&r&&(y(r),O("preview"))},he=async()=>{O("creating"),p(!0),i(0);const t=[];for(let S=0;S<h.length;S++){const E=h[S];try{const P=await I.lessons.create({title:E.title,content:E.content,order:E.order,chapter_id:a,lesson_type:"word"});t.push({lesson:E,success:!0,id:P.id}),b.success(`Created lesson: ${E.title}`)}catch(P){t.push({lesson:E,success:!1,error:P instanceof Error?P.message:"Unknown error"}),b.error(`Failed to create lesson: ${E.title}`)}i((S+1)/h.length*100),l([...t])}p(!1),O("results"),q.invalidateQueries({queryKey:["lessons"]}),q.invalidateQueries({queryKey:["courses"]});const r=t.filter(S=>S.success).length,g=t.filter(S=>!S.success).length;r>0&&b.success(`Successfully created ${r} lesson${r>1?"s":""}`),g>0&&b.error(`Failed to create ${g} lesson${g>1?"s":""}`),F?.()},K=()=>{O("input"),x(""),v([]),y([]),l([]),i(0)},U=()=>{navigator.clipboard.writeText(Ae),b.success("Example JSON copied to clipboard")},c=()=>{const t=new Blob([Ae],{type:"application/json"}),r=URL.createObjectURL(t),g=document.createElement("a");g.href=r,g.download="lessons-example.json",document.body.appendChild(g),g.click(),document.body.removeChild(g),URL.revokeObjectURL(r),b.success("Example JSON downloaded")};return e.jsxs(be,{open:w,onOpenChange:m,children:[e.jsx(Qe,{asChild:!0,children:C||e.jsxs(u,{variant:"outline",children:[e.jsx($e,{className:"h-4 w-4"}),"Bulk Create (JSON)"]})}),e.jsxs(we,{className:"sm:max-w-[900px] max-h-[90vh] flex flex-col",children:[e.jsxs(Ce,{children:[e.jsxs(Se,{className:"flex items-center gap-2",children:[e.jsx($e,{className:"h-5 w-5"}),'Bulk Create Lessons for "',N,'"']}),e.jsx(Le,{children:"Create multiple lessons at once using JSON format. Each lesson will be created individually."})]}),e.jsxs(bs,{value:s,className:"w-full flex-1 flex flex-col overflow-hidden",children:[e.jsxs(ws,{className:"grid w-full grid-cols-4",children:[e.jsx(le,{value:"input",disabled:s==="creating",className:re(s==="input"&&"bg-primary text-primary-foreground",["preview","creating","results"].includes(s)&&"bg-muted"),children:"1. JSON Input"}),e.jsx(le,{value:"preview",disabled:s==="creating"||h.length===0,className:re(s==="preview"&&"bg-primary text-primary-foreground",["creating","results"].includes(s)&&"bg-muted"),children:"2. Preview"}),e.jsx(le,{value:"creating",disabled:!0,className:re(s==="creating"&&"bg-primary text-primary-foreground",s==="results"&&"bg-muted"),children:"3. Creating..."}),e.jsx(le,{value:"results",disabled:f.length===0,className:re(s==="results"&&"bg-primary text-primary-foreground"),children:"4. Results"})]}),e.jsx(ie,{value:"input",className:"space-y-4 flex-1 overflow-y-auto",children:e.jsxs("div",{className:"grid gap-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Lessons JSON Array"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(u,{variant:"ghost",size:"sm",onClick:U,children:[e.jsx(us,{className:"h-3 w-3 mr-1"}),"Copy Example"]}),e.jsxs(u,{variant:"ghost",size:"sm",onClick:c,children:[e.jsx(We,{className:"h-3 w-3 mr-1"}),"Download Example"]})]})]}),e.jsx(De,{value:o,onChange:t=>x(t.target.value),placeholder:"Paste your JSON array here...",className:"min-h-[300px] max-h-[400px] font-mono text-sm resize-none"})]}),d.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-red-600",children:[e.jsx(fe,{className:"h-4 w-4"}),e.jsx("span",{className:"font-medium",children:"Validation Errors:"})]}),e.jsx(ne,{className:"max-h-[100px]",children:e.jsx("ul",{className:"space-y-1 text-sm text-red-600",children:d.map((t,r)=>e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-red-400 mt-0.5",children:"•"}),t]},r))})})]}),e.jsxs("div",{className:"bg-muted/50 rounded-lg p-4",children:[e.jsx("h4",{className:"font-medium mb-2",children:"JSON Format Requirements:"}),e.jsxs("ul",{className:"text-sm text-muted-foreground space-y-1",children:[e.jsx("li",{children:"• Must be a valid JSON array"}),e.jsx("li",{children:'• Each object requires: "title", "content", "order"'}),e.jsx("li",{children:"• Title: max 200 characters"}),e.jsx("li",{children:"• Content: max 5000 characters"}),e.jsx("li",{children:"• Order: positive number, unique per lesson"}),e.jsx("li",{children:"• Maximum 50 lessons per bulk operation"})]})]})]})}),e.jsx(ie,{value:"preview",className:"space-y-4 flex-1 overflow-y-auto",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ne,{className:"h-5 w-5 text-green-600"}),e.jsxs("span",{className:"font-medium",children:["Ready to create ",h.length," lesson",h.length>1?"s":""]})]}),e.jsx(ne,{className:"flex-1 max-h-[400px]",children:e.jsx("div",{className:"space-y-3",children:h.map((t,r)=>e.jsxs("div",{className:"border rounded-lg p-3",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsxs(te,{variant:"outline",children:["#",t.order]}),e.jsx("span",{className:"font-medium",children:t.title})]}),e.jsx("p",{className:"text-sm text-muted-foreground line-clamp-2",children:t.content})]},r))})})]})}),e.jsx(ie,{value:"creating",className:"space-y-4 flex-1 overflow-y-auto",children:e.jsxs("div",{className:"text-center space-y-4",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Creating lessons..."}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[Math.round(n),"% complete (",f.length," of ",h.length,")"]})]}),e.jsx(js,{value:n,className:"w-full"}),f.length>0&&e.jsx(ne,{className:"max-h-[300px]",children:e.jsx("div",{className:"space-y-2 text-left",children:f.map((t,r)=>e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[t.success?e.jsx(Ne,{className:"h-4 w-4 text-green-600"}):e.jsx(fe,{className:"h-4 w-4 text-red-600"}),e.jsx("span",{className:t.success?"text-green-600":"text-red-600",children:t.lesson.title})]},r))})})]})}),e.jsx(ie,{value:"results",className:"space-y-4 flex-1 overflow-y-auto",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"text-center p-4 bg-green-50 dark:bg-green-950 rounded-lg",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:f.filter(t=>t.success).length}),e.jsx("div",{className:"text-sm text-green-600",children:"Successful"})]}),e.jsxs("div",{className:"text-center p-4 bg-red-50 dark:bg-red-950 rounded-lg",children:[e.jsx("div",{className:"text-2xl font-bold text-red-600",children:f.filter(t=>!t.success).length}),e.jsx("div",{className:"text-sm text-red-600",children:"Failed"})]})]}),e.jsx(ne,{className:"flex-1 max-h-[400px]",children:e.jsx("div",{className:"space-y-2",children:f.map((t,r)=>e.jsxs("div",{className:"flex items-start gap-3 p-2 rounded border",children:[t.success?e.jsx(Ne,{className:"h-4 w-4 text-green-600 mt-0.5"}):e.jsx(fe,{className:"h-4 w-4 text-red-600 mt-0.5"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-medium text-sm",children:t.lesson.title}),t.error&&e.jsx("div",{className:"text-xs text-red-600 mt-1",children:t.error}),t.success&&t.id&&e.jsxs("div",{className:"text-xs text-green-600 mt-1",children:["Created with ID: ",t.id]})]})]},r))})})]})})]}),e.jsxs(ke,{children:[s==="input"&&e.jsxs(e.Fragment,{children:[e.jsx(u,{variant:"outline",onClick:()=>m(!1),children:"Cancel"}),e.jsx(u,{onClick:R,disabled:!o.trim(),children:"Validate & Preview"})]}),s==="preview"&&e.jsxs(e.Fragment,{children:[e.jsx(u,{variant:"outline",onClick:()=>O("input"),children:"Back"}),e.jsxs(u,{onClick:he,disabled:h.length===0,children:["Create ",h.length," Lesson",h.length>1?"s":""]})]}),s==="creating"&&e.jsxs(u,{disabled:!0,children:["Creating... ",Math.round(n),"%"]}),s==="results"&&e.jsxs(e.Fragment,{children:[e.jsx(u,{variant:"outline",onClick:K,children:"Create More"}),e.jsx(u,{onClick:()=>m(!1),children:"Done"})]})]})]})]})}function Fs({data:a,isLoading:N,onEdit:C,onViewWords:F,onRefresh:w,courseName:m}){const[o,x]=j.useState(!1),[d,v]=j.useState(null),h=xe(),y=ye({mutationFn:s=>I.lessons.delete(s),onSuccess:s=>{b.success(s.message),h.invalidateQueries({queryKey:["lessons"]}),h.invalidateQueries({queryKey:["courses"]}),w(),x(!1),v(null)},onError:s=>{b.error("Failed to delete lesson"),console.error("Delete error:",s)}}),p=s=>{v(s),x(!0)},f=()=>{d&&y.mutate(d.id)},l=s=>{switch(s){case"word":return"bg-blue-100 text-blue-800 hover:bg-blue-100";case"story":return"bg-purple-100 text-purple-800 hover:bg-purple-100";default:return"bg-gray-100 text-gray-800 hover:bg-gray-100"}};return N?e.jsxs(A,{children:[e.jsxs(ce,{children:[e.jsx(oe,{children:"Lessons"}),e.jsx(de,{children:"Loading..."})]}),e.jsx(J,{children:e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})})})]}):a.length===0?e.jsxs(A,{children:[e.jsxs(ce,{children:[e.jsx(oe,{children:"Lessons"}),e.jsx(de,{children:m?`No lessons found in "${m}"`:"No lessons found"})]}),e.jsx(J,{children:e.jsxs("div",{className:"flex flex-col items-center justify-center py-8",children:[e.jsx(V,{className:"h-12 w-12 text-muted-foreground mb-4"}),e.jsxs("p",{className:"text-muted-foreground text-center",children:[m?`No lessons have been created for "${m}" yet.`:"No lessons have been created yet.",e.jsx("br",{}),'Click "Add Lesson" to get started.']})]})})]}):e.jsxs(e.Fragment,{children:[e.jsxs(A,{className:"border-0 shadow-lg bg-gradient-to-br from-card via-card to-card/95",children:[e.jsx(ce,{className:"pb-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs(oe,{className:"text-xl font-semibold flex items-center gap-2",children:[e.jsx(V,{className:"h-5 w-5 text-primary"}),"Lessons (",a.length,")",m&&e.jsx(te,{variant:"outline",className:"ml-2",children:m})]}),e.jsx(de,{className:"mt-1",children:m?`Manage lessons for "${m}" course`:"Manage educational lessons and their content"})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"Total Lessons"}),e.jsx("div",{className:"text-2xl font-bold text-primary",children:a.length})]})]})}),e.jsx(J,{children:e.jsxs(Ge,{children:[e.jsx(Xe,{children:e.jsxs(Te,{children:[e.jsx(H,{children:"Lesson"}),e.jsx(H,{children:"Chapter"}),e.jsx(H,{children:"Type"}),e.jsx(H,{children:"Order"}),e.jsx(H,{children:"Actions"})]})}),e.jsx(Ye,{children:a.map(s=>e.jsxs(Te,{children:[e.jsx(G,{className:"max-w-[300px]",children:e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"font-medium truncate",title:s.title,children:s.title}),e.jsx("div",{className:"text-sm text-muted-foreground line-clamp-1",title:s.content,children:s.content})]})}),e.jsx(G,{className:"max-w-[200px]",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(V,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("div",{className:"min-w-0 flex-1",children:e.jsxs("div",{className:"font-medium text-sm truncate",title:`Chapter ${s.chapter_id}`,children:["Chapter ",s.chapter_id]})})]})}),e.jsx(G,{children:e.jsx(te,{variant:"secondary",className:l(s.lesson_type),children:s.lesson_type.charAt(0).toUpperCase()+s.lesson_type.slice(1)})}),e.jsx(G,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ds,{className:"h-3 w-3 text-muted-foreground"}),e.jsx("span",{className:"text-sm font-mono",children:s.order})]})}),e.jsx(G,{children:e.jsxs(ss,{children:[e.jsx(ts,{asChild:!0,children:e.jsxs(u,{variant:"ghost",className:"h-8 w-8 p-0",children:[e.jsx("span",{className:"sr-only",children:"Open menu"}),e.jsx(Ze,{className:"h-4 w-4"})]})}),e.jsxs(rs,{align:"end",children:[e.jsx(ns,{children:"Actions"}),e.jsxs(ue,{onClick:()=>F(s),children:[e.jsx(Ss,{className:"mr-2 h-4 w-4"}),"View Words"]}),e.jsx(as,{}),e.jsxs(ue,{onClick:()=>C(s),children:[e.jsx(Ve,{className:"mr-2 h-4 w-4"}),"Edit"]}),e.jsxs(ue,{onClick:()=>p(s),className:"text-red-600",children:[e.jsx(es,{className:"mr-2 h-4 w-4"}),"Delete"]})]})]})})]},s.id))})]})})]}),e.jsx(ls,{open:o,onOpenChange:x,title:"Delete Lesson",desc:`Are you sure you want to delete "${d?.title}"? This action cannot be undone and will also delete all associated words.`,confirmText:"Delete",handleConfirm:f,isLoading:y.isPending})]})}function Os(){const a=ze(),N=He({from:"/_authenticated/content/lessons"}),[C,F]=j.useState(null),[w,m]=j.useState(!1),[o,x]=j.useState(""),[d,v]=j.useState(N.courseId?.toString()||""),[h,y]=j.useState(!1),{data:p=[],isLoading:f}=Q({queryKey:["courses"],queryFn:()=>I.courses.list()}),{data:l=[]}=Q({queryKey:["learning-centers"],queryFn:()=>ys.list()}),{data:s=[],isLoading:O,refetch:n}=Q({queryKey:["lessons",d],queryFn:()=>I.lessons.list({chapter_id:d?parseInt(d):void 0}),enabled:!!d});j.useEffect(()=>{N.courseId&&p.length>0&&v(N.courseId.toString())},[N.courseId,p]);const i=s.filter(c=>c.title.toLowerCase().includes(o.toLowerCase())||c.content.toLowerCase().includes(o.toLowerCase())),q=c=>{F(c),m(!0)},me=c=>{a({to:"/content/words",search:{lessonId:c.id}})},R=()=>{n()},he=c=>{v(c),x(""),a({to:"/content/lessons",search:c?{courseId:parseInt(c)}:{}})},K=p.find(c=>c.id.toString()===d),U=l.find(c=>c.id===K?.learning_center_id);return d?e.jsxs(e.Fragment,{children:[e.jsxs(Fe,{children:[e.jsx(Ee,{links:Je}),e.jsxs("div",{className:"ms-auto flex items-center space-x-4",children:[e.jsx(Oe,{}),e.jsx(qe,{}),e.jsx(Pe,{}),e.jsx(Me,{})]})]}),e.jsxs(Ie,{children:[e.jsxs("div",{className:"mb-6 flex flex-col gap-4 md:flex-row md:items-center md:justify-between",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight bg-gradient-to-r from-primary to-primary/70 bg-clip-text text-transparent",children:"Lesson Management"}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx("p",{className:"text-muted-foreground text-lg",children:"Managing lessons for"}),U&&e.jsxs(je,{className:"h-5 w-5",children:[e.jsx(pe,{src:ve(U.logo||""),alt:U.name}),e.jsx(ge,{children:e.jsx(ae,{className:"h-3 w-3"})})]}),e.jsx(te,{variant:"outline",children:K?.title})]})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(u,{variant:"outline",onClick:()=>v(""),children:"Change Course"}),e.jsx(Is,{courseId:parseInt(d),courseName:K?.title||"Selected Course",onSuccess:R}),e.jsx(Ts,{courseId:parseInt(d),onSuccess:R,children:e.jsxs(u,{size:"lg",className:"bg-gradient-to-r from-primary to-primary/90 hover:from-primary/90 hover:to-primary/80 shadow-lg hover:shadow-xl transition-all duration-200",children:[e.jsx(_s,{className:"mr-2 h-5 w-5"}),"Add Lesson"]})})]})]}),e.jsxs("div",{className:"flex flex-col gap-3 md:flex-row md:items-center mb-6",children:[e.jsx("div",{className:"flex-1",children:e.jsx(B,{placeholder:"Search lessons...",value:o,onChange:c=>x(c.target.value),className:"w-full"})}),e.jsx("div",{className:"flex gap-2",children:e.jsxs(u,{variant:"outline",size:"sm",children:[e.jsx(We,{className:"h-4 w-4"}),"Export"]})})]}),o&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground mb-6",children:[e.jsxs("span",{children:["Showing ",i.length," of ",s.length," lessons"]}),e.jsxs(te,{variant:"secondary",children:['Search: "',o,'"']}),e.jsx(u,{variant:"ghost",size:"sm",onClick:()=>x(""),children:"Clear search"})]}),e.jsx(Fs,{data:i,isLoading:O,onEdit:q,onViewWords:me,onRefresh:R,courseName:K?.title})]}),e.jsx(Es,{lesson:C,open:w,onOpenChange:m,onSuccess:R})]}):e.jsxs(e.Fragment,{children:[e.jsxs(Fe,{children:[e.jsx(Ee,{links:Je}),e.jsxs("div",{className:"ms-auto flex items-center space-x-4",children:[e.jsx(Oe,{}),e.jsx(qe,{}),e.jsx(Pe,{}),e.jsx(Me,{})]})]}),e.jsxs(Ie,{children:[e.jsx("div",{className:"mb-6 flex flex-col gap-4 md:flex-row md:items-center md:justify-between",children:e.jsxs("div",{className:"space-y-1",children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight bg-gradient-to-r from-primary to-primary/70 bg-clip-text text-transparent",children:"Lesson Management"}),e.jsx("p",{className:"text-muted-foreground text-lg",children:"Select a course to view and manage its lessons"})]})}),e.jsxs(A,{className:"max-w-2xl mb-6",children:[e.jsxs(ce,{children:[e.jsxs(oe,{className:"flex items-center gap-2",children:[e.jsx(ae,{className:"h-5 w-5"}),"Select Course"]}),e.jsx(de,{children:"Choose a course to manage its lessons and content"})]}),e.jsxs(J,{className:"space-y-4",children:[e.jsxs(ps,{open:h,onOpenChange:y,children:[e.jsx(gs,{asChild:!0,children:e.jsxs(u,{variant:"outline",role:"combobox","aria-expanded":h,className:"w-full justify-between",children:[d?(()=>{const c=p.find(r=>r.id.toString()===d),t=l.find(r=>r.id===c?.learning_center_id);return e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(je,{className:"h-6 w-6",children:[e.jsx(pe,{src:ve(t?.logo||""),alt:t?.name}),e.jsx(ge,{children:e.jsx(ae,{className:"h-3 w-3"})})]}),e.jsx("span",{className:"truncate",children:c?.title})]})})():e.jsxs("div",{className:"flex items-center gap-2 text-muted-foreground",children:[e.jsx(_e,{className:"h-4 w-4"}),e.jsx("span",{children:"Search courses..."})]}),e.jsx(Ls,{className:"ml-2 h-4 w-4 shrink-0 opacity-50"})]})}),e.jsx(fs,{className:"w-full p-0",children:e.jsxs(is,{children:[e.jsx(cs,{placeholder:"Search courses..."}),e.jsx(os,{children:"No courses found."}),e.jsx(ds,{children:p.map(c=>{const t=l.find(r=>r.id===c.learning_center_id);return e.jsx(xs,{value:`${c.title} ${t?.name||""}`,onSelect:()=>{he(c.id.toString()),y(!1)},children:e.jsxs("div",{className:"flex items-center gap-3 w-full",children:[e.jsxs(je,{className:"h-8 w-8",children:[e.jsx(pe,{src:ve(t?.logo||""),alt:t?.name}),e.jsx(ge,{children:e.jsx(ae,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium",children:c.title}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:[t?.name||`Center ${c.learning_center_id}`," • Lessons"]})]}),e.jsx(Ns,{className:`ml-auto h-4 w-4 ${d===c.id.toString()?"opacity-100":"opacity-0"}`})]})},c.id)})})]})})]}),f&&e.jsxs("div",{className:"flex items-center justify-center py-4",children:[e.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-primary"}),e.jsx("span",{className:"ml-2 text-sm text-muted-foreground",children:"Loading courses..."})]})]})]}),p.length>0&&e.jsxs("div",{className:"grid gap-4 md:grid-cols-3 max-w-2xl",children:[e.jsx(A,{children:e.jsxs(J,{className:"pt-6",children:[e.jsx("div",{className:"text-2xl font-bold",children:p.length}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Total Courses"})]})}),e.jsx(A,{children:e.jsxs(J,{className:"pt-6",children:[e.jsx("div",{className:"text-2xl font-bold",children:p.reduce((c,t)=>c+(t.lessons_count||0),0)}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Total Lessons"})]})}),e.jsx(A,{children:e.jsxs(J,{className:"pt-6",children:[e.jsx("div",{className:"text-2xl font-bold",children:l.length}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Learning Centers"})]})})]})]})]})}const Je=[{title:"Courses",href:"/content/courses",isActive:!1,disabled:!1},{title:"Lessons",href:"/content/lessons",isActive:!0,disabled:!1},{title:"Words",href:"/content/words",isActive:!1,disabled:!1}],Ys=Os;export{Ys as component};

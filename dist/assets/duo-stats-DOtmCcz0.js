import{j as e,c as F,h as k,B as y,r as A}from"./index-CIznyvT-.js";import{B as _,u as P,T as H,M as U}from"./badge-DxcHkDxW.js";import{A as z,b as K,H as q,T as G,P as V}from"./theme-switch-CCCPDT63.js";import{c as $,b as D}from"./createLucideIcon-DdyNmu3y.js";import{C as n,a as g,b as N,c as w,d as c}from"./card-COu94R6X.js";import{T as L,a as B,b as S,c as p,d as R,e as f}from"./table-BgZtDiCD.js";import{G as v}from"./graduation-cap-Z8E8WJ6m.js";import{U as b}from"./users-DM71pEMn.js";import{E as O}from"./eye-Bu0ArWVl.js";import{B as X}from"./building-2-5bNycdW_.js";import{P as Y}from"./progress-iarGvBbT.js";import{R as Q,B as W,C as J,X as Z,Y as ee,a as se,b as te,L as ae,A as T}from"./BarChart-HDExOgg5.js";import{A as le}from"./arrow-left-_Kdayr4f.js";import{B as re}from"./book-open-jXExJ0MQ.js";import{P as ne}from"./phone-Bse9YVml.js";/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ce=[["path",{d:"M3 3v16a2 2 0 0 0 2 2h16",key:"c24i48"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]],M=$("chart-column",ce);function i({className:t,...h}){return e.jsx("div",{"data-slot":"skeleton",className:F("bg-accent animate-pulse rounded-md",t),...h})}const I={async getCourses(){return(await D.get("/admin/stats/courses")).data.courses},async getCourseDetails(t){return(await D.get(`/admin/stats/courses/${t}`)).data}};function ie({data:t,isLoading:h,onRefresh:a,onCourseClick:u}){const{t:s}=k(),x=l=>{u(l)};return h?e.jsxs(n,{children:[e.jsxs(g,{children:[e.jsxs(N,{className:"flex items-center gap-2",children:[e.jsx(M,{className:"h-5 w-5"}),s.duoStats.title]}),e.jsx(w,{children:s.duoStats.description})]}),e.jsx(c,{children:e.jsx("div",{className:"space-y-4",children:Array.from({length:5}).map((l,d)=>e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx(i,{className:"h-12 w-12 rounded-full"}),e.jsxs("div",{className:"space-y-2 flex-1",children:[e.jsx(i,{className:"h-4 w-[250px]"}),e.jsx(i,{className:"h-4 w-[200px]"})]})]},d))})})]}):t.length===0?e.jsxs(n,{children:[e.jsxs(g,{children:[e.jsxs(N,{className:"flex items-center gap-2",children:[e.jsx(v,{className:"h-5 w-5"}),s.duoStats.title]}),e.jsx(w,{children:s.duoStats.description})]}),e.jsx(c,{children:e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 text-center",children:[e.jsx(v,{className:"h-12 w-12 text-muted-foreground mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-muted-foreground mb-2",children:s.duoStats.noResults}),e.jsx("p",{className:"text-sm text-muted-foreground mb-4 max-w-sm",children:s.duoStats.noResultsDescription}),e.jsx(y,{onClick:a,variant:"outline",children:"Refresh"})]})})]}):e.jsxs(n,{children:[e.jsxs(g,{children:[e.jsxs(N,{className:"flex items-center gap-2",children:[e.jsx(v,{className:"h-5 w-5"}),"Course Statistics"]}),e.jsx(w,{children:"Click on any course to view detailed student progress"})]}),e.jsxs(c,{children:[e.jsxs(L,{children:[e.jsx(B,{children:e.jsxs(S,{children:[e.jsx(p,{children:s.duoStats.table.course}),e.jsx(p,{children:s.duoStats.table.totalStudents}),e.jsx(p,{className:"text-right",children:s.common.actions})]})}),e.jsx(R,{children:t.map(l=>e.jsxs(S,{className:"cursor-pointer hover:bg-muted/50 transition-colors",onClick:()=>x(l.course_id),children:[e.jsx(f,{children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"flex h-10 w-10 items-center justify-center rounded-lg bg-primary/10",children:e.jsx(v,{className:"h-5 w-5 text-primary"})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:l.course_title}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Course ID: ",l.course_id]})]})]})}),e.jsx(f,{children:e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs(_,{variant:"secondary",className:"flex items-center gap-1",children:[e.jsx(b,{className:"h-3 w-3"}),l.total_students," ",s.duoStats.table.students]})})}),e.jsx(f,{className:"text-right",children:e.jsxs(y,{variant:"ghost",size:"sm",onClick:d=>{d.stopPropagation(),x(l.course_id)},children:[e.jsx(O,{className:"h-4 w-4 mr-2"}),s.duoStats.table.viewDetails]})})]},l.course_id))})]}),e.jsxs("div",{className:"mt-6 grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(n,{children:e.jsx(c,{className:"p-4",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(v,{className:"h-5 w-5 text-blue-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Total Courses"}),e.jsx("p",{className:"text-2xl font-bold",children:t.length})]})]})})}),e.jsx(n,{children:e.jsx(c,{className:"p-4",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(b,{className:"h-5 w-5 text-green-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Total Students"}),e.jsx("p",{className:"text-2xl font-bold",children:t.reduce((l,d)=>l+d.total_students,0)})]})]})})}),e.jsx(n,{children:e.jsx(c,{className:"p-4",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(X,{className:"h-5 w-5 text-purple-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Average Students"}),e.jsx("p",{className:"text-2xl font-bold",children:t.length>0?Math.round(t.reduce((l,d)=>l+d.total_students,0)/t.length):0})]})]})})})]})]})]})}function de({students:t}){const a=[{range:"0",min:0,max:0,label:"0 lessons"},{range:"1-5",min:1,max:5,label:"1-5 lessons"},{range:"6-10",min:6,max:10,label:"6-10 lessons"},{range:"11-15",min:11,max:15,label:"11-15 lessons"},{range:"16-20",min:16,max:20,label:"16-20 lessons"},{range:"21-25",min:21,max:25,label:"21-25 lessons"},{range:"26-30",min:26,max:30,label:"26-30 lessons"},{range:"31-35",min:31,max:35,label:"31-35 lessons"},{range:"36-40",min:36,max:40,label:"36-40 lessons"},{range:"41-45",min:41,max:45,label:"41-45 lessons"},{range:"46-50",min:46,max:50,label:"46-50 lessons"},{range:"51+",min:51,max:1/0,label:"51+ lessons"}].map(s=>{const x=t.filter(l=>{const d=l.lessons_completed;return d>=s.min&&d<=s.max}).length;return{range:s.range,students:x,label:s.label}}).filter(s=>s.students>0),u=s=>({0:"#ef4444","1-5":"#f97316","6-10":"#eab308","11-15":"#84cc16","16-20":"#22c55e","21-25":"#10b981","26-30":"#06b6d4","31-35":"#3b82f6","36-40":"#6366f1","41-45":"#8b5cf6","46-50":"#a855f7","51+":"#d946ef"})[s]||"#6b7280";return t.length===0?e.jsxs(n,{children:[e.jsx(g,{children:e.jsx(N,{children:"Lesson Completion Distribution"})}),e.jsx(c,{children:e.jsx("div",{className:"flex items-center justify-center h-96 text-muted-foreground",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-lg font-medium",children:"No data available"}),e.jsx("div",{className:"text-sm",children:"No students found for this course"})]})})})]}):e.jsxs(n,{children:[e.jsxs(g,{children:[e.jsx(N,{className:"flex items-center gap-2 text-xl",children:"ðŸ“Š Lesson Completion Distribution"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Distribution of students by number of lessons completed (grouped in 5-lesson intervals)"})]}),e.jsxs(c,{children:[e.jsx(Q,{width:"100%",height:400,children:e.jsxs(W,{data:a,margin:{top:40,right:30,left:20,bottom:60},children:[e.jsx(J,{strokeDasharray:"3 3",opacity:.3}),e.jsx(Z,{dataKey:"range",angle:-45,textAnchor:"end",height:80,fontSize:12,interval:0}),e.jsx(ee,{label:{value:"Number of Students",angle:-90,position:"insideLeft"},fontSize:12}),e.jsxs(se,{dataKey:"students",radius:[4,4,0,0],children:[a.map((s,x)=>e.jsx(te,{fill:u(s.range)},`cell-${x}`)),e.jsx(ae,{dataKey:"students",position:"top",style:{fill:"hsl(var(--foreground))",fontSize:"14px",fontWeight:"600"}})]})]})}),e.jsxs("div",{className:"mt-6 grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[e.jsxs("div",{className:"text-center p-3 bg-muted/50 rounded-lg",children:[e.jsx("div",{className:"font-semibold text-lg",children:t.length}),e.jsx("div",{className:"text-muted-foreground",children:"Total Students"})]}),e.jsxs("div",{className:"text-center p-3 bg-muted/50 rounded-lg",children:[e.jsx("div",{className:"font-semibold text-lg",children:t.length>0?Math.round(t.reduce((s,x)=>s+x.lessons_completed,0)/t.length):0}),e.jsx("div",{className:"text-muted-foreground",children:"Average Lessons"})]}),e.jsxs("div",{className:"text-center p-3 bg-muted/50 rounded-lg",children:[e.jsx("div",{className:"font-semibold text-lg",children:t.length>0?Math.max(...t.map(s=>s.lessons_completed)):0}),e.jsx("div",{className:"text-muted-foreground",children:"Highest Progress"})]}),e.jsxs("div",{className:"text-center p-3 bg-muted/50 rounded-lg",children:[e.jsx("div",{className:"font-semibold text-lg",children:t.filter(s=>s.lessons_completed>0).length}),e.jsx("div",{className:"text-muted-foreground",children:"Active Students"})]})]})]})]})}function oe({courseId:t,onBack:h}){const{t:a}=k(),{data:u,isLoading:s,error:x}=P({queryKey:["stats","course",t],queryFn:()=>I.getCourseDetails(t)}),l=()=>{h()};if(s)return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx(i,{className:"h-8 w-32"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{className:"h-8 w-64"}),e.jsx(i,{className:"h-4 w-96"})]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:Array.from({length:3}).map((r,j)=>e.jsx(n,{children:e.jsx(c,{className:"p-4",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(i,{className:"h-5 w-5"}),e.jsxs("div",{className:"space-y-2 flex-1",children:[e.jsx(i,{className:"h-4 w-20"}),e.jsx(i,{className:"h-6 w-12"})]})]})})},j))}),e.jsxs(n,{children:[e.jsxs(g,{children:[e.jsx(i,{className:"h-6 w-48"}),e.jsx(i,{className:"h-4 w-64"})]}),e.jsx(c,{children:e.jsx("div",{className:"space-y-4",children:Array.from({length:5}).map((r,j)=>e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx(i,{className:"h-10 w-10 rounded-full"}),e.jsxs("div",{className:"space-y-2 flex-1",children:[e.jsx(i,{className:"h-4 w-48"}),e.jsx(i,{className:"h-3 w-32"})]}),e.jsx(i,{className:"h-4 w-16"})]},j))})})]})]});if(x)return e.jsx(n,{children:e.jsx(c,{className:"p-8",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-red-500 mb-4",children:"Failed to load course details"}),e.jsx(y,{onClick:()=>window.location.reload(),children:"Retry"})]})})});if(!u)return e.jsx(n,{children:e.jsx(c,{className:"p-8",children:e.jsx("div",{className:"text-center",children:e.jsx("p",{className:"text-muted-foreground",children:"Course not found"})})})});const{course_info:d,total_students:C,students:m}=u,o=Math.max(...m.map(r=>r.lessons_completed),1);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs(y,{variant:"ghost",onClick:l,className:"flex items-center gap-2",children:[e.jsx(le,{className:"h-4 w-4"}),a.duoStats.courseDetail.backToCourses]}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight bg-gradient-to-r from-primary to-primary/70 bg-clip-text text-transparent",children:d.title}),e.jsx("p",{className:"text-muted-foreground text-lg",children:a.duoStats.courseDetail.description})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(n,{children:e.jsx(c,{className:"p-4",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(b,{className:"h-5 w-5 text-blue-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:a.duoStats.courseDetail.totalStudents}),e.jsx("p",{className:"text-2xl font-bold",children:C})]})]})})}),e.jsx(n,{children:e.jsx(c,{className:"p-4",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(re,{className:"h-5 w-5 text-green-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Average Progress"}),e.jsx("p",{className:"text-2xl font-bold",children:m.length>0?Math.round(m.reduce((r,j)=>r+j.lessons_completed,0)/m.length):0})]})]})})}),e.jsx(n,{children:e.jsx(c,{className:"p-4",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(T,{className:"h-5 w-5 text-yellow-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Top Performer"}),e.jsx("p",{className:"text-lg font-bold",children:m.length>0?`${m[0]?.lessons_completed||0} lessons`:"N/A"})]})]})})})]}),e.jsx(de,{students:m}),e.jsxs(n,{children:[e.jsxs(g,{children:[e.jsxs(N,{className:"flex items-center gap-2",children:[e.jsx(b,{className:"h-5 w-5"}),a.duoStats.courseDetail.studentsProgress]}),e.jsx(w,{children:"Students sorted by lessons completed (highest first)"})]}),e.jsx(c,{children:m.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 text-center",children:[e.jsx(b,{className:"h-12 w-12 text-muted-foreground mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-muted-foreground mb-2",children:a.duoStats.courseDetail.noStudents}),e.jsx("p",{className:"text-sm text-muted-foreground",children:a.duoStats.courseDetail.noStudentsDescription})]}):e.jsxs(L,{children:[e.jsx(B,{children:e.jsxs(S,{children:[e.jsx(p,{children:a.duoStats.table.studentName}),e.jsx(p,{children:a.duoStats.table.phoneNumber}),e.jsx(p,{children:a.duoStats.table.lessonsCompleted}),e.jsx(p,{children:a.duoStats.table.progress})]})}),e.jsx(R,{children:m.map((r,j)=>e.jsxs(S,{children:[e.jsx(f,{children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(z,{className:"h-8 w-8",children:e.jsx(K,{className:"text-xs",children:r.full_name.split(" ").map(E=>E[0]).join("").toUpperCase()})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:r.full_name}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:["ID: ",r.user_id]})]}),j===0&&e.jsxs(_,{variant:"secondary",className:"ml-2",children:[e.jsx(T,{className:"h-3 w-3 mr-1"}),"Top"]})]})}),e.jsx(f,{children:e.jsx("div",{className:"flex items-center gap-2",children:r.phone_number?e.jsxs(e.Fragment,{children:[e.jsx(ne,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"text-sm",children:r.phone_number})]}):e.jsx("span",{className:"text-sm text-muted-foreground",children:a.duoStats.table.noPhone})})}),e.jsx(f,{children:e.jsxs(_,{variant:"outline",children:[r.lessons_completed," lessons"]})}),e.jsx(f,{className:"w-48",children:e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:r.lessons_completed}),e.jsxs("span",{className:"text-muted-foreground",children:["of ",o]})]}),e.jsx(Y,{value:r.lessons_completed/o*100,className:"h-2"})]})})]},r.user_id))})]})})]})]})}function xe(){const{t}=k(),h=()=>{const o=new URLSearchParams(window.location.search);return{courseId:o.get("courseId")?Number(o.get("courseId")):void 0}},[a,u]=A.useState(h().courseId);A.useEffect(()=>{const o=()=>{u(h().courseId)};return window.addEventListener("popstate",o),()=>window.removeEventListener("popstate",o)},[]);const s=o=>{const r=new URL(window.location.href);r.searchParams.set("courseId",o.toString()),window.history.pushState({},"",r.toString()),u(o)},x=()=>{const o=new URL(window.location.href);o.searchParams.delete("courseId"),window.history.pushState({},"",o.toString()),u(void 0)},{data:l=[],isLoading:d,refetch:C}=P({queryKey:["stats","courses"],queryFn:()=>I.getCourses()}),m=()=>[{title:"Overview",href:"/duo-stats",isActive:!a,disabled:!1},...a?[{title:"Course Details",href:"#",isActive:!0,disabled:!1}]:[],{title:"Analytics",href:"/duo-stats/analytics",isActive:!1,disabled:!0},{title:"Reports",href:"/duo-stats/reports",isActive:!1,disabled:!0}];return e.jsxs(e.Fragment,{children:[e.jsxs(q,{children:[e.jsx(H,{links:m()}),e.jsxs("div",{className:"ms-auto flex items-center space-x-4",children:[e.jsx(G,{}),e.jsx(V,{})]})]}),e.jsx(U,{children:a?e.jsx(oe,{courseId:a,onBack:x}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-6 flex flex-col gap-4 md:flex-row md:items-center md:justify-between",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight bg-gradient-to-r from-primary to-primary/70 bg-clip-text text-transparent",children:t.duoStats.title}),e.jsx("p",{className:"text-muted-foreground text-lg",children:t.duoStats.description})]}),e.jsx("div",{className:"flex items-center space-x-3",children:e.jsxs("div",{className:"flex items-center space-x-2 text-sm text-muted-foreground",children:[e.jsx(M,{className:"h-4 w-4"}),e.jsxs("span",{children:[l.length," courses"]})]})})]}),e.jsx(ie,{data:l,isLoading:d,onRefresh:C,onCourseClick:s})]})})]})}const ke=()=>e.jsx(xe,{});export{ke as component};
